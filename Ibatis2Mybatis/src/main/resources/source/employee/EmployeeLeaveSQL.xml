<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="tbl_employee_leave" >
  <resultMap id="BaseResultMap" class="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    -->
    <result column="leave_id" property="leaveId" jdbcType="VARCHAR" />
    <result column="employee_id" property="employeeId" jdbcType="VARCHAR" />
    <result column="leave_start_date" property="leaveStartDate" jdbcType="TIMESTAMP" />
    <result column="leave_end_date" property="leaveEndDate" jdbcType="TIMESTAMP" />
    <result column="leave_type" property="leaveType" jdbcType="CHAR" />
    <result column="leave_type_name" property="leaveTypeName" jdbcType="VARCHAR" />
    <result column="leave_reason" property="leaveReason" jdbcType="VARCHAR" />
    <result column="check_type" property="checkType" jdbcType="CHAR" />
    <result column="approve_employee" property="approveEmployee" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="modify_time" property="modifyTime" jdbcType="TIMESTAMP" />
    <result column="REMARK" property="remark" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="BaseResultMap2" class="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    -->
    <result column="leave_id" property="leaveId" jdbcType="VARCHAR" />
    <result column="employee_id" property="employeeId" jdbcType="VARCHAR" />
    <result column="leave_start_date" property="leaveStartDate" jdbcType="TIMESTAMP" />
    <result column="leave_end_date" property="leaveEndDate" jdbcType="TIMESTAMP" />
    <result column="leave_type" property="leaveType" jdbcType="CHAR" />
    <result column="leave_type_name" property="leaveTypeName" jdbcType="VARCHAR" />
    <result column="leave_reason" property="leaveReason" jdbcType="VARCHAR" />
    <result column="check_type" property="checkType" jdbcType="CHAR" />
    <result column="approve_employee" property="approveEmployee" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="modify_time" property="modifyTime" jdbcType="TIMESTAMP" />
    <result column="REMARK" property="remark" jdbcType="VARCHAR" />
    <result column="leave_img" property="leaveImg" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="ResultMapExt" class="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" extends="BaseResultMap">
    <result property="approveEmployeeVo" select="tbl_employee_info_vo.selectByEmployeeIdForOther" column="approve_employee"/>
    <result property="employeeInfoVo" select="tbl_employee_info_vo.selectByEmployeeIdForOther" column="employee_id"/>
  </resultMap>
  <resultMap id="ResultMapExt1" class="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" extends="BaseResultMap2">
    <!--<result property="officalType" column="offical_type" javaType="java.lang.String"/>-->
    <result property="approveEmployeeVo" select="tbl_employee_info_vo.selectByEmployeeIdForOther" column="approve_employee"/>
  </resultMap>
  <!-- 附带请假证明材料 -->
  <resultMap id="ResultMapExt2" class="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" extends="BaseResultMap2">
    <result property="approveEmployeeVo" select="tbl_employee_info_vo.selectByEmployeeIdForOther" column="approve_employee"/>
  </resultMap>
  <resultMap id="ResultMapExt2" class="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" extends="BaseResultMap">
    <result property="employeeInfoVo" select="tbl_employee_info_vo.selectByEmployeeIdForOther" column="employee_id"/>
  </resultMap>
    <resultMap id="ResultMapExt3" class="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" extends="BaseResultMap">
        <result property="approveEmployeeVo" select="tbl_employee_info_vo.selectByEmployeeIdForOther" column="approve_employee"/>
        <result property="employeeInfoVo" select="tbl_employee_info_vo.selectByEmployeeIdForOther" column="employee_id"/>
        <result column="project_name" property="projectName" jdbcType="VARCHAR" />
        <result column="project_actual_no" property="contract_no" jdbcType="VARCHAR" />
        <result column="leave_img" property="leaveImg" jdbcType="VARCHAR" />
    </resultMap>
  <resultMap id="MonthLeaveDays" class="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeaveMonthDays">
    <result column="employee_id" property="employeeId" jdbcType="VARCHAR" />
    <result column="EMPLOYEE_NAME" property="employeeName" jdbcType="VARCHAR" />
    <result column="leavedays" property="leaveDays" jdbcType="VARCHAR" />
    <result column="EMAIL" property="email" jdbcType="VARCHAR" />
    <result column="DEPARTMENT_NAME" property="departmentName" jdbcType="VARCHAR" />
    <result column="AREA" property="area" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="leave_Where_clause">
    <isNotEmpty prepend="and" property="employeeId">
      tbl_employee_leave.employee_id=#employeeId:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="approveEmployee">
      tbl_employee_leave.approve_employee=#approveEmployee:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="leaveType">
      tbl_employee_leave.leave_type=#leaveType:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="checkType">
      tbl_employee_leave.check_type=#checkType:VARCHAR#
    </isNotEmpty>
  </sql>
  <sql id="Criteria_Where_Clause" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  
  
    <select id="getEmployeeLeave" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" >
    select *   from tbl_employee_leave tel ,tbl_employee_info tei  ,tbl_department_info di
    where 
    	<dynamic prepend="tel.employee_id IN ">
			<isNotNull property="properties">
				<isNotNull property="properties.employeeIdList">
					<iterate property="properties.employeeIdList" open="("
						close=")" conjunction=",">
						#properties.employeeIdList[]#
					</iterate>
				</isNotNull>
			</isNotNull>
		</dynamic>
      and tel.employee_id = tei.EMPLOYEE_ID
      and tei.DEPARTMENT_ID = di.DEPARTMENT_ID
      <![CDATA[
		    and	date_format(leave_end_date,'%Y-%m-%d') >= #properties.queryDate:VARCHAR#
		    and date_format(leave_start_date,'%Y-%m-%d') <= #properties.queryDate:VARCHAR#
          ]]>
      <isNotNull prepend="and" property="properties.area">
          di.area = #properties.area:VARCHAR#
      </isNotNull>
  </select>
  
  
  <!-- 查询请假开始时间小于库里结束时间 -->
    <select id="selectByPrimaryStartTime" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" >
    select *   from tbl_employee_leave
    where employee_id = #employeeId:VARCHAR#
    and check_type!='2'
    and 
     <![CDATA[
		    	date_format(leave_end_date,'%Y-%m-%d %H:%i:%s') > date_format(#leaveStartDate:TIMESTAMP#,'%Y-%m-%d %H:%i:%s')
		    	and date_format(leave_start_date,'%Y-%m-%d %H:%i:%s') < date_format(#leaveStartDate:TIMESTAMP#,'%Y-%m-%d %H:%i:%s')
          ]]>
  </select>

  <!-- 批处理执行  查询开始和结束时间 -->
  <select id="queryEmployeeLeave" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" >
    select * from tbl_employee_leave tel
    where tel.check_type = '1'
    <![CDATA[
        and date_format(tel.leave_start_date,'%Y-%m-%d') <= date_format(#leaveStartDate:TIMESTAMP#,'%Y-%m-%d')
        and date_format(tel.leave_end_date,'%Y-%m-%d') >= date_format(#leaveEndDate:TIMESTAMP#,'%Y-%m-%d')
    ]]>
    and tel.employee_id = #employeeId:VARCHAR#
  </select>
  
  <!-- 查询已审批公出数据 -->
    <select id="selectByPrimaryleaveType" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" >
    select *   from tbl_employee_leave
    where employee_id = #employeeId:VARCHAR#
    and check_type ='1'
    and leave_type ='8'
    and 
     <![CDATA[
		    	date_format(leave_end_date,'%Y-%m-%d %H:%i:%s') >= date_format(now(),'%Y-%m-%d %H:%i:%s')
		    	and date_format(leave_start_date,'%Y-%m-%d %H:%i:%s') <= date_format(now(),'%Y-%m-%d %H:%i:%s')
          ]]>
  </select>
  
  <!-- 查询某个人有效未审批的请假数据 -->
    <select id="selectLeaveByEmployeeId" resultMap="BaseResultMap2" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" >
    select *   from tbl_employee_leave
    where check_type =#checkType:VARCHAR# and leave_type !=10
    <isNotEmpty prepend="AND" property="approveEmployee">
         approve_employee =#approveEmployee:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="AND" property="employeeId">
    	 employee_id = #employeeId:VARCHAR#
    </isNotEmpty>
    and 
     <![CDATA[
		    	date_format(leave_end_date,'%Y-%m-%d %H:%i:%s') >= date_format(now(),'%Y-%m-%d %H:%i:%s')
          ]]>
  </select>
  <!-- 查询报备数据 报备 leave_type 10-->
  <select id="selectLeaveByEmployeeIdLeaveType" resultMap="BaseResultMap2" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" >
    select *   from tbl_employee_leave tel where 1=1
    <isNotEmpty prepend="AND" property="checkType">
      tel.check_type =#checkType:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="AND" property="approveEmployee">
      tel.approve_employee =#approveEmployee:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="AND" property="employeeId">
      tel.employee_id = #employeeId:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="AND" property="leaveType">
      tel.leave_type = #leaveType:VARCHAR#
    </isNotEmpty>
    <![CDATA[
        and DATEDIFF(NOW(),tel.leave_start_date)<4 and DATEDIFF(NOW(),tel.leave_start_date)>=0
        and DATEDIFF(NOW(),tel.leave_end_date)<4 and DATEDIFF(NOW(),tel.leave_end_date)>=0
      ]]>
  </select>
  
<!-- 查询当月用户请假记录 -->
<select id="selectByEmployeeLeave" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" >
      <!--
      select * from tbl_project_etc etc, tbl_employee_leave lea
      where etc.employee_id = lea.employee_id
      <isNotNull prepend="and" property="properties.exportTime">
      <![CDATA[
      (
            date_format(lea.leave_start_date,'%Y-%m') =#properties.exportTime:VARCHAR#
            or
            date_format(lea.leave_end_date,'%Y-%m') = #properties.exportTime:VARCHAR#
      )
      ]]>
      </isNotNull>
      <isNotNull prepend="and" property="properties.contractNo">
      etc.contract_no = #properties.contractNo:VARCHAR#
      </isNotNull>
      -->
      select * from tbl_project_etc etc, tbl_employee_leave lea ,tbl_employee_info tei ,tbl_department_info dept
      where etc.employee_id = lea.employee_id
      and lea.employee_id = tei.EMPLOYEE_ID
      and tei.DEPARTMENT_ID = dept.DEPARTMENT_ID
      and tei.BEYOND_COMPANY = dept.BEYOND_COMPANY
      <isNotNull prepend="and" property="properties.exportEmployeeName">
        tei.EMPLOYEE_NAME = #properties.exportEmployeeName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="and" property="properties.exportComapyFrom">
        tei.BEYOND_COMPANY = #properties.exportComapyFrom:VARCHAR#
      </isNotNull>
      <isNotNull prepend="and" property="properties.exportDeptmentFrom">
        tei.DEPARTMENT_ID = #properties.exportDeptmentFrom:VARCHAR#
      </isNotNull>
      <isNotNull prepend="and" property="properties.exportContractNoFrom">
        etc.contract_no = #properties.exportContractNoFrom:VARCHAR#
      </isNotNull>
      <isNotNull prepend="and" property="properties.exportAreaFrom">
        dept.area = #properties.exportAreaFrom:VARCHAR#
      </isNotNull>
      <isNotNull prepend="and" property="properties.exportStatTimeFrom">
        <![CDATA[
          (
            date_format(lea.leave_start_date,'%Y-%m-%d') >= #properties.exportStatTimeFrom:VARCHAR#
             or date_format(lea.leave_end_date,'%Y-%m-%d') >= #properties.exportEndTimeFrom:VARCHAR#
             )
          ]]>
      </isNotNull>
      <isNotNull prepend="and" property="properties.defaultExportStatTimeFrom">
        <![CDATA[
                date_format(lea.leave_start_date,'%Y-%m') >=#properties.defaultExportStatTimeFrom:VARCHAR#
          ]]>
      </isNotNull>
      <isNotNull prepend="and" property="properties.defaultExportEndTimeFrom">
        <![CDATA[
                date_format(lea.leave_start_date,'%Y-%m') <=#properties.defaultExportEndTimeFrom:VARCHAR#
         ]]>
      </isNotNull>
</select>

<select id="selectByCriteria" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeaveCriteria" >
<!--
  WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
  This element was generated on Wed Jul 15 10:13:18 CST 2015.
-->
    select *
    from tbl_employee_leave
    <isParameterPresent >
      <include refid="tbl_employee_leave.Criteria_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap2" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    -->
    select *
    from tbl_employee_leave
    where leave_id = #leaveId:VARCHAR#
  </select>
  <delete id="deleteByPrimaryKey" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    -->
    delete from tbl_employee_leave
    where leave_id = #leaveId:VARCHAR#
  </delete>
  <delete id="deleteByCriteria" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeaveCriteria" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    -->
    delete from tbl_employee_leave
    <include refid="tbl_employee_leave.Criteria_Where_Clause" />
  </delete>
  <insert id="insert" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    -->
    insert into tbl_employee_leave (leave_id, employee_id, leave_start_date, leave_end_date,
    leave_type, leave_type_name,leave_reason, check_type,approve_employee,create_time,modify_time,REMARK)
    values (#leaveId:VARCHAR#, #employeeId:VARCHAR#, #leaveStartDate:TIMESTAMP#,
    #leaveEndDate:TIMESTAMP#, #leaveType:CHAR#, #leaveTypeName:VARCHAR#,#leaveReason:VARCHAR#, #checkType:CHAR#
    ,#approveEmployee:VARCHAR#,#createTime:TIMESTAMP#,#modifyTime:TIMESTAMP#,#remark:VARCHAR#)
  </insert>
  <insert id="insertSelective" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    -->
    insert into tbl_employee_leave
    <dynamic prepend="(">
      <isNotNull prepend="," property="leaveId">
        leave_id
      </isNotNull>
      <isNotNull prepend="," property="employeeId">
        employee_id
      </isNotNull>
      <isNotNull prepend="," property="leaveStartDate">
        leave_start_date
      </isNotNull>
      <isNotNull prepend="," property="leaveEndDate">
        leave_end_date
      </isNotNull>
      <isNotNull prepend="," property="leaveType">
        leave_type
      </isNotNull>
      <isNotNull prepend="," property="leaveTypeName">
        leave_type_name
      </isNotNull>
      <isNotNull prepend="," property="leaveReason">
        leave_reason
      </isNotNull>
      <isNotNull prepend="," property="checkType">
        check_type
      </isNotNull>
      <isNotNull prepend="," property="approveEmployee">
        approve_employee
      </isNotNull>
      <isNotNull prepend="," property="createTime">
        create_time
      </isNotNull>
      <isNotNull prepend="," property="modifyTime">
        modify_time
      </isNotNull>
      <isNotNull prepend="," property="remark">
        REMARK
      </isNotNull>
      <isNotNull prepend="," property="leaveImg">
        leave_img
      </isNotNull>
      <!--<isNotNull prepend="," property="officalType" >
        offical_type
      </isNotNull>-->
      )
    </dynamic>
    values
    <dynamic prepend="(">
      <isNotNull prepend="," property="leaveId">
        #leaveId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="employeeId">
        #employeeId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="leaveStartDate">
        #leaveStartDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="leaveEndDate">
        #leaveEndDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="leaveType">
        #leaveType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="leaveTypeName">
        #leaveTypeName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="leaveReason">
        #leaveReason:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="checkType">
        #checkType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="approveEmployee">
        #approveEmployee:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="createTime">
        #createTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="modifyTime">
        #modifyTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="remark">
        #remark:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="leaveImg">
        #leaveImg:VARCHAR#
      </isNotNull>
      <!--
            <isNotNull prepend="," property="officalType" >
              #officalType:VARCHAR#
            </isNotNull>
      -->
      )
    </dynamic>
  </insert>


  <select id="countByCriteria" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeaveCriteria" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    -->
    select count(*) from tbl_employee_leave
    <include refid="tbl_employee_leave.Criteria_Where_Clause" />
  </select>
  <update id="updateByCriteriaSelective" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    -->
    update tbl_employee_leave
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.leaveId" >
        leave_id = #record.leaveId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.employeeId" >
        employee_id = #record.employeeId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.leaveStartDate" >
        leave_start_date = #record.leaveStartDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.leaveEndDate" >
        leave_end_date = #record.leaveEndDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.leaveType" >
        leave_type = #record.leaveType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.leaveTypeName" >
        leave_type_name = #record.leaveTypeName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.leaveReason" >
        leave_reason = #record.leaveReason:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.checkType" >
        check_type = #record.checkType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.approveEmployee" >
        approve_employee = #record.approveEmployee:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.createTime" >
        create_time = #record.createTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.modifyTime" >
        modify_time = #record.modifyTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.modifyTime" >
        REMARK = #record.remark:VARCHAR#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="tbl_employee_leave.Criteria_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="updateByCriteria" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    -->
    update tbl_employee_leave
    set leave_id = #record.leaveId:VARCHAR#,
      employee_id = #record.employeeId:VARCHAR#,
      leave_start_date = #record.leaveStartDate:TIMESTAMP#,
      leave_end_date = #record.leaveEndDate:TIMESTAMP#,
      leave_type = #record.leaveType:CHAR#,
      leave_type_name = #record.leaveTypeName:VARCHAR#,
      leave_reason = #record.leaveReason:VARCHAR#,
      check_type = #record.checkType:CHAR#,
      approve_employee = #record.approveEmployee:VARCHAR#,
      create_time = #record.createTime:TIMESTAMP#,
      modify_time = #record.modifyTime:TIMESTAMP#,
      REMARK = #record.remark:VARCHAR#
    <isParameterPresent >
      <include refid="tbl_employee_leave.Criteria_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="updateByPrimaryKeySelective" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    -->
    update tbl_employee_leave
    <dynamic prepend="set" >
      <isNotNull prepend="," property="employeeId" >
        employee_id = #employeeId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="leaveStartDate" >
        leave_start_date = #leaveStartDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="leaveEndDate" >
        leave_end_date = #leaveEndDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="leaveType" >
        leave_type = #leaveType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="leaveTypeName" >
        leave_type_name = #leaveTypeName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="leaveReason" >
        leave_reason = #leaveReason:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="checkType" >
        check_type = #checkType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="approveEmployee" >
        approve_employee = #approveEmployee:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="createTime" >
        create_time = #createTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="modifyTime" >
        modify_time = #modifyTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="remark" >
        REMARK = #remark:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="leaveImg" >
        leave_img = #leaveImg:VARCHAR#
      </isNotNull>
      <!--<isNotNull prepend="," property="officalType" >
        offical_type = #officalType:VARCHAR#
      </isNotNull>-->
    </dynamic>
    where leave_id = #leaveId:VARCHAR#
  </update>
  <update id="updateByPrimaryKey" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    -->
    update tbl_employee_leave
    set employee_id = #employeeId:VARCHAR#,
      leave_start_date = #leaveStartDate:TIMESTAMP#,
      leave_end_date = #leaveEndDate:TIMESTAMP#,
      leave_type = #leaveType:CHAR#,
      leave_type_name = #leaveTypeName:VARCHAR#,
      leave_reason = #leaveReason:VARCHAR#,
      check_type = #checkType:CHAR#,
      approve_employee = #approveEmployee:VARCHAR#,
      create_time = #createTime:TIMESTAMP#,
      modify_time = #modifyTime:TIMESTAMP#,
      REMARK = #remark:VARCHAR#
    where leave_id = #leaveId:VARCHAR#
  </update>
  <select id="selectEmployeeLeaveForApp" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" resultMap="ResultMapExt">
     SELECT *
     FROM tbl_employee_leave
    <include refid="tbl_employee_leave.Criteria_Where_Clause" />
  </select>
  <select id="selectEmployeeLeaveForAppSelf" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" resultMap="ResultMapExt1">
      SELECT *
      FROM tbl_employee_leave
      <dynamic prepend="where">
        <include refid="tbl_employee_leave.leave_Where_clause"/>
      </dynamic>
    ORDER BY modify_time DESC
  </select>
  <select id="selectEmployeeLeaveForApprove" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" resultMap="ResultMapExt2">
      SELECT *
      FROM tbl_employee_leave
      <dynamic prepend="where">
        <include refid="tbl_employee_leave.leave_Where_clause"/>
      </dynamic>
    ORDER BY modify_time DESC ,leave_type
  </select>
  
  <select id="countEmployeeLeaveList" resultClass="java.lang.Integer" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">
    select count(1)
    from tbl_employee_leave e,tbl_employee_info o ,tbl_department_info dep
    where e.employee_id = o.EMPLOYEE_ID
    and dep.DEPARTMENT_ID = o.DEPARTMENT_ID
    <!-- and o.IS_ON_DUTY = '01'--><!--显示离职人员的请假列表-->
    <isNotEmpty prepend="and" property="properties.area">
      dep.area=#properties.area:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.employeeName">
      o.EMPLOYEE_NAME like concat('%', #properties.employeeName:VARCHAR#, '%')
    </isNotEmpty>
    <isNotEmpty prepend="and" property="leaveType">
      e.leave_type=#leaveType:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="checkType">
      e.check_type=#checkType:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.beyondCompany">
  	   o.BEYOND_COMPANY = #properties.beyondCompany:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.departmentid">
 	   o.DEPARTMENT_ID = #properties.departmentid:VARCHAR#
    </isNotEmpty>
    
    <isNotEmpty prepend="and" property="properties.startTime">
      <![CDATA[
        date_format(e.leave_start_date,'%Y-%m-%d')>=#properties.startTime:VARCHAR#
       ]]>
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.endTime">
      <![CDATA[
        date_format(e.leave_end_date,'%Y-%m-%d')<=#properties.endTime:VARCHAR#
       ]]>
    </isNotEmpty>
  </select>
  <select id="countEmployeeLeaveApproveList" resultClass="java.lang.Integer" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">
    select count(1)
    from tbl_employee_leave e,tbl_employee_info o ,tbl_department_info dep
    where e.employee_id = o.EMPLOYEE_ID
    and dep.DEPARTMENT_ID = o.DEPARTMENT_ID
    and o.IS_ON_DUTY = '01'
    and e.check_type = '1'
    <isNotEmpty prepend="and" property="properties.area">
      dep.area=#properties.area:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.employeeName">
      o.EMPLOYEE_NAME like concat('%', #properties.employeeName:VARCHAR#, '%')
    </isNotEmpty>
    <isNotEmpty prepend="and" property="leaveType">
      e.leave_type=#leaveType:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.beyondCompany">
  	   o.BEYOND_COMPANY = #properties.beyondCompany:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.departmentid">
 	   o.DEPARTMENT_ID = #properties.departmentid:VARCHAR#
    </isNotEmpty>

    <isNotEmpty prepend="and" property="properties.startTime">
      <![CDATA[
        date_format(e.leave_start_date,'%Y-%m-%d')>=#properties.startTime:VARCHAR#
       ]]>
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.endTime">
      <![CDATA[
        date_format(e.leave_end_date,'%Y-%m-%d')<=#properties.endTime:VARCHAR#
       ]]>
    </isNotEmpty>
  </select>
  <select id="selectEmployeeLeaveList" resultMap="ResultMapExt3" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">
    select *
    from tbl_employee_leave e,tbl_employee_info o ,tbl_department_info dep,tbl_project_etc etc,tbl_project_info project
    where e.employee_id = o.EMPLOYEE_ID
    and dep.DEPARTMENT_ID = o.DEPARTMENT_ID
    and e.EMPLOYEE_ID = etc.employee_id
    and etc.contract_no = project.contract_no
    <!-- and o.IS_ON_DUTY = '01'--><!--显示离职人员的请假列表-->
    <isNotEmpty prepend="and" property="properties.area">
      dep.area=#properties.area:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.employeeName">
      o.EMPLOYEE_NAME like concat('%', #properties.employeeName:VARCHAR#, '%')
    </isNotEmpty>
    <isNotEmpty prepend="and" property="leaveType">
      e.leave_type=#leaveType:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="checkType">
      e.check_type=#checkType:VARCHAR#
    </isNotEmpty>
     <isNotEmpty prepend="and" property="properties.beyondCompany">
  	   o.BEYOND_COMPANY = #properties.beyondCompany:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.departmentid">
 	   o.DEPARTMENT_ID = #properties.departmentid:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.startTime">
      <![CDATA[
        date_format(e.leave_start_date,'%Y-%m-%d')>=#properties.startTime:VARCHAR#
       ]]>
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.endTime">
      <![CDATA[
        date_format(e.leave_end_date,'%Y-%m-%d')<=#properties.endTime:VARCHAR#
       ]]>
    </isNotEmpty>
    GROUP BY leave_id
    ORDER BY e.modify_time desc
  </select>

  <!--wjj-->
  <!--之前查询没有加上权限-->
  <select id="selectEmployeeLeaveList_areaList" resultMap="ResultMapExt" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">
    select *
    from tbl_employee_leave e,tbl_employee_info o ,tbl_department_info dep
    where e.employee_id = o.EMPLOYEE_ID
    and dep.DEPARTMENT_ID = o.DEPARTMENT_ID
    <isNotEmpty prepend="and" property="properties.areaList">
      <iterate open="(" close=")" conjunction="or" property="properties.areaList">
        dep.area=#properties.areaList[]#
      </iterate>
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.employeeName">
      o.EMPLOYEE_NAME like concat('%', #properties.employeeName:VARCHAR#, '%')
    </isNotEmpty>
    <isNotEmpty prepend="and" property="leaveType">
      e.leave_type=#leaveType:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="checkType">
      e.check_type=#checkType:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.beyondCompany">
      o.BEYOND_COMPANY = #properties.beyondCompany:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.departmentid">
      o.DEPARTMENT_ID = #properties.departmentid:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.startTime">
      <![CDATA[
        date_format(e.leave_start_date,'%Y-%m-%d')>=#properties.startTime:VARCHAR#
       ]]>
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.endTime">
      <![CDATA[
        date_format(e.leave_end_date,'%Y-%m-%d')<=#properties.endTime:VARCHAR#
       ]]>
    </isNotEmpty>
    ORDER BY e.modify_time desc
  </select>
  <select id="selectEmployeeLeaveApproveList" resultMap="ResultMapExt" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">
    select *
    from tbl_employee_leave e,tbl_employee_info o ,tbl_department_info dep
    where e.employee_id = o.EMPLOYEE_ID
    and dep.DEPARTMENT_ID = o.DEPARTMENT_ID
    and o.IS_ON_DUTY = '01'
    and e.check_type = '1'
    <isNotEmpty prepend="and" property="properties.areaList">
      <iterate open="(" close=")" conjunction="or" property="properties.areaList">
        dep.area=#properties.areaList[]#
      </iterate>
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.employeeName">
      o.EMPLOYEE_NAME like concat('%', #properties.employeeName:VARCHAR#, '%')
    </isNotEmpty>
    <isNotEmpty prepend="and" property="leaveType">
      e.leave_type=#leaveType:VARCHAR#
    </isNotEmpty>

    <isNotEmpty prepend="and" property="properties.beyondCompany">
      o.BEYOND_COMPANY = #properties.beyondCompany:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.departmentid">
      o.DEPARTMENT_ID = #properties.departmentid:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.startTime">
      <![CDATA[
        date_format(e.leave_start_date,'%Y-%m-%d')>=#properties.startTime:VARCHAR#
       ]]>
    </isNotEmpty>
    <isNotEmpty prepend="and" property="properties.endTime">
      <![CDATA[
        date_format(e.leave_end_date,'%Y-%m-%d')<=#properties.endTime:VARCHAR#
       ]]>
    </isNotEmpty>
    ORDER BY e.modify_time desc
  </select>
  <select id="selectEmployeeLeaveProject" parameterClass="java.lang.String" resultMap="BaseResultMap">
    SELECT e.*
    FROM tbl_employee_leave e,tbl_project_etc tc
    WHERE e.employee_id = tc.employee_id
    and tc.is_Leave='00'
    and tc.contract_no=#value:VARCHAR#
    <![CDATA[
      and date_format(e.leave_start_date,'%Y-%m-%d')<=date_format(curdate()-1,'%Y-%m-%d')
    ]]>
    <![CDATA[
     and date_format(e.leave_end_date,'%Y-%m-%d')>=date_format(curdate()-1,'%Y-%m-%d')
    ]]>
    AND e.check_type='1'
  </select>
  
  <!-- 查询公出以外的请假列表-->
    <select id="selectLeaveListByLeaveTypeSelf" resultMap="ResultMapExt1" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" >
	    select * from tbl_employee_leave
	    where employee_id = #employeeId:VARCHAR#
	    and leave_type != '8'
	    ORDER BY create_time desc
   </select>

  <!-- 查询请病假的请假列表-->
    <select id="selectLeaveListByEmployeeId" resultMap="ResultMapExt1" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" >
	    select * from tbl_employee_leave
	    where employee_id = #employeeId:VARCHAR#
	    and leave_type = '2'
   </select>
  <!-- 查询某月员工的请假天数  其中参数monthBegin和monthEnd根据选定的月份设定为本月开始日期和本月结束日期-->
    <select id="selectLeaveNumberEeachMonthByDate" resultMap="MonthLeaveDays" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">
      SELECT c.employee_id,c.EMPLOYEE_NAME,c.count+c.days AS leavedays,c.EMAIL,c.DEPARTMENT_NAME,c.AREA
      FROM
      (SELECT b.employee_id,b.EMPLOYEE_NAME,b.leave_end_date,b.leave_start_date,count(*) as count,days,b.EMAIL,d.DEPARTMENT_NAME,d.AREA
      FROM
      (SELECT a.employee_id,a.EMPLOYEE_NAME,a.leave_end_date,a.leave_start_date,DATEDIFF(a.leave_end_date,a.leave_start_date) as days,a.EMAIL,a.DEPARTMENT_ID
      FROM
      (SELECT e.employee_id,i.EMPLOYEE_NAME,i.EMAIL,i.DEPARTMENT_ID,
      <![CDATA[IF(e.leave_start_date < #properties.monthBeginTime:VARCHAR#,str_to_date(#properties.monthBeginTime:VARCHAR#,'%Y-%m-%d %H'),e.leave_start_date) AS leave_start_date ]]>,
      <![CDATA[IF(e.leave_end_date>#properties.monthEndTime:VARCHAR#,str_to_date(#properties.monthEndTime:VARCHAR#,'%Y-%m-%d %H'),e.leave_end_date) AS leave_end_date ]]>
      FROM tbl_employee_leave AS e
      LEFT JOIN
      tbl_employee_info AS i
      ON
      e.employee_id = i.EMPLOYEE_ID
      <![CDATA[WHERE e.leave_start_date < #properties.monthEndTime:VARCHAR# AND e.leave_end_date >#properties.monthBeginTime:VARCHAR# AND i.IS_ON_DUTY ='01']]>) AS a)AS b
      LEFT JOIN
      tbl_department_info d
      ON
      b.DEPARTMENT_ID = d.DEPARTMENT_ID
      GROUP BY b.employee_id) AS c
      ORDER BY leavedays DESC
    </select>


    <select id="selectEmployeeLeaveListPic" resultMap="ResultMapExt3" parameterClass="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">
        select *
        from tbl_employee_leave e,tbl_employee_info o ,tbl_department_info dep,tbl_project_etc etc,tbl_project_info project
        where e.employee_id = o.EMPLOYEE_ID
        and dep.DEPARTMENT_ID = o.DEPARTMENT_ID
        and e.EMPLOYEE_ID = etc.employee_id
        and etc.contract_no = project.contract_no
        <!-- and o.IS_ON_DUTY = '01'--><!--显示离职人员的请假列表-->
        <isNotEmpty prepend="and" property="properties.area">
            dep.area=#properties.area:VARCHAR#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.employeeName">
            o.EMPLOYEE_NAME like concat('%', #properties.employeeName:VARCHAR#, '%')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="leaveType">
            e.leave_type=#leaveType:VARCHAR#
        </isNotEmpty>
        <isEmpty prepend="and" property="leaveType">
            <!--"4""婚假", "5""产假" ,"6""陪产假" 9 产检假-->
            e.leave_type in('2','4','5','6','9')
        </isEmpty>
        <isNotEmpty prepend="and" property="checkType">
            e.check_type=#checkType:VARCHAR#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.beyondCompany">
            o.BEYOND_COMPANY = #properties.beyondCompany:VARCHAR#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.departmentid">
            o.DEPARTMENT_ID = #properties.departmentid:VARCHAR#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.startTime">
            <![CDATA[
        date_format(e.leave_start_date,'%Y-%m-%d')>=#properties.startTime:VARCHAR#
       ]]>
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.endTime">
            <![CDATA[
        date_format(e.leave_end_date,'%Y-%m-%d')<=#properties.endTime:VARCHAR#
       ]]>
        </isNotEmpty>
        and  e.leave_img  !=''
        GROUP BY leave_id
        ORDER BY e.modify_time desc
    </select>
</sqlMap>