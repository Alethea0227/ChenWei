<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="tbl_project_menu">
    <resultMap id="BaseResultMap" class="com.i2shopping.i2work.operation.core.project.model.ProjectMenu">
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Mon Jun 22 11:31:33 CST 2015.
        -->
        <result column="role_id" property="roleId" jdbcType="VARCHAR"/>
        <result column="role_checked" property="roleChecked" jdbcType="VARCHAR"/>
        <result column="role_entilenment" property="roleEntilenment" jdbcType="VARCHAR"/>
    </resultMap>


    <!-- 查询所有角色的项目 -->
    <select id="queryUserProjectMenu" resultMap="BaseResultMap"
            parameterClass="com.i2shopping.i2work.operation.core.project.model.ProjectMenu">
        SELECT * FROM tbl_project_menu
        where 1=1
        <isNotNull prepend="and" property="roleId">
            role_id = #roleId:VARCHAR#
        </isNotNull>
        <isNotNull prepend="and" property="roleChecked">
            role_checked = #roleChecked:VARCHAR#
        </isNotNull>
        <isNotNull prepend="and" property="roleEntilenment">
            role_entilenment = #roleEntilenment:VARCHAR#
        </isNotNull>
    </select>
    <update id="updateUserProjectMenu" parameterClass="com.i2shopping.i2work.operation.core.project.model.ProjectMenu">
        update tbl_project_menu
        set role_checked = #roleChecked:VARCHAR#
        where 1=1
        <isNotNull prepend="and" property="roleId">
            role_id = #roleId:VARCHAR#
        </isNotNull>
        <isNotNull prepend="and" property="roleEntilenment">
            role_entilenment = #roleEntilenment:VARCHAR#
        </isNotNull>
    </update>
    <insert id="insertUserRoleEnt" parameterClass="com.i2shopping.i2work.operation.core.project.model.ProjectMenu">
    insert into tbl_project_menu (role_id,role_checked,role_entilenment)
    values (#roleId:VARCHAR#, #roleChecked:VARCHAR#, #roleEntilenment:VARCHAR#)
  </insert>
    <!--查询特定角色对应的项目ID-->
    <select id="selectConByRoleId" parameterClass="java.lang.String" resultMap="BaseResultMap">
  SELECT *
  FROM tbl_project_menu
  WHERE role_checked=1
  AND role_id=#roleId:VARCHAR#
</select>

    <select id="selectProjectByRoleId" parameterClass="java.lang.String"
            resultMap="tbl_project_info.BaseResultMap">
      SELECT t2.* from tbl_project_menu t1,tbl_project_info t2
      WHERE t1.role_checked='1'
      and role_id=#roleId:VARCHAR#
      AND t1.role_entilenment=t2.contract_no
      and t2.plan_end_date>=SYSDATE();
  </select>
</sqlMap>