<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="tbl_integral_item" >
  <resultMap id="BaseResultMap" class="com.i2shopping.i2work.operation.core.integral.model.IntegralItem" >
    <result column="INTEGRAL_ITEM_ID" property="integralItemId" jdbcType="VARCHAR" />
    <result column="EMPLOYEE_ID" property="employeeId" jdbcType="VARCHAR" />
    <result column="INTEGRAL_ITEM_DATE" property="integralItemDate" jdbcType="TIMESTAMP" />
    <result column="EMP_INTEGRAL" property="empIntegral" jdbcType="INTEGER" />
    <result column="INTEGRAL_TYPE" property="integralType" jdbcType="CHAR" />
    <result column="INTEGRAL_REASON" property="integralReason" jdbcType="VARCHAR" />
  </resultMap>
  
  <resultMap id="ResultMapExt" class="com.i2shopping.i2work.operation.core.integral.model.IntegralItem" extends="BaseResultMap">
  	<result column="EMPLOYEE_NAME" property="employeeName" jdbcType="VARCHAR" />
  </resultMap>
  
  <sql id="Criteria_Where_Clause" >
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  
   <sql id="tbl_integral_item.integral_Where_Clause">
    	<isNotEmpty prepend="and" property="integralItemId">
				tbl_integral_item.INTEGRAL_ITEM_ID = #integralItemId:VARCHAR#
		</isNotEmpty>
    	<isNotEmpty prepend="and" property="employeeId">
				tbl_integral_item.EMPLOYEE_ID = #employeeId:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="integralItemDate">
				tbl_integral_item.INTEGRAL_ITEM_DATE = #integralItemDate:TIMESTAMP#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="empIntegral">
				tbl_integral_item.EMP_INTEGRAL = #empIntegral:INTEGER#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="integralType">
				tbl_integral_item.INTEGRAL_TYPE = #integralType:CHAR#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="integralReason">
				tbl_integral_item.INTEGRAL_REASON = #integralReason:VARCHAR#
		</isNotEmpty>
		order by INTEGRAL_ITEM_DATE desc;
    </sql>
  
  <select id="selectByIntergalItem" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.integral.model.IntegralItem" >
  		select * from tbl_integral_item
   		<dynamic prepend="where">
		    <include refid="tbl_integral_item.integral_Where_Clause" />
		</dynamic>
   </select>
   
   <select id="selectByIntergalItemType" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.integral.model.IntegralItem" >
  		select * from tbl_integral_item      
		where  EMPLOYEE_ID = #employeeId:VARCHAR#      
		<isNotEmpty prepend="AND" property="integralItemDate">
	     	date_format(INTEGRAL_ITEM_DATE,'%Y-%m-%d') = date_format(sysdate(),'%Y-%m-%d')
	    </isNotEmpty>        
		and  INTEGRAL_TYPE =#integralType:CHAR#  
		order by INTEGRAL_ITEM_DATE desc;

   </select>
   
  <!-- 查询昨日获取的积分 -->
   <select id="selectByEmployeeId" resultClass="java.lang.Integer" parameterClass="com.i2shopping.i2work.operation.core.integral.model.IntegralItem" >
  		select sum(EMP_INTEGRAL) from tbl_integral_item where 
  		EMPLOYEE_ID = #employeeId:VARCHAR# and
  		 <![CDATA[
		    	date_format(INTEGRAL_ITEM_DATE,'%Y-%m-%d') = date_format(#integralItemDate:TIMESTAMP#,'%Y-%m-%d')
          ]]>
  		group by EMPLOYEE_ID
   </select>
  
 <select id="selectByCriteria" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.integral.model.IntegralItemCriteria" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    -->
    select INTEGRAL_ITEM_ID, EMPLOYEE_ID, INTEGRAL_ITEM_DATE, EMP_INTEGRAL, INTEGRAL_TYPE,
      INTEGRAL_REASON
    from tbl_integral_item
    <isParameterPresent >
      <include refid="tbl_integral_item.Criteria_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.integral.model.IntegralItem" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    -->
    select INTEGRAL_ITEM_ID, EMPLOYEE_ID, INTEGRAL_ITEM_DATE, EMP_INTEGRAL, INTEGRAL_TYPE,
      INTEGRAL_REASON
    from tbl_integral_item
    where INTEGRAL_ITEM_ID = #integralItemId:VARCHAR#
  </select>
 <delete id="deleteByPrimaryKey" parameterClass="com.i2shopping.i2work.operation.core.integral.model.IntegralItem" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    -->
    delete from tbl_integral_item
    where INTEGRAL_ITEM_ID = #integralItemId:VARCHAR#
  </delete>
  <delete id="deleteByCriteria" parameterClass="com.i2shopping.i2work.operation.core.integral.model.IntegralItemCriteria" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    -->
    delete from tbl_integral_item
    <include refid="tbl_integral_item.Criteria_Where_Clause" />
  </delete>
  <insert id="insert" parameterClass="com.i2shopping.i2work.operation.core.integral.model.IntegralItem" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    -->
    insert into tbl_integral_item (INTEGRAL_ITEM_ID, EMPLOYEE_ID, INTEGRAL_ITEM_DATE, EMP_INTEGRAL,
      INTEGRAL_TYPE, INTEGRAL_REASON)
    values (#integralItemId:VARCHAR#, #employeeId:VARCHAR#, #integralItemDate:TIMESTAMP#,
      #empIntegral:INTEGER#, #integralType:CHAR#, #integralReason:VARCHAR#)
  </insert>
  <insert id="insertSelective" parameterClass="com.i2shopping.i2work.operation.core.integral.model.IntegralItem" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    -->
    insert into tbl_integral_item
    <dynamic prepend="(" >
      <isNotNull prepend="," property="integralItemId" >
        INTEGRAL_ITEM_ID
      </isNotNull>
      <isNotNull prepend="," property="employeeId" >
        EMPLOYEE_ID
      </isNotNull>
      <isNotNull prepend="," property="integralItemDate" >
        INTEGRAL_ITEM_DATE
      </isNotNull>
      <isNotNull prepend="," property="empIntegral" >
        EMP_INTEGRAL
      </isNotNull>
      <isNotNull prepend="," property="integralType" >
        INTEGRAL_TYPE
      </isNotNull>
      <isNotNull prepend="," property="integralReason" >
        INTEGRAL_REASON
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="integralItemId" >
        #integralItemId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="employeeId" >
        #employeeId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="integralItemDate" >
        #integralItemDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="empIntegral" >
        #empIntegral:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="integralType" >
        #integralType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="integralReason" >
        #integralReason:VARCHAR#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <select id="countByCriteria" parameterClass="com.i2shopping.i2work.operation.core.integral.model.IntegralItemCriteria" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    -->
    select count(*) from tbl_integral_item
    <include refid="tbl_integral_item.Criteria_Where_Clause" />
  </select>
  <update id="updateByCriteriaSelective" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    -->
    update tbl_integral_item
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.integralItemId" >
        INTEGRAL_ITEM_ID = #record.integralItemId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.employeeId" >
        EMPLOYEE_ID = #record.employeeId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.integralItemDate" >
        INTEGRAL_ITEM_DATE = #record.integralItemDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.empIntegral" >
        EMP_INTEGRAL = #record.empIntegral:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.integralType" >
        INTEGRAL_TYPE = #record.integralType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.integralReason" >
        INTEGRAL_REASON = #record.integralReason:VARCHAR#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="tbl_integral_item.Criteria_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="updateByCriteria" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    -->
    update tbl_integral_item
    set INTEGRAL_ITEM_ID = #record.integralItemId:VARCHAR#,
      EMPLOYEE_ID = #record.employeeId:VARCHAR#,
      INTEGRAL_ITEM_DATE = #record.integralItemDate:TIMESTAMP#,
      EMP_INTEGRAL = #record.empIntegral:INTEGER#,
      INTEGRAL_TYPE = #record.integralType:CHAR#,
      INTEGRAL_REASON = #record.integralReason:VARCHAR#
    <isParameterPresent >
      <include refid="tbl_integral_item.Criteria_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="updateByPrimaryKeySelective" parameterClass="com.i2shopping.i2work.operation.core.integral.model.IntegralItem" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    -->
    update tbl_integral_item
    <dynamic prepend="set" >
      <isNotNull prepend="," property="employeeId" >
        EMPLOYEE_ID = #employeeId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="integralItemDate" >
        INTEGRAL_ITEM_DATE = #integralItemDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="empIntegral" >
        EMP_INTEGRAL = #empIntegral:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="integralType" >
        INTEGRAL_TYPE = #integralType:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="integralReason" >
        INTEGRAL_REASON = #integralReason:VARCHAR#
      </isNotNull>
    </dynamic>
    where INTEGRAL_ITEM_ID = #integralItemId:VARCHAR#
  </update>
  <update id="updateByPrimaryKey" parameterClass="com.i2shopping.i2work.operation.core.integral.model.IntegralItem" >
    update tbl_integral_item
    set EMPLOYEE_ID = #employeeId:VARCHAR#,
      INTEGRAL_ITEM_DATE = #integralItemDate:TIMESTAMP#,
      EMP_INTEGRAL = #empIntegral:INTEGER#,
      INTEGRAL_TYPE = #integralType:CHAR#,
      INTEGRAL_REASON = #integralReason:VARCHAR#
    where INTEGRAL_ITEM_ID = #integralItemId:VARCHAR#
  </update>
   
    <sql id="integral_Item_Where_Clause">
  		<isNotEmpty prepend="and" property="properties.employeeName">
				info.employee_name like concat('%', #properties.employeeName:VARCHAR#, '%')
		</isNotEmpty>
  		<isNotEmpty prepend="and" property="properties.startTime">
  		<![CDATA[
  			date_format(item.integral_item_date ,'%Y-%m-%d') >= #properties.startTime:VARCHAR#
      	 ]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="properties.endTime">
		 <![CDATA[
		 		date_format(item.integral_item_date ,'%Y-%m-%d') <= #properties.endTime:VARCHAR#
		   ]]>
		</isNotEmpty>
  </sql>
   
  <!-- 查询积分明细， -->
   <select id="selectIntegralItemByPage" parameterClass="com.i2shopping.i2work.operation.core.integral.model.IntegralItem" resultMap="ResultMapExt">
    select item.*,info.employee_name from tbl_integral_item item , tbl_employee_info info where item.employee_id = info.employee_id 
  	 <include refid="tbl_integral_item.integral_Item_Where_Clause" />
  	 order by item.integral_item_date desc
  </select>
  
  <select id="countByIntegralItem" parameterClass="com.i2shopping.i2work.operation.core.integral.model.IntegralItem" resultClass="java.lang.Integer" >
	select  count(*) from tbl_integral_item item , tbl_employee_info info where item.employee_id = info.employee_id 
		<include refid="tbl_integral_item.integral_Item_Where_Clause" />
  </select>
</sqlMap>