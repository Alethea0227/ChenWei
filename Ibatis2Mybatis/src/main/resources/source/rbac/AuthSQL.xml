<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="TBL_AUTH" >
  <resultMap id="BaseResultMap" class="com.i2shopping.i2work.operation.core.auth.model.Auth" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->
    <result column="USERID" property="userid" jdbcType="CHAR" />
    <result column="LOGIN_ID" property="loginId" jdbcType="VARCHAR" />
    <result column="PASSWORD" property="password" jdbcType="VARCHAR" />
    <result column="USER_TYPE" property="userType" jdbcType="VARCHAR" />
    <result column="IS_LOCK" property="isLock" jdbcType="CHAR" />
    <result column="IS_ENABLE" property="isEnable" jdbcType="CHAR" />
     <result column="EMPLOYEE_ID" property="employeeId" jdbcType="CHAR" />
    <result column="PWD_VALID_TIME" property="pwdValidTime" jdbcType="TIMESTAMP" />
    <result column="IMSI" property="imsi" jdbcType="VARCHAR" />
    <result column="DEVICE_ID" property="deviceId" jdbcType="VARCHAR" />
  </resultMap>
  
	  
  <resultMap id="AuthInfoMap" class="com.i2shopping.i2work.operation.core.auth.model.AuthInfo" >
    <result column="LOGIN_ID" property="loginId" jdbcType="VARCHAR" />
    <result column="employee_id" property="employeeId" jdbcType="VARCHAR" />
    <result column="employee_name" property="employeeName" jdbcType="VARCHAR" />
    <result column="name" property="roleName" jdbcType="VARCHAR" />
  </resultMap>
  
  <!-- 返回的结果集-->
  	<resultMap id="BaseResultMapByEmployee" class="com.i2shopping.i2work.operation.core.auth.model.Auth" extends="BaseResultMap">
	    <result property="employeeInfo" select="tbl_employee_info.selectByPrimaryKey" column="EMPLOYEE_ID" />
	    
  	</resultMap>
  
  <sql id="Criteria_Where_Clause" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredC-r-iteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  
  
   <sql id="TBL_AUTH.Auth_Where_Clause">
    	<isNotEmpty prepend="and" property="userid">
				TBL_AUTH.USERID = #userid:VARCHAR#
		</isNotEmpty>
    	<isNotEmpty prepend="and" property="loginId">
				TBL_AUTH.LOGIN_ID = #loginId:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="password">
				TBL_AUTH.PASSWORD = #password:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="userType">
				TBL_AUTH.USER_TYPE = #userType:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="isEnable">
				TBL_AUTH.IS_ENABLE = #isEnable:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="employeeId">
				TBL_AUTH.EMPLOYEE_ID = #employeeId:VARCHAR#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="pwdValidTime" >
       			PWD_VALID_TIME = #pwdValidTime:TIMESTAMP#
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="imsi" >
       			IMSI = #imsi:VARCHAR#
      	</isNotEmpty>
      	<isNotEmpty prepend="and" property="deviceId" >
       			DEVICE_ID = #deviceId:VARCHAR#
      	</isNotEmpty>
    </sql>
    
  <select id="selectAuth" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.auth.model.Auth">
      select * from TBL_AUTH
      <dynamic prepend="where">
		    <include refid="TBL_AUTH.Auth_Where_Clause" />
		</dynamic>
  </select>
  
  <!-- 通过邮箱查找用户信息-->
  <select id="selectByEmail" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.auth.model.Auth" >
    select AUTH.*
    from TBL_AUTH AUTH, TBL_EMPLOYEE_INFO INFO 
    where AUTH.EMPLOYEE_ID = INFO.EMPLOYEE_ID
    and AUTH.PASSWORD = #password:VARCHAR#
    and INFO.EMAIL = #loginId:VARCHAR#
  </select>
  
  
  
  <select id="selectByCriteria" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.auth.model.AuthCriteria" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->
    select USERID, LOGIN_ID, PASSWORD, USER_TYPE, IS_LOCK, IS_ENABLE, PWD_VALID_TIME,EMPLOYEE_ID,IMSI
    from TBL_AUTH
    <isParameterPresent >
      <include refid="TBL_AUTH.Criteria_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  
  <select id="selectUserIdByName" parameterClass="java.lang.String" resultClass="java.lang.String">
      select USERID
      from TBL_AUTH
      where LOGIN_ID=#name:VARCHAR#
  </select>
  
  <select id="selectMallUserIdByName" parameterClass="java.lang.String" resultClass="java.lang.String">
      select A.USERID
      from TBL_AUTH A, B2C_MALL_USER_INFO B
      where LOGIN_ID=#name:VARCHAR#
      AND A.USERID = B.USERID
  </select>
  
  <select id="selectMerchantUserIdByName" parameterClass="java.lang.String" resultClass="java.lang.String">
      select A.USERID
      from TBL_AUTH A, B2C_MERCHANT_USER_INFO B
      where LOGIN_ID=#name:VARCHAR#
      AND A.USERID = B.USERID
  </select>
  
     <select id="selectEvaluationValue" resultMap="BaseResultMap" parameterClass="java.util.ArrayList" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->
    select *
    from TBL_AUTH 	
   <!--  	<dynamic prepend=" where USERID IN " >-->
    where USERID in 
		 <iterate open="("
								close=")" conjunction=",">
							#listevaid[]#
		</iterate> 
   </select>
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.auth.model.Auth" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->
    select USERID, LOGIN_ID, PASSWORD, USER_TYPE, IS_LOCK, IS_ENABLE, PWD_VALID_TIME,EMPLOYEE_ID,IMSI,DEVICE_ID
    from TBL_AUTH
    where USERID = #userid:CHAR#
  </select>
  <select id="selectByPrimaryKey1" resultMap="BaseResultMap" parameterClass="java.lang.String" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->
    select USERID, LOGIN_ID, PASSWORD, USER_TYPE, IS_LOCK, IS_ENABLE, PWD_VALID_TIME,EMPLOYEE_ID,IMSI
    from TBL_AUTH
    where USERID = #userid:CHAR#
  </select>
   <!-- 按操作员编号查询 -->
  <select id="selectAuthByLoginId" resultMap="BaseResultMap" parameterClass="java.lang.String">
  	select TBL_AUTH.*
    from TBL_AUTH
    where LOGIN_ID = #value:VARCHAR#
  </select>
  
    <select id="selectAuthByMemberId" resultMap="BaseResultMap" parameterClass="java.lang.String">
  	select TBL_AUTH.*
    from TBL_AUTH
    where USERID =#value:CHAR#
  </select>
  
  <select id="selectAuthByEvaluaterId" resultMap="BaseResultMap" parameterClass="java.lang.String">
  	select TBL_AUTH.*
    from TBL_AUTH
    where USERID =#value:CHAR#
  </select>
  
  
  <delete id="deleteByPrimaryKey" parameterClass="com.i2shopping.i2work.operation.core.auth.model.Auth" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->
    delete from TBL_AUTH
    where USERID = #userid:CHAR#
  </delete>
  <delete id="deleteByCriteria" parameterClass="com.i2shopping.i2work.operation.core.auth.model.AuthCriteria" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->
    delete from TBL_AUTH
    <include refid="TBL_AUTH.Criteria_Where_Clause" />
  </delete>
  <insert id="insert" parameterClass="com.i2shopping.i2work.operation.core.auth.model.Auth" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->
    insert into TBL_AUTH (USERID, LOGIN_ID, PASSWORD, USER_TYPE, IS_LOCK, IS_ENABLE, PWD_VALID_TIME,EMPLOYEE_ID,IMSI,DEVICE_ID)
    values (#userid:CHAR#, #loginId:VARCHAR#, #password:VARCHAR#, #userType:VARCHAR#, #isLock:CHAR#,
      #isEnable:CHAR#, #pwdValidTime:TIMESTAMP#,#employeeId:CHAR#, #imsi:VARCHAR#, #deviceId:VARCHAR#)
  </insert>
  <insert id="insertSelective" parameterClass="com.i2shopping.i2work.operation.core.auth.model.Auth" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->
    insert into TBL_AUTH
    <dynamic prepend="(" >
      <isNotNull prepend="," property="userid" >
        USERID
      </isNotNull>
      <isNotNull prepend="," property="loginId" >
        LOGIN_ID
      </isNotNull>
      <isNotNull prepend="," property="password" >
        PASSWORD
      </isNotNull>
      <isNotNull prepend="," property="userType" >
        USER_TYPE
      </isNotNull>
      <isNotNull prepend="," property="isLock" >
        IS_LOCK
      </isNotNull>
      <isNotNull prepend="," property="isEnable" >
        IS_ENABLE
      </isNotNull>
       <isNotNull prepend="," property="employeeId" >
        EMPLOYEE_ID
      </isNotNull>
      <isNotNull prepend="," property="pwdValidTime" >
        PWD_VALID_TIME
      </isNotNull>
      <isNotNull prepend="," property="imsi" >
        IMSI
      </isNotNull>
       <isNotNull prepend="," property="deviceId" >
        DEVICE_ID
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="userid" >
        #userid:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="loginId" >
        #loginId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="password" >
        #password:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="userType" >
        #userType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="isLock" >
        #isLock:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="isEnable" >
        #isEnable:CHAR#
      </isNotNull>
       <isNotNull prepend="," property="employeeId" >
        #employeeId:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="pwdValidTime" >
        #pwdValidTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="imsi" >
        #imsi:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceId" >
        #deviceId:VARCHAR#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <select id="countByCriteria" parameterClass="com.i2shopping.i2work.operation.core.auth.model.AuthCriteria" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->
    select count(*) from TBL_AUTH
    <include refid="TBL_AUTH.Criteria_Where_Clause" />
  </select>
  <update id="updateByCriteriaSelective" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->
    update TBL_AUTH
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.userid" >
        USERID = #record.userid:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.loginId" >
        LOGIN_ID = #record.loginId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.password" >
        PASSWORD = #record.password:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.userType" >
        USER_TYPE = #record.userType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.isLock" >
        IS_LOCK = #record.isLock:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.isEnable" >
        IS_ENABLE = #record.isEnable:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.employeeId" >
        EMPLOYEE_ID = #record.employeeId:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.pwdValidTime" >
        PWD_VALID_TIME = #record.pwdValidTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.imsi" >
        IMSI = #record.imsi:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.deviceId" >
        DEVICE_ID = #record.deviceId:VARCHAR#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="TBL_AUTH.Criteria_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="updateByCriteria" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->
    update TBL_AUTH
    set USERID = #record.userid:CHAR#,
      LOGIN_ID = #record.loginId:VARCHAR#,
      PASSWORD = #record.password:VARCHAR#,
      USER_TYPE = #record.userType:VARCHAR#,
      IS_LOCK = #record.isLock:CHAR#,
      IS_ENABLE = #record.isEnable:CHAR#,
      PWD_VALID_TIME = #record.pwdValidTime:TIMESTAMP#,
      IMSI = #record.imsi:VARCHAR#,
      DEVICE_ID = #record.deviceId:VARCHAR#
      
    <isParameterPresent >
      <include refid="TBL_AUTH.Criteria_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="updateByPrimaryKeySelective" parameterClass="com.i2shopping.i2work.operation.core.auth.model.Auth" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->
    update TBL_AUTH
    <dynamic prepend="set" >
      <isNotNull prepend="," property="loginId" >
        LOGIN_ID = #loginId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="password" >
        PASSWORD = #password:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="userType" >
        USER_TYPE = #userType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="isLock" >
        IS_LOCK = #isLock:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="isEnable" >
        IS_ENABLE = #isEnable:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="pwdValidTime" >
        PWD_VALID_TIME = #pwdValidTime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="imsi" >
        IMSI = #imsi:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deviceId" >
        DEVICE_ID = #deviceId:VARCHAR#
      </isNotNull>
    </dynamic>
    where EMPLOYEE_ID = #employeeId:CHAR#
  </update>
  <update id="updateByPrimaryKey" parameterClass="com.i2shopping.i2work.operation.core.auth.model.Auth" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->
    update TBL_AUTH
    set LOGIN_ID = #loginId:VARCHAR#,
      PASSWORD = #password:VARCHAR#,
      USER_TYPE = #userType:VARCHAR#,
      IS_LOCK = #isLock:CHAR#,
      IS_ENABLE = #isEnable:CHAR#,
      PWD_VALID_TIME = #pwdValidTime:TIMESTAMP#,
      IMSI = #imsi:VARCHAR#,
      DEVICE_ID = #deviceId:VARCHAR#
    where USERID = #userid:CHAR#
  </update>
  <update id="thawByUserId" parameterClass="com.i2shopping.i2work.operation.core.auth.model.Auth" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->
    update TBL_AUTH
    set  IS_LOCK = #isLock:CHAR#
    where USERID = #userid:CHAR#
  </update>
  <!-- 通过用户名查找用户信息-->
  <select id="selectByUsername" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.auth.model.Auth" >
    select *
    from TBL_AUTH 
    where login_id = #loginId:VARCHAR#
  </select>
  
   <!-- 通过用户id查找用户信息-->
  <select id="selectByUserId" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.auth.model.Auth" >
    select USERID, LOGIN_ID,PASSWORD, USER_TYPE, IS_LOCK, IS_ENABLE,PWD_VALID_TIME,IMSI
    from TBL_AUTH where USERID=#userid:VARCHAR#
  </select>
  <!-- 根据username(loginId)更新用户 -->
   <update id="updateAuthByUserName"  parameterClass="com.i2shopping.i2work.operation.core.auth.model.Auth">
	    update TBL_AUTH set PASSWORD = #password:VARCHAR# where LOGIN_ID = #loginId:VARCHAR#
  </update>
  
  
  
  <!-- 查询所有的操作员， -->
   <select id="selectUserInfo" parameterClass="com.i2shopping.i2work.operation.core.auth.model.Auth" resultMap="AuthInfoMap">
    select  auth.login_id, auth.employee_id, info.employee_name, role.name  from tbl_auth auth, tbl_employee_info info, tbl_role role,  tbl_user_role_rel rel
		where auth.employee_id = info.employee_id and  info.employee_id = rel.user_id and  rel.role_id = role.role_id and auth.user_type='2'and role.role_id != 'ROLE2000'
  </select>
  
  <select id="countUserInfo" parameterClass="com.i2shopping.i2work.operation.core.auth.model.Auth" resultClass="java.lang.Integer" >
	select  count(*) from tbl_auth auth, tbl_employee_info info, tbl_role role,  tbl_user_role_rel rel
		where auth.employee_id = info.employee_id and  info.employee_id = rel.user_id and  rel.role_id = role.role_id and auth.user_type='2' and role.role_id!='ROLE2000'
  </select>
  
</sqlMap>