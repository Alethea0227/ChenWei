<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="tbl_department_info" >
  <resultMap id="BaseResultMap" class="com.i2shopping.i2work.operation.core.department.model.DepartmentInfo" >
    <result column="DEPARTMENT_ID" property="departmentId" jdbcType="CHAR" />
    <result column="DEPARTMENT_NAME" property="departmentName" jdbcType="VARCHAR" />
    <result column="BEYOND_COMPANY" property="beyondCompany" jdbcType="VARCHAR" />
    <result column="AREA" property="area" jdbcType="VARCHAR" />
  </resultMap>

  <resultMap id="ExtResultMap" class="com.i2shopping.i2work.operation.core.department.model.DepartmentInfo" extends="BaseResultMap">
    <result property="company" select="tbl_company.selectByCompanyId" column="BEYOND_COMPANY"/>
  </resultMap>
  <!--  <resultMap id="BaseResultMapEx" extends="BaseResultMap" class="com.i2shopping.i2work.department.model.DepartmentInfo" >
    <result property="projectInfoList" select="tbl_project_info.selectProjectInfoByDepartMentId" column="department_id" />
  </resultMap> -->
  <resultMap id="BaseResultMapC" class="com.i2shopping.i2work.operation.core.project.model.ProjectInfo" >

    <result column="contract_no"  property="contractNo" jdbcType="VARCHAR" />
    <result column="project_name"  property="projectName" jdbcType="VARCHAR" />
    <result column="plan_start_date"  property="planStartDate" jdbcType="DATE" />
    <result column="plan_end_date"  property="planEndDate" jdbcType="DATE" />
  </resultMap>
  
  <sql id="department_Where_Clause">

    <isNotEmpty prepend="and" property="departmentId">
      tbl_department_info.DEPARTMENT_ID=#departmentId:CHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="beyondCompany">
      tbl_department_info.BEYOND_COMPANY=#beyondCompany:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="area">
      tbl_department_info.AREA = #area:VARCHAR#
    </isNotEmpty>
    <isNotEmpty prepend="and" property="departmentName">
      tbl_department_info.DEPARTMENT_NAME like '%'||#departmentName#||'%'
    </isNotEmpty>

  </sql>

  <sql id="Criteria_Where_Clause" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jun 22 12:22:21 CST 2015.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="selectByCriteria" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.department.model.DepartmentInfoCriteria" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jun 22 12:22:21 CST 2015.
    -->
    select *
    from tbl_department_info
    <isParameterPresent >
      <include refid="tbl_department_info.Criteria_Where_Clause" />
      <isNotNull property="orderByClause" >
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.department.model.DepartmentInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jun 22 12:22:21 CST 2015.
    -->
    select *
    from tbl_department_info
    where DEPARTMENT_ID = #departmentId:CHAR#
  </select>
  <delete id="deleteByPrimaryKey" parameterClass="com.i2shopping.i2work.operation.core.department.model.DepartmentInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jun 22 12:22:21 CST 2015.
    -->
    delete from tbl_department_info
    where DEPARTMENT_ID = #departmentId:CHAR#
  </delete>
  <delete id="deleteByCriteria" parameterClass="com.i2shopping.i2work.operation.core.department.model.DepartmentInfoCriteria" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jun 22 12:22:21 CST 2015.
    -->
    delete from tbl_department_info
    <include refid="tbl_department_info.Criteria_Where_Clause" />
  </delete>
  <insert id="insert" parameterClass="com.i2shopping.i2work.operation.core.department.model.DepartmentInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jun 22 12:22:21 CST 2015.
    -->
     insert into tbl_department_info (DEPARTMENT_ID, DEPARTMENT_NAME, BEYOND_COMPANY, AREA)
    values (#departmentId:CHAR#, #departmentName:VARCHAR#, #beyondCompany:VARCHAR#, #area:VARCHAR#)
  </insert>
  <insert id="insertSelective" parameterClass="com.i2shopping.i2work.operation.core.department.model.DepartmentInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jun 22 12:22:21 CST 2015.
    -->
   insert into tbl_department_info
    <dynamic prepend="(" >
      <isNotNull prepend="," property="departmentId" >
        DEPARTMENT_ID
      </isNotNull>
      <isNotNull prepend="," property="departmentName" >
        DEPARTMENT_NAME
      </isNotNull>
      <isNotNull prepend="," property="beyondCompany" >
        BEYOND_COMPANY
      </isNotNull>
      <isNotNull prepend="," property="area" >
        AREA
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="departmentId" >
        #departmentId:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="departmentName" >
        #departmentName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="beyondCompany" >
        #beyondCompany:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="area" >
        #area:VARCHAR#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <select id="countByCriteria" parameterClass="com.i2shopping.i2work.operation.core.department.model.DepartmentInfoCriteria" resultClass="java.lang.Integer" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jun 22 12:22:21 CST 2015.
    -->
    select count(*) from tbl_department_info
    <include refid="tbl_department_info.Criteria_Where_Clause" />
  </select>
  <update id="updateByCriteriaSelective" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jun 22 12:22:21 CST 2015.
    -->
    update tbl_department_info
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.departmentId" >
        DEPARTMENT_ID = #record.departmentId:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.departmentName" >
        DEPARTMENT_NAME = #record.departmentName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.beyondCompany" >
        BEYOND_COMPANY = #record.beyondCompany:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.area" >
        AREA = #record.area:VARCHAR#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="tbl_department_info.Criteria_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="updateByCriteria" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jun 22 12:22:21 CST 2015.
    -->
     update tbl_department_info
    set DEPARTMENT_ID = #record.departmentId:CHAR#,
      DEPARTMENT_NAME = #record.departmentName:VARCHAR#,
      BEYOND_COMPANY = #record.beyondCompany:VARCHAR#,
      AREA = #record.area:VARCHAR#
    <isParameterPresent >
      <include refid="tbl_department_info.Criteria_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="updateByPrimaryKeySelective" parameterClass="com.i2shopping.i2work.operation.core.department.model.DepartmentInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jun 22 12:22:21 CST 2015.
    -->
   update tbl_department_info
    <dynamic prepend="set" >
      <isNotNull prepend="," property="departmentName" >
        DEPARTMENT_NAME = #departmentName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="beyondCompany" >
        BEYOND_COMPANY = #beyondCompany:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="area" >
        AREA = #area:VARCHAR#
      </isNotNull>
    </dynamic>
    where DEPARTMENT_ID = #departmentId:CHAR#
  </update>
  <update id="updateByPrimaryKey" parameterClass="com.i2shopping.i2work.operation.core.department.model.DepartmentInfo" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jun 22 12:22:21 CST 2015.
    -->
     update tbl_department_info
    set DEPARTMENT_NAME = #departmentName:VARCHAR#,
      BEYOND_COMPANY = #beyondCompany:VARCHAR#,
      AREA = #area:VARCHAR#
    where DEPARTMENT_ID = #departmentId:CHAR#
  </update>
  <select id="selectByDepartmentId" resultMap="BaseResultMap" parameterClass="java.lang.String" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jun 22 12:22:21 CST 2015.
    -->
    select *
    from tbl_department_info
    where DEPARTMENT_ID = #value:VARCHAR#
  </select>
  <select id="selectDepartmentList" parameterClass="com.i2shopping.i2work.operation.core.department.model.DepartmentInfo" resultMap="ExtResultMap">
    select *
    from tbl_department_info
    <dynamic prepend="where">
      <include refid="tbl_department_info.department_Where_Clause"/>
    </dynamic>
  </select>
  
  <select id="selectDepartmentListLazy" parameterClass="com.i2shopping.i2work.operation.core.department.model.DepartmentInfo" resultMap="BaseResultMap">
    select *
    from tbl_department_info
    <dynamic prepend="where">
      <include refid="tbl_department_info.department_Where_Clause"/>
    </dynamic>
  </select>
  
  <select id="countDepartmentPage" resultClass="java.lang.Integer" parameterClass="com.i2shopping.i2work.operation.core.department.model.DepartmentInfo">
    select count(1)
    from tbl_department_info
    <dynamic prepend="where">
      <include refid="tbl_department_info.department_Where_Clause"/>
    </dynamic>
  </select>
  <select id="selectDepartmentByName" parameterClass="java.lang.String" resultMap="BaseResultMap">
    SELECT *
    FROM tbl_department_info
    WHERE DEPARTMENT_NAME=#value:VARCHAR #
  </select>



  <select id="selectEntilenment2"  resultMap="BaseResultMapC" parameterClass="com.i2shopping.i2work.operation.common.OnlineObject">

    <!--SELECT p.contract_no,p.project_name,p.plan_start_date,p.plan_end_date FROM tbl_project_info p-->
    <!--<isNotNull property="roleId" >-->
      <!--LEFT JOIN (-->
      <!--SELECT DISTINCT-->
      <!--dep.DEPARTMENT_ID-->
      <!--FROM-->
      <!--tbl_project_menu AS menu-->
      <!--LEFT JOIN tbl_project_info AS pro ON menu.ROLE_ENTILENMENT=pro.contract_no-->
      <!--LEFT JOIN tbl_department_info AS dep ON dep.DEPARTMENT_ID=pro.DEPARTMENT_ID-->
      <!--WHERE-->
      <!--menu.ROLE_ID =#roleId:VARCHAR#-->
      <!--AND menu.ROLE_CHECKED=1-->
      <!--AND LENGTH(menu.ROLE_ENTILENMENT)=11) AS a-->
      <!--ON a.DEPARTMENT_ID = p.DEPARTMENT_ID-->
    <!--</isNotNull>-->

    SELECT p.contract_no,p.project_name,p.plan_start_date,p.plan_end_date FROM tbl_project_info p
    <isNotNull property="roleId" >
      LEFT JOIN (
      SELECT DISTINCT
      dep.DEPARTMENT_ID
      FROM
      tbl_project_menu AS menu
      LEFT JOIN tbl_project_info AS pro ON menu.ROLE_ENTILENMENT=pro.contract_no
      LEFT JOIN tbl_department_info AS dep ON dep.DEPARTMENT_ID=pro.DEPARTMENT_ID
      WHERE
      menu.ROLE_ID =#roleId:VARCHAR#
      AND menu.ROLE_CHECKED=1
      AND LENGTH(menu.ROLE_ENTILENMENT)=11) AS a
      ON a.DEPARTMENT_ID = p.DEPARTMENT_ID
    </isNotNull>
    WHERE
    DATEDIFF(p.plan_end_date,NOW()) &lt; 7
    AND
    DATEDIFF(p.plan_end_date,NOW()) &gt; 0
  </select>


  <!-- 查询项目菜单 一级菜单 -->
  <select id="queryProjectMenu" parameterClass="com.i2shopping.i2work.operation.core.department.model.DepartmentInfo" resultMap="BaseResultMap">
     select
        dep.*
      from tbl_department_info dep
      where 1=1
      GROUP BY dep.area;
  </select>

  <!-- 查询项目菜单 二级菜单 -->
  <select id="queryProjectMenuS" parameterClass="com.i2shopping.i2work.operation.core.department.model.DepartmentInfo" resultMap="BaseResultMap">
    select
      dept.*
    from tbl_department_info dept
    where 1=1 GROUP BY dept.department_id desc
  </select>

<!--新加的SQL语句-->

    <resultMap id="BaseResultMapC" class="com.i2shopping.i2work.operation.core.project.model.ProjectMenu" >
        <result column="ROLE_ENTILENMENT"  property="roleEntilenment" jdbcType="VARCHAR" />
    </resultMap>

  <select id="selectEntilenment" parameterClass="java.lang.String" resultMap="BaseResultMap" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jun 22 12:22:21 CST 2015.

    select ROLE_ENTILENMENT from tbl_project_menu WHERE  ROLE_ID = #roleId:VARCHAR# AND ROLE_CHECKED =1
     -->
  <!--
  SELECT*FROM tbl_department_info WHERE DEPARTMENT_ID IN
    (

    select DEPARTMENT_ID from tbl_project_info WHERE  contract_no

    in(
    select ROLE_ENTILENMENT from tbl_project_menu WHERE  ROLE_ID =#roleId:VARCHAR# AND ROLE_CHECKED=1 AND LENGTH(ROLE_ENTILENMENT)=11
    )

    )
    -->
    SELECT *
    FROM tbl_department_info WHERE DEPARTMENT_ID IN
    (
    select DEPARTMENT_ID from tbl_role_department WHERE  ROLE_ID=#roleId:VARCHAR#
    )
  </select>

  <select id="selectDepartmentId" parameterClass="java.lang.String" resultClass="java.lang.String" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Mon Jun 22 12:22:21 CST 2015.
    -->
    select department_id from tbl_project_info WHERE  contract_no = #entilenment:VARCHAR#
  </select>
</sqlMap>