<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="tbl_sign_in_out_record" >
    <resultMap id="BaseResultMap" class="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" >
        <result column="contract_no" property="contractNo" jdbcType="VARCHAR" />
        <result column="employee_id" property="employeeId" jdbcType="CHAR" />
        <result column="sign_time" property="signTime" jdbcType="VARCHAR" />
        <result column="sign_location" property="signLocation" jdbcType="VARCHAR" />
        <result column="sign_in_time" property="signInTime" jdbcType="VARCHAR" />
        <result column="sign_out_time" property="signOutTime" jdbcType="VARCHAR" />
        <result column="sign_out_location" property="signOutLocation" jdbcType="VARCHAR" />
        <result column="sign_in_lon_and_lat" property="signInLonAndLat" jdbcType="VARCHAR" />
        <result column="sign_out_lon_and_lat" property="signOutLonAndLat" jdbcType="VARCHAR" />
    </resultMap>

    <resultMap id="SecondResultMap" class="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" >
        <result column="contract_no" property="contractNo" jdbcType="VARCHAR" />
        <result column="employee_id" property="employeeId" jdbcType="CHAR" />
        <result column="sign_time" property="signTime" jdbcType="VARCHAR" />
        <result column="sign_location" property="signLocation" jdbcType="VARCHAR" />
        <result column="sign_in_time" property="signInTime" jdbcType="VARCHAR" />
        <result column="sign_out_time" property="signOutTime" jdbcType="VARCHAR" />
        <result column="sign_out_location" property="signOutLocation" jdbcType="VARCHAR" />
    </resultMap>

    <resultMap id="ResultMapPage" class="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" extends="SecondResultMap">
         <!--<result column="OVERTIME_LABOUR" property="overtimeLabour" jdbcType="DECIMAL" />-->
        <!--<result column="STANDARD_LABOUR" property="standardLabour" jdbcType="DECIMAL" />-->
        <result column="EMPLOYEE_NAME" property="employeeName" jdbcType="VARCHAR" />
        <result column="project_name" property="projectName" jdbcType="VARCHAR" />
    </resultMap>

    <resultMap id="ResultMapP" class="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" extends="SecondResultMap">
        <!--<result column="OVERTIME_LABOUR" property="overtimeLabour" jdbcType="DECIMAL" />-->
        <!--<result column="STANDARD_LABOUR" property="standardLabour" jdbcType="DECIMAL" />-->
        <result column="EMPLOYEE_NAME" property="employeeName" jdbcType="VARCHAR" />
    </resultMap>
    <resultMap id="ResultMapVo" class="com.i2shopping.i2work.operation.core.sign.model.SignInOutVo">
        <result column="sign_location" property="signInLocation" jdbcType="VARCHAR" />
        <result column="sign_out_location" property="signOutLocation" jdbcType="VARCHAR" />
        <result column="sign_time" property="signTime" jdbcType="VARCHAR" />
        <result column="sign_in_time" property="signInTime" jdbcType="VARCHAR" />
        <result column="sign_out_time" property="signOutTime" jdbcType="VARCHAR" />
        <result column="contract_no" property="contractNo" jdbcType="VARCHAR" />
        <result column="project_name" property="projectName" jdbcType="VARCHAR" />
        <!-- <result column="standard_labour" property="standardLabour" jdbcType="DECIMAL" />
        <result column="overtime_labour" property="overTimeLabour"	jdbcType="DECIMAL" /> -->
        <result column="employee_id" property="employeeId" jdbcType="VARCHAR" />
        <result column="employee_name" property="employeeName" jdbcType="VARCHAR" />
        <result column="department_name" property="departmentName"	jdbcType="VARCHAR" />
    </resultMap>

    <sql id="Criteria_Where_Clause" >
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        -->
        <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
            <isEqual property="oredCriteria[].valid" compareValue="true" >
                (
                <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
                    $oredCriteria[].criteriaWithoutValue[]$
                </iterate>
                <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
                    $oredCriteria[].criteriaWithSingleValue[].condition$
                    #oredCriteria[].criteriaWithSingleValue[].value#
                </iterate>
                <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
                    $oredCriteria[].criteriaWithListValue[].condition$
                    <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
                        #oredCriteria[].criteriaWithListValue[].values[]#
                    </iterate>
                </iterate>
                <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
                    $oredCriteria[].criteriaWithBetweenValue[].condition$
                    #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
                    #oredCriteria[].criteriaWithBetweenValue[].values[1]#
                </iterate>
                )
            </isEqual>
        </iterate>
    </sql>
    <select id="selectByCriteria" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecordCriteria" >
        select contract_no, employee_id, sign_time, sign_location, sign_in_time, sign_out_time,sign_out_location,sign_in_lon_and_lat,sign_out_lon_and_lat
        from tbl_sign_in_out_record
        <isParameterPresent >
            <include refid="tbl_sign_in_out_record.Criteria_Where_Clause" />
            <isNotNull property="orderByClause" >
                order by $orderByClause$
            </isNotNull>
        </isParameterPresent>
    </select>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecordKey" >
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        -->
        select contract_no, employee_id, sign_time, sign_location, sign_in_time, sign_out_time,sign_out_location,sign_in_lon_and_lat,sign_out_lon_and_lat
        from tbl_sign_in_out_record
        where employee_id = #employeeId:CHAR#
        and sign_time = #signTime:VARCHAR#
    </select>
    <!-- 获取昨天的签到记录 -->
    <select id="selectLastDayByPrimaryKey" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecordKey" >
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        -->
        select contract_no, employee_id, sign_time, sign_location, sign_in_time, sign_out_time,sign_out_location,sign_in_lon_and_lat,sign_out_lon_and_lat
        from tbl_sign_in_out_record
        where employee_id = #employeeId:CHAR#
        <![CDATA[
      	and sign_time = date_format(date_sub(curdate(),interval 1 day),'%Y-%m-%d')
	   ]]>
    </select>

    <!-- 查询签到信息2015-0904 -->
    <select id="selectSignInfoByDate" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" >
        select *
        from tbl_sign_in_out_record
        <!-- where sign_time like concat('%',#signTime:VARCHAR#,'%') order by sign_time-->
        <dynamic prepend="where" >
            <isNotNull prepend="and" property="employeeId" >
                employee_id = #employeeId:CHAR#
            </isNotNull>
            <isNotNull prepend="and" property="signTime" >
                sign_time like CONCAT('%', #signTime:VARCHAR#, '%')
            </isNotNull>
        </dynamic>
    </select>

    <delete id="deleteByPrimaryKey" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecordKey" >
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        -->
        delete from tbl_sign_in_out_record
        where contract_no = #contractNo:VARCHAR#
        and employee_id = #employeeId:CHAR#
        and sign_time = #signTime:VARCHAR#
    </delete>
    <delete id="deleteByCriteria" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecordCriteria" >
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        -->
        delete from tbl_sign_in_out_record
        <include refid="tbl_sign_in_out_record.Criteria_Where_Clause" />
    </delete>
    <insert id="insert" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" >
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        -->
        insert into tbl_sign_in_out_record (contract_no, employee_id, sign_time, sign_location,
        sign_in_time, sign_out_time,sign_out_location,sign_in_lon_and_lat,sign_out_lon_and_lat)
        values (#contractNo:VARCHAR#, #employeeId:CHAR#, #signTime:VARCHAR#, #signLocation:VARCHAR#,
        #signInTime:VARCHAR#, #signOutTime:VARCHAR#, #signOutLocation:VARCHAR#, #signInLonAndLat:VARCHAR#, #signOutLonAndLat:VARCHAR#)
    </insert>
    <insert id="insertSelective" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" >
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        -->
        insert into tbl_sign_in_out_record
        <dynamic prepend="(" >
            <isNotNull prepend="," property="contractNo" >
                contract_no
            </isNotNull>
            <isNotNull prepend="," property="employeeId" >
                employee_id
            </isNotNull>
            <isNotNull prepend="," property="signTime" >
                sign_time
            </isNotNull>
            <isNotNull prepend="," property="signLocation" >
                sign_location
            </isNotNull>
            <isNotNull prepend="," property="signInTime" >
                sign_in_time
            </isNotNull>
            <isNotNull prepend="," property="signOutTime" >
                sign_out_time
            </isNotNull>
            <isNotNull prepend="," property="signOutLocation" >
                sign_out_location
            </isNotNull>
            <isNotNull prepend="," property="signInLonAndLat" >
                sign_in_lon_and_lat
            </isNotNull>
            <isNotNull prepend="," property="signOutLonAndLat" >
                sign_out_lon_and_lat
            </isNotNull>
            )
        </dynamic>
        values
        <dynamic prepend="(" >
            <isNotNull prepend="," property="contractNo" >
                #contractNo:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="employeeId" >
                #employeeId:CHAR#
            </isNotNull>
            <isNotNull prepend="," property="signTime" >
                #signTime:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="signLocation" >
                #signLocation:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="signInTime" >
                #signInTime:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="signOutTime" >
                #signOutTime:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="signOutLocation" >
                #signOutLocation:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="signInLonAndLat" >
                #signInLonAndLat:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="signOutLonAndLat" >
                #signOutLonAndLat:VARCHAR#
            </isNotNull>
            )
        </dynamic>
    </insert>
    <select id="countByCriteria" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecordCriteria" resultClass="java.lang.Integer" >
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        -->
        select count(*) from tbl_sign_in_out_record
        <include refid="tbl_sign_in_out_record.Criteria_Where_Clause" />
    </select>
    <update id="updateByCriteriaSelective" >
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        -->
        update tbl_sign_in_out_record
        <dynamic prepend="set" >
            <isNotNull prepend="," property="record.contractNo" >
                contract_no = #record.contractNo:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="record.employeeId" >
                employee_id = #record.employeeId:CHAR#
            </isNotNull>
            <isNotNull prepend="," property="record.signTime" >
                sign_time = #record.signTime:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="record.signLocation" >
                sign_location = #record.signLocation:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="record.signInTime" >
                sign_in_time = #record.signInTime:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="record.signOutTime" >
                sign_out_time = #record.signOutTime:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="record.signOutLocation" >
                sign_out_location = #record.signOutLocation:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="record.signInLonAndLat" >
                sign_in_lon_and_lat = #record.signInLonAndLat:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="record.signOutLonAndLat" >
                sign_out_lon_and_lat = #record.signOutLonAndLat:VARCHAR#
            </isNotNull>
        </dynamic>
        <isParameterPresent >
            <include refid="tbl_sign_in_out_record.Criteria_Where_Clause" />
        </isParameterPresent>
    </update>
    <update id="updateByCriteria" >
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        -->
        update tbl_sign_in_out_record
        set contract_no = #record.contractNo:VARCHAR#,
        employee_id = #record.employeeId:CHAR#,
        sign_time = #record.signTime:VARCHAR#,
        sign_location = #record.signLocation:VARCHAR#,
        sign_in_time = #record.signInTime:VARCHAR#,
        sign_out_time = #record.signOutTime:VARCHAR#,
        sign_out_location = #record.signOutLocation:VARCHAR#,
        sign_in_lon_and_lat = #record.signInLonAndLat:VARCHAR#,
        sign_out_lon_and_lat = #record.signOutLonAndLat:VARCHAR#
        <isParameterPresent >
            <include refid="tbl_sign_in_out_record.Criteria_Where_Clause" />
        </isParameterPresent>
    </update>
    <update id="updateByPrimaryKeySelective" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" >
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        -->
        update tbl_sign_in_out_record
        <dynamic prepend="set" >
            <isNotNull prepend="," property="signLocation" >
                sign_location = #signLocation:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="signInTime" >
                sign_in_time = #signInTime:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="signOutTime" >
                sign_out_time = #signOutTime:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="signOutLocation" >
                sign_out_location = #signOutLocation:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="signInLonAndLat" >
                sign_in_lon_and_lat = #signInLonAndLat:VARCHAR#
            </isNotNull>
            <isNotNull prepend="," property="signOutLonAndLat" >
                sign_out_lon_and_lat = #signOutLonAndLat:VARCHAR#
            </isNotNull>
        </dynamic>
        where contract_no = #contractNo:VARCHAR#
        and employee_id = #employeeId:CHAR#
        and sign_time = #signTime:VARCHAR#
    </update>
    <update id="updateByPrimaryKey" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" >
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        -->
        update tbl_sign_in_out_record
        set sign_location = #signLocation:VARCHAR#,
        sign_in_time = #signInTime:VARCHAR#,
        sign_out_time = #signOutTime:VARCHAR#,
        sign_out_location = #signOutLocation:VARCHAR#,
        sign_in_lon_and_lat = #signInLonAndLat:VARCHAR#,
        sign_out_lon_and_lat = #signOutLonAndLat:VARCHAR#
        where contract_no = #contractNo:VARCHAR#
        and employee_id = #employeeId:CHAR#
        and sign_time = #signTime:VARCHAR#
    </update>

    <select id="selectByProperties" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" >
        select employee_id, sign_time,sign_location,sign_in_time,sign_out_time,contract_no,sign_out_location,sign_in_lon_and_lat,sign_out_lon_and_lat
        from tbl_sign_in_out_record
        <dynamic prepend="where" >
            <isNotNull prepend="and" property="employeeId" >
                employee_id = #employeeId:CHAR#
            </isNotNull>
            <isNotNull prepend="and" property="signTime" >
                sign_time like CONCAT('%', curdate(), '%')
            </isNotNull>
            <isNotNull prepend="and" property="contractNo" >
                contract_no = #contractNo:VARCHAR#
            </isNotNull>
        </dynamic>
    </select>

    <select id="selectByPropertie" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" >
        select employee_id, sign_time,sign_location,sign_in_time,sign_out_time,contract_no,sign_out_location,sign_in_lon_and_lat,sign_out_lon_and_lat
        from tbl_sign_in_out_record
        <dynamic prepend="where" >
            <isNotNull prepend="and" property="signTime" >
                sign_time = #signTime:VARCHAR#
            </isNotNull>
            <isNotNull prepend="and" property="contractNo" >
                contract_no = #contractNo:VARCHAR#
            </isNotNull>
        </dynamic>
    </select>


    <select id="searchByConditions" resultMap="BaseResultMap" parameterClass="java.util.HashMap" >
        SELECT A.* FROM tbl_sign_in_out_record AS A,tbl_employee_info AS B
        WHERE A.employee_id = B.EMPLOYEE_ID
        <dynamic prepend=" " >
            <isNotEmpty prepend=" " property="contractNo" >
                and A.contract_no=#contractNo:CHAR#
            </isNotEmpty>
            <isNotEmpty prepend=" " property="startSignTime" >
                and A.sign_time >= #startSignTime:VARCHAR#
            </isNotEmpty>
            <isNotEmpty prepend=" " property="endSignTime" >
                <![CDATA[ and A.sign_time <= #endSignTime:VARCHAR# ]]>
            </isNotEmpty>
            <isNotEmpty prepend=" " property="employeeName" >
                and  B.EMPLOYEE_NAME LIKE '%$employeeName$%'
            </isNotEmpty>
        </dynamic>
    </select>

    <select id="getLastSignOutRecord" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" >
        SELECT * FROM tbl_sign_in_out_record
        <dynamic prepend="where" >
            <isNotNull prepend="and" property="employeeId" >
                employee_id = #employeeId:CHAR#
            </isNotNull>
            <isNotNull prepend="and" property="contractNo" >
                contract_no = #contractNo:VARCHAR#
            </isNotNull>
            <isNotNull prepend="and" property="signTime" >
                sign_time = #signTime:VARCHAR#
            </isNotNull>

            <isNotNull property="properties">
                <isNotNull prepend="and" property="properties.notSignOut">
                    sign_in_time is not null and sign_out_time is null
                </isNotNull>
            </isNotNull>
        </dynamic>
        ORDER BY sign_time DESC
        LIMIT 0,1
    </select>
    <select id="countByCriterias" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" resultClass="java.lang.Integer" >
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        -->
        select count(*) from tbl_sign_in_out_record
        <dynamic prepend="where" >
            <isNotNull prepend="and" property="contractNo" >
                contract_no = #contractNo:VARCHAR#
            </isNotNull>
            <isNotNull prepend="and" property="signTime" >
                sign_time = #signTime:VARCHAR#
            </isNotNull>
        </dynamic>
    </select>
    <select id="countByCriteriass" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" resultClass="java.lang.Integer" >
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        -->
        select count(distinct(employee_id))  from tbl_sign_in_out_record
        where  sign_time = #signTime:VARCHAR#
    </select>
    <select id="selectByPropertiePart" resultMap="SecondResultMap" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" >
        select employee_id, sign_time,sign_location,sign_in_time,sign_out_time,contract_no,sign_out_location
        from tbl_sign_in_out_record
        <dynamic prepend="where" >
            <isNotNull prepend="and" property="signTime" >
                sign_time = #signTime:VARCHAR#
            </isNotNull>
            <isNotNull prepend="and" property="contractNo" >
                contract_no = #contractNo:VARCHAR#
            </isNotNull>
        </dynamic>
    </select>
    <!-- 查询公司所有签到人数 -->
    <select id="selectSignInEmpex" parameterClass="java.util.Map" resultClass="java.lang.Integer" >
        select count(*) from tbl_sign_in_out_record sior, tbl_employee_info tei ,tbl_department_info tdi
        where sior.employee_id = tei.employee_id
        and tdi.DEPARTMENT_ID = tei.DEPARTMENT_ID
        and tei.is_on_duty='01'
        <isNotNull prepend="and" property="signTime">
            sior.sign_time = #signTime#
        </isNotNull>
        <isNotEmpty prepend="and" property="contractNo">
            sior.contract_no = #contractNo#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="companyId">
            tei.beyond_company = #companyId#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="area">
            tdi.area = #area:VARCHAR#
        </isNotEmpty>
    </select>

    <!-- 查询 未签退的数据  2016年2月29日  liyazhou 监控首页  -->
    <select id="selectSignOutEmpex" parameterClass="java.util.Map" resultClass="java.lang.Integer" >
        select count(*) from tbl_sign_in_out_record sior, tbl_employee_info tei,tbl_department_info tdi
        where sior.employee_id = tei.employee_id
        and  tdi.DEPARTMENT_ID = tei.DEPARTMENT_ID
        and tei.is_on_duty='01'
        and sior.sign_out_time !=''
        <isNotEmpty prepend="and" property="contractNo">
            sior.contract_no = #contractNo#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="companyId">
            tei.beyond_company = #companyId#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="signTime">
            date_format(sior.sign_time,'%Y-%m-%d') = date_format(#signTime:VARCHAR#,'%Y-%m-%d')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="area">
            tdi.area = #area:VARCHAR#
        </isNotEmpty>
    </select>


    <!-- 查询所有签到人数 -->
    <select id="selectSignInEmp" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" resultClass="java.lang.Integer" >
        select count(*) from tbl_sign_in_out_record
        where sign_time = #signTime:VARCHAR#
        <isNotEmpty prepend="and" property="contractNo">
            contract_no = #contractNo:VARCHAR#
        </isNotEmpty>
    </select>

    <sql id="sign_In_Out_Where_Clause">
        <isNotEmpty prepend="and" property="contractNo">
            sig.contract_no = #contractNo:VARCHAR#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.employeeName">
            emp.employee_name like concat('%', #properties.employeeName:VARCHAR#, '%')
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.startTime">
            <![CDATA[
      		sig.sign_time >= #properties.startTime:VARCHAR#
      	 ]]>
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.endTime">
            <![CDATA[
		    	sig.sign_time <= #properties.endTime:VARCHAR#
		   ]]>
        </isNotEmpty>
    </sql>
    <!-- 分页查询签到签退记录 -->
    <select id="countBySignInOutRecourd" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" resultClass="java.lang.Integer" >
        <!--select count(*)-->
        <!--from  tbl_employee_info emp,tbl_sign_in_out_record sig,tbl_project_info project ,tbl_department_info dept-->
        <!--where  sig.contract_no=project.contract_no-->
        <!--and emp.employee_id = sig.employee_id-->
        <!--&lt;!&ndash;-->
        <!--对于公出用户，如果个人部门不等于公出所在地区项目部门那么签到信息就查询不出来 注释掉下面语句-->
        <!--and emp.DEPARTMENT_ID = dept.DEPARTMENT_ID-->
        <!--&ndash;&gt;-->
        <!--and project.DEPARTMENT_ID = dept.DEPARTMENT_ID-->
        <!--<isNotEmpty prepend="and" property="properties.compayid">-->
            <!--emp.BEYOND_COMPANY = #properties.compayid:VARCHAR#-->
        <!--</isNotEmpty>-->
        <!--<isNotEmpty prepend="and" property="properties.deptmentId">-->
            <!--dept.DEPARTMENT_ID = #properties.deptmentId:VARCHAR#-->
        <!--</isNotEmpty>-->
        <!--<isNotEmpty prepend="and" property="properties.area">-->
            <!--dept.area = #properties.area:VARCHAR#-->
        <!--</isNotEmpty>-->
        <!--<include refid="tbl_sign_in_out_record.sign_In_Out_Where_Clause" />-->
        <!--<select id="selectSignInOutRecordPage" resultMap="ResultMapPage" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" >-->
            select count(*)
            from  tbl_employee_info emp,tbl_sign_in_out_record sig,tbl_project_info project ,tbl_department_info dept
            where sig.contract_no = project.contract_no
            and emp.employee_id = sig.employee_id
            <!--
            对于公出用户，如果个人部门不等于公出所在地区项目部门那么签到信息就查询不出来 注释掉下面语句
            and emp.DEPARTMENT_ID = dept.DEPARTMENT_ID
            -->
            and project.DEPARTMENT_ID = dept.DEPARTMENT_ID
            <isNotEmpty prepend="and" property="properties.companyId">
                emp.BEYOND_COMPANY = #properties.companyId:VARCHAR#
            </isNotEmpty>
            <isNotEmpty prepend="and" property="properties.departmentId">
                dept.DEPARTMENT_ID = #properties.departmentId:VARCHAR#
            </isNotEmpty>
            <isNotEmpty prepend="and" property="properties.area">
                dept.area = #properties.area:VARCHAR#
            </isNotEmpty>
            <include refid="tbl_sign_in_out_record.sign_In_Out_Where_Clause" />



    </select>
    <select id="selectSignInOutRecordPage" resultMap="ResultMapPage" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" >
        select sig.*, project.project_name, emp.employee_name
        from  tbl_employee_info emp,tbl_sign_in_out_record sig,tbl_project_info project ,tbl_department_info dept
        where sig.contract_no = project.contract_no
        and emp.employee_id = sig.employee_id
        <!--
        对于公出用户，如果个人部门不等于公出所在地区项目部门那么签到信息就查询不出来 注释掉下面语句
        and emp.DEPARTMENT_ID = dept.DEPARTMENT_ID
        -->
        and project.DEPARTMENT_ID = dept.DEPARTMENT_ID
        <isNotEmpty prepend="and" property="properties.companyId">
            emp.BEYOND_COMPANY = #properties.companyId:VARCHAR#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.departmentId">
            dept.DEPARTMENT_ID = #properties.departmentId:VARCHAR#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.area">
            dept.area = #properties.area:VARCHAR#
        </isNotEmpty>
        <include refid="tbl_sign_in_out_record.sign_In_Out_Where_Clause" />
        order by sig.sign_time desc
    </select>
    <!-- 组织报表数据 -->
    <select id="selectSignInOutRecordVo" resultMap="ResultMapVo" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" >
        <!-- select signer.sign_location, signer.sign_out_location,signer.sign_in_time,signer.sign_out_time,signer.sign_time, project.contract_no,project.project_name ,
                emp.employee_id, emp.employee_name
           from tbl_project_etc etc
          left join tbl_project_info project on etc.contract_no = project.contract_no
          left join  tbl_employee_info emp on etc.employee_id = emp.employee_id
          left join tbl_sign_in_out_record signer on etc.employee_id = signer.employee_id
              <isNotEmpty prepend="and" property="signTime">
                  <![CDATA[
                       date_format(signer.sign_in_time,'%Y-%m') = #signTime:VARCHAR#
                   ]]>
              </isNotEmpty>
          where
          etc.is_leave='00'
          <isNotEmpty prepend="and" property="contractNo">
                  project.contract_no= #contractNo:VARCHAR#
          </isNotEmpty>
          -->

        select
        signer.sign_location,
        signer.sign_out_location,
        signer.sign_in_time,
        signer.sign_out_time,
        signer.sign_time,
        project.project_actual_no as contract_no,
        project.project_name ,
        emp.employee_id,
        emp.employee_name,
        dept.DEPARTMENT_NAME
        from tbl_project_etc etc
        left join tbl_project_info project on etc.contract_no = project.contract_no
        left join  tbl_employee_info emp on etc.employee_id = emp.employee_id
        left join tbl_sign_in_out_record signer on etc.employee_id = signer.employee_id
        LEFT JOIN tbl_department_info dept on dept.DEPARTMENT_ID = project.DEPARTMENT_ID
        where  etc.is_leave='00'

        <isNotEmpty prepend="and" property="properties.exportStatTimeFrom">
            <![CDATA[
              date_format(signer.sign_in_time,'%Y-%m-%d') >= #properties.exportStatTimeFrom:VARCHAR#
		   ]]>
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.exportEndTimeFrom">
            <![CDATA[
                 date_format(signer.sign_in_time,'%Y-%m-%d') <= #properties.exportEndTimeFrom:VARCHAR#
		   ]]>
        </isNotEmpty>
        <isNotNull prepend="and" property="properties.defaultExportStatTimeFrom">
            <![CDATA[
                date_format(signer.sign_in_time,'%Y-%m') >=#properties.defaultExportStatTimeFrom:VARCHAR#
          ]]>
        </isNotNull>
        <isNotNull prepend="and" property="properties.defaultExportEndTimeFrom">
            <![CDATA[
                date_format(signer.sign_in_time,'%Y-%m') <=#properties.defaultExportEndTimeFrom:VARCHAR#
         ]]>
        </isNotNull>
        <isNotEmpty prepend="and" property="properties.exportComapyFrom">
            dept.BEYOND_COMPANY = #properties.exportComapyFrom:VARCHAR#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.exportDeptmentFrom">
            dept.DEPARTMENT_ID = #properties.exportDeptmentFrom:VARCHAR#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.exportContractNoFrom">
            project.contract_no = #properties.exportContractNoFrom:VARCHAR#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.exportAreaFrom">
            dept.AREA  = #properties.exportAreaFrom:VARCHAR#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.exportEmployeeName">
            emp.EMPLOYEE_NAME  = #properties.exportEmployeeName:VARCHAR#
        </isNotEmpty>
    </select>
    <select id="selectRecordBySelectDate" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord">
        SELECT *
        FROM tbl_sign_in_out_record
        <dynamic prepend="where">
            <isNotNull prepend="and" property="employeeId" >
                employee_id = #employeeId:CHAR#
            </isNotNull>
            <isNotNull prepend="and" property="signTime" >
                date_format(sign_time,'%Y-%m-%d') = date_format(#signTime:VARCHAR#,'%Y-%m-%d')
            </isNotNull>
        </dynamic>

    </select>

    <select id="selectSignRecordByContractNo" resultMap="ResultMapPage" parameterClass="java.util.List">
    SELECT r.*,ei.EMPLOYEE_NAME,pi.project_name
    FROM
    tbl_sign_in_out_record r,tbl_employee_info ei,tbl_project_info pi
    WHERE
    r.contract_no IN
        <iterate close=")" open="("  conjunction=",">
            <![CDATA[
                 #contractNo[]#
            ]]>
        </iterate>
    and
    r.employee_id =ei. employee_id
        and
    r.contract_no = pi.contract_no
    AND sign_time=CURDATE()
    </select>

    <select id="selectcountByContractNo" resultClass="java.lang.Integer" parameterClass="java.lang.String">
        SELECT count(*)
        FROM
        tbl_sign_in_out_record WHERE contract_no=# contractNo:VARCHAR # AND sign_time=CURDATE()
    </select>

    <select id="selectInfoBycontractNo" resultMap="ResultMapP" parameterClass="java.lang.String">
       SELECT ei.EMPLOYEE_NAME,sior.*
FROM
(SELECT *
FROM tbl_sign_in_out_record
WHERE contract_no = #contractNo:VARCHAR#) sior, tbl_employee_info ei
WHERE sior.employee_id = ei.EMPLOYEE_ID
    </select>

    <select id="selectCount" resultClass="java.lang.Integer" parameterClass="java.lang.String">
        SELECT count(*)
        FROM
        tbl_sign_in_out_record
        WHERE
        tbl_sign_in_out_record.contract_no=#contractNo:VARCHAR#
    </select>

    <!-- 组织报表数据 -->
    <select id="selectSignInOutRecordVoMonth" resultMap="ResultMapVo" parameterClass="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" >
        select
        signer.sign_location,
        signer.sign_out_location,
        count(signer.sign_in_time) as sign_in_time,
        count(signer.sign_out_time) as sign_out_time,
        signer.sign_time,
        project.project_actual_no as contract_no,
        project.project_name ,
        emp.employee_id,
        emp.employee_name,
        dept.DEPARTMENT_NAME
        from tbl_project_etc etc
        left join tbl_project_info project on etc.contract_no = project.contract_no
        left join  tbl_employee_info emp on etc.employee_id = emp.employee_id
        left join tbl_sign_in_out_record signer on etc.employee_id = signer.employee_id
        LEFT JOIN tbl_department_info dept on dept.DEPARTMENT_ID = project.DEPARTMENT_ID
        where  etc.is_leave='00'

        <isNotEmpty prepend="and" property="properties.exportStatTimeFrom">
            <![CDATA[
              date_format(signer.sign_in_time,'%Y-%m-%d') >= #properties.exportStatTimeFrom:VARCHAR#
		   ]]>
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.exportEndTimeFrom">
            <![CDATA[
                 date_format(signer.sign_in_time,'%Y-%m-%d') <= #properties.exportEndTimeFrom:VARCHAR#
		   ]]>
        </isNotEmpty>
        <isNotNull prepend="and" property="properties.defaultExportStatTimeFrom">
            <![CDATA[
                date_format(signer.sign_in_time,'%Y-%m') >=#properties.defaultExportStatTimeFrom:VARCHAR#
          ]]>
        </isNotNull>
        <isNotNull prepend="and" property="properties.defaultExportEndTimeFrom">
            <![CDATA[
                date_format(signer.sign_in_time,'%Y-%m') <=#properties.defaultExportEndTimeFrom:VARCHAR#
         ]]>
        </isNotNull>
        <isNotEmpty prepend="and" property="properties.exportComapyFrom">
            dept.BEYOND_COMPANY = #properties.exportComapyFrom:VARCHAR#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.exportDeptmentFrom">
            dept.DEPARTMENT_ID = #properties.exportDeptmentFrom:VARCHAR#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.exportContractNoFrom">
            project.contract_no = #properties.exportContractNoFrom:VARCHAR#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.exportAreaFrom">
            dept.AREA  = #properties.exportAreaFrom:VARCHAR#
        </isNotEmpty>
        <isNotEmpty prepend="and" property="properties.exportEmployeeName">
            emp.EMPLOYEE_NAME  = #properties.exportEmployeeName:VARCHAR#
        </isNotEmpty>
        GROUP BY EMPLOYEE_ID
        ORDER BY contract_no
    </select>
</sqlMap>