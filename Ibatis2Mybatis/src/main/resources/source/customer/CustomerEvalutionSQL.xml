<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="tbl_customer_evalution" >
  <resultMap id="BaseResultMap" class="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution" >
    <result column="EVALUTION_ID" property="evalutionId" jdbcType="VARCHAR" />
    <result column="EVALUTION_DATE" property="evalutionDate" jdbcType="TIMESTAMP" />
    <result column="CONTRACT_NO" property="contractNo" jdbcType="VARCHAR" />
    <result column="EMPLOYEE_ID" property="employeeId" jdbcType="VARCHAR" />
    <result column="EVALUTION_LEAVEL" property="evalutionLeavel" jdbcType="VARCHAR" />
    <result column="EVALUTION_ITEM" property="evalutionItem" jdbcType="VARCHAR" />
  </resultMap>
  
  <resultMap id="ResultMapExt" class="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution" extends="BaseResultMap">
	  <result column="EMPLOYEE_NAME" property="employeeName" jdbcType="VARCHAR" />
	  <result column="project_name" property="projectName" jdbcType="VARCHAR" />
	  
  </resultMap>
  
  <sql id="Criteria_Where_Clause" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Jun 25 20:21:27 CST 2015.
    -->
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate" >
      <isEqual property="oredCriteria[].valid" compareValue="true" >
        (
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and" >
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and" >
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and" >
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction="," >
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and" >
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  
  <!-- 查询客户评价 -->
  <select id="selectByCustomerEvalution" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution" >
  	select * from tbl_customer_evalution
  		where CONTRACT_NO=#contractNo:VARCHAR#
  		 <isNotEmpty prepend="AND" property="evalutionDate">
	      <![CDATA[
	      	date_format(EVALUTION_DATE,'%Y-%m-%d') = date_format(#evalutionDate:TIMESTAMP#,'%Y-%m-%d')
	      ]]>
	    </isNotEmpty>
        <isNotEmpty prepend="AND" property="employeeId">
          EMPLOYEE_ID=#employeeId:VARCHAR#
        </isNotEmpty>
  </select>
  
  <!--<select id="selectByCriteria" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalutionCriteria" >-->
    <!--select EVALUTION_ID, EVALUTION_DATE, CONTRACT_NO, EMPLOYEE_ID, EVALUTION_LEAVEL, EVALUTION_ITEM-->
    <!--from tbl_customer_evalution-->
    <!--<isParameterPresent >-->
      <!--<include refid="tbl_customer_evalution.Criteria_Where_Clause" />-->
      <!--<isNotNull property="orderByClause" >-->
        <!--order by $orderByClause$-->
      <!--</isNotNull>-->
    <!--</isParameterPresent>-->
  <!--</select>-->
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterClass="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Jun 25 20:21:27 CST 2015.
    -->
    select EVALUTION_ID, EVALUTION_DATE, CONTRACT_NO, EMPLOYEE_ID, EVALUTION_LEAVEL, EVALUTION_ITEM
    from tbl_customer_evalution
    where EVALUTION_ID = #evalutionId:VARCHAR#
  </select>
  <delete id="deleteByPrimaryKey" parameterClass="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Jun 25 20:21:27 CST 2015.
    -->
    delete from tbl_customer_evalution
    where EVALUTION_ID = #evalutionId:VARCHAR#
  </delete>
  <!--<delete id="deleteByCriteria" parameterClass="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalutionCriteria" >-->
    <!--&lt;!&ndash;-->
      <!--WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.-->
      <!--This element was generated on Thu Jun 25 20:21:27 CST 2015.-->
    <!--&ndash;&gt;-->
    <!--delete from tbl_customer_evalution-->
    <!--<include refid="tbl_customer_evalution.Criteria_Where_Clause" />-->
  <!--</delete>-->
  <insert id="insert" parameterClass="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Jun 25 20:21:27 CST 2015.
    -->
    insert into tbl_customer_evalution (EVALUTION_ID, EVALUTION_DATE, CONTRACT_NO, EMPLOYEE_ID,
      EVALUTION_LEAVEL, EVALUTION_ITEM)
    values (#evalutionId:VARCHAR#, #evalutionDate:TIMESTAMP#, #contractNo:VARCHAR#,
      #employeeId:VARCHAR#, #evalutionLeavel:VARCHAR#, #evalutionItem:VARCHAR#)
  </insert>
  <insert id="insertSelective" parameterClass="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Jun 25 20:21:27 CST 2015.
    -->
    insert into tbl_customer_evalution
    <dynamic prepend="(" >
      <isNotNull prepend="," property="evalutionId" >
        EVALUTION_ID
      </isNotNull>
      <isNotNull prepend="," property="evalutionDate" >
        EVALUTION_DATE
      </isNotNull>
      <isNotNull prepend="," property="contractNo" >
        CONTRACT_NO
      </isNotNull>
      <isNotNull prepend="," property="employeeId" >
        EMPLOYEE_ID
      </isNotNull>
      <isNotNull prepend="," property="evalutionLeavel" >
        EVALUTION_LEAVEL
      </isNotNull>
      <isNotNull prepend="," property="evalutionItem" >
        EVALUTION_ITEM
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(" >
      <isNotNull prepend="," property="evalutionId" >
        #evalutionId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="evalutionDate" >
        #evalutionDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="contractNo" >
        #contractNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="employeeId" >
        #employeeId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="evalutionLeavel" >
        #evalutionLeavel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="evalutionItem" >
        #evalutionItem:VARCHAR#
      </isNotNull>
      )
    </dynamic>
  </insert>
  <!--<select id="countByCriteria" parameterClass="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalutionCriteria" resultClass="java.lang.Integer" >
    &lt;!&ndash;
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Jun 25 20:21:27 CST 2015.
    &ndash;&gt;
    select count(*) from tbl_customer_evalution
    <include refid="tbl_customer_evalution.Criteria_Where_Clause" />
  </select>-->
  <update id="updateByCriteriaSelective" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Jun 25 20:21:27 CST 2015.
    -->
    update tbl_customer_evalution
    <dynamic prepend="set" >
      <isNotNull prepend="," property="record.evalutionId" >
        EVALUTION_ID = #record.evalutionId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.evalutionDate" >
        EVALUTION_DATE = #record.evalutionDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.contractNo" >
        CONTRACT_NO = #record.contractNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.employeeId" >
        EMPLOYEE_ID = #record.employeeId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.evalutionLeavel" >
        EVALUTION_LEAVEL = #record.evalutionLeavel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.evalutionItem" >
        EVALUTION_ITEM = #record.evalutionItem:VARCHAR#
      </isNotNull>
    </dynamic>
    <isParameterPresent >
      <include refid="tbl_customer_evalution.Criteria_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="updateByCriteria" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Jun 25 20:21:27 CST 2015.
    -->
    update tbl_customer_evalution
    set EVALUTION_ID = #record.evalutionId:VARCHAR#,
      EVALUTION_DATE = #record.evalutionDate:TIMESTAMP#,
      CONTRACT_NO = #record.contractNo:VARCHAR#,
      EMPLOYEE_ID = #record.employeeId:VARCHAR#,
      EVALUTION_LEAVEL = #record.evalutionLeavel:VARCHAR#,
      EVALUTION_ITEM = #record.evalutionItem:VARCHAR#
    <isParameterPresent >
      <include refid="tbl_customer_evalution.Criteria_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="updateByPrimaryKeySelective" parameterClass="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Jun 25 20:21:27 CST 2015.
    -->
    update tbl_customer_evalution
    <dynamic prepend="set" >
      <isNotNull prepend="," property="evalutionDate" >
        EVALUTION_DATE = #evalutionDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="contractNo" >
        CONTRACT_NO = #contractNo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="employeeId" >
        EMPLOYEE_ID = #employeeId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="evalutionLeavel" >
        EVALUTION_LEAVEL = #evalutionLeavel:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="evalutionItem" >
        EVALUTION_ITEM = #evalutionItem:VARCHAR#
      </isNotNull>
    </dynamic>
    where EVALUTION_ID = #evalutionId:VARCHAR#
  </update>
  <update id="updateByPrimaryKey" parameterClass="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution" >
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Jun 25 20:21:27 CST 2015.
    -->
    update tbl_customer_evalution
    set EVALUTION_DATE = #evalutionDate:TIMESTAMP#,
      CONTRACT_NO = #contractNo:VARCHAR#,
      EMPLOYEE_ID = #employeeId:VARCHAR#,
      EVALUTION_LEAVEL = #evalutionLeavel:VARCHAR#,
      EVALUTION_ITEM = #evalutionItem:VARCHAR#
    where EVALUTION_ID = #evalutionId:VARCHAR#
  </update>
  
   <sql id="customer_Where_Clause">
  		<isNotEmpty prepend="and" property="contractNo">
				customer.contract_no = #contractNo:VARCHAR#
      </isNotEmpty>
  		<isNotEmpty prepend="and" property="properties.startTime">
  		<![CDATA[
      		date_format(customer.evalution_date ,'%Y-%m-%d')  >= #properties.startTime:VARCHAR#
      	 ]]>
		</isNotEmpty>
		<isNotEmpty prepend="and" property="properties.endTime">
		 <![CDATA[
		    	date_format(customer.evalution_date ,'%Y-%m-%d')  <= #properties.endTime:VARCHAR#
		   ]]>
		</isNotEmpty>
  </sql>
  
   <!-- 分页查询所有客户评级 -->
   <select id="selectCustomerEvalutionByPage" parameterClass="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution" resultMap="ResultMapExt">
    select customer.*, info.customer_name employee_name, project.project_name from tbl_customer_evalution customer , tbl_customer_info info , tbl_project_info project
		where  customer.employee_id = info.customer_id
		and customer.contract_no = project.contract_no
      <include refid="tbl_customer_evalution.customer_Where_Clause" />
  </select>
  
  <select id="countEvalutionByPage" parameterClass="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution" resultClass="java.lang.Integer" >
	  select count(*) from tbl_customer_evalution customer , tbl_customer_info info , tbl_project_info project
		where  customer.employee_id = info.customer_id
		and customer.contract_no = project.contract_no
      <include refid="tbl_customer_evalution.customer_Where_Clause" />
  </select>
  
</sqlMap>