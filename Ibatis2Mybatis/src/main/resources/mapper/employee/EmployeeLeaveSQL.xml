<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="tbl_employee_leave">
  <resultMap id="BaseResultMap" type="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    -->
    <result column="leave_id" property="leaveId" jdbcType="VARCHAR"/>
    <result column="employee_id" property="employeeId" jdbcType="VARCHAR"/>
    <result column="leave_start_date" property="leaveStartDate" jdbcType="TIMESTAMP"/>
    <result column="leave_end_date" property="leaveEndDate" jdbcType="TIMESTAMP"/>
    <result column="leave_type" property="leaveType" jdbcType="CHAR"/>
    <result column="leave_type_name" property="leaveTypeName" jdbcType="VARCHAR"/>
    <result column="leave_reason" property="leaveReason" jdbcType="VARCHAR"/>
    <result column="check_type" property="checkType" jdbcType="CHAR"/>
    <result column="approve_employee" property="approveEmployee" jdbcType="VARCHAR"/>
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
    <result column="modify_time" property="modifyTime" jdbcType="TIMESTAMP"/>
    <result column="REMARK" property="remark" jdbcType="VARCHAR"/>
  </resultMap>
  <resultMap id="BaseResultMap2" type="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    -->
    <result column="leave_id" property="leaveId" jdbcType="VARCHAR"/>
    <result column="employee_id" property="employeeId" jdbcType="VARCHAR"/>
    <result column="leave_start_date" property="leaveStartDate" jdbcType="TIMESTAMP"/>
    <result column="leave_end_date" property="leaveEndDate" jdbcType="TIMESTAMP"/>
    <result column="leave_type" property="leaveType" jdbcType="CHAR"/>
    <result column="leave_type_name" property="leaveTypeName" jdbcType="VARCHAR"/>
    <result column="leave_reason" property="leaveReason" jdbcType="VARCHAR"/>
    <result column="check_type" property="checkType" jdbcType="CHAR"/>
    <result column="approve_employee" property="approveEmployee" jdbcType="VARCHAR"/>
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
    <result column="modify_time" property="modifyTime" jdbcType="TIMESTAMP"/>
    <result column="REMARK" property="remark" jdbcType="VARCHAR"/>
    <result column="leave_img" property="leaveImg" jdbcType="VARCHAR"/>
  </resultMap>
  <resultMap id="ResultMapExt" extends="BaseResultMap" type="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">
    <association property="approveEmployeeVo" select="tbl_employee_info_vo.selectByEmployeeIdForOther" column="approve_employee"/>
    <association property="employeeInfoVo" select="tbl_employee_info_vo.selectByEmployeeIdForOther" column="employee_id"/>
  </resultMap>
  <resultMap id="ResultMapExt1" extends="BaseResultMap2" type="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">
    <!--<result property="officalType" column="offical_type" javaType="java.lang.String"/>-->
    <association property="approveEmployeeVo" select="tbl_employee_info_vo.selectByEmployeeIdForOther" column="approve_employee"/>
  </resultMap>
  <!-- 附带请假证明材料 -->
  <resultMap id="ResultMapExt2" extends="BaseResultMap2" type="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">
    <association property="approveEmployeeVo" select="tbl_employee_info_vo.selectByEmployeeIdForOther" column="approve_employee"/>
  </resultMap>
  <resultMap id="ResultMapExt2" extends="BaseResultMap" type="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">
    <association property="employeeInfoVo" select="tbl_employee_info_vo.selectByEmployeeIdForOther" column="employee_id"/>
  </resultMap>
  <resultMap id="ResultMapExt3" extends="BaseResultMap" type="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">
    <association property="approveEmployeeVo" select="tbl_employee_info_vo.selectByEmployeeIdForOther" column="approve_employee"/>
    <association property="employeeInfoVo" select="tbl_employee_info_vo.selectByEmployeeIdForOther" column="employee_id"/>
    <result column="project_name" property="projectName" jdbcType="VARCHAR"/>
    <result column="project_actual_no" property="contract_no" jdbcType="VARCHAR"/>
    <result column="leave_img" property="leaveImg" jdbcType="VARCHAR"/>
  </resultMap>
  <resultMap id="MonthLeaveDays" type="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeaveMonthDays">
    <result column="employee_id" property="employeeId" jdbcType="VARCHAR"/>
    <result column="EMPLOYEE_NAME" property="employeeName" jdbcType="VARCHAR"/>
    <result column="leavedays" property="leaveDays" jdbcType="VARCHAR"/>
    <result column="EMAIL" property="email" jdbcType="VARCHAR"/>
    <result column="DEPARTMENT_NAME" property="departmentName" jdbcType="VARCHAR"/>
    <result column="AREA" property="area" jdbcType="VARCHAR"/>
  </resultMap>
  <sql id="leave_Where_clause"> 
    <if test="employeeId != null and employeeId != ''">and tbl_employee_leave.employee_id=#{employeeId:VARCHAR}</if>  
    <if test="approveEmployee != null and approveEmployee != ''">and tbl_employee_leave.approve_employee=#{approveEmployee:VARCHAR}</if>  
    <if test="leaveType != null and leaveType != ''">and tbl_employee_leave.leave_type=#{leaveType:VARCHAR}</if>  
    <if test="checkType != null and checkType != ''">and tbl_employee_leave.check_type=#{checkType:VARCHAR}</if> 
  </sql>
  <sql id="Criteria_Where_Clause"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    -->  
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate"> 
      <if test="oredCriteria[].valid!= null and oredCriteria[].valid == 'true'.toString()">( 
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and">$oredCriteria[].criteriaWithoutValue[]$</iterate>  
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and">$oredCriteria[].criteriaWithSingleValue[].condition$ #{oredCriteria[].criteriaWithSingleValue[].value}</iterate>  
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and">$oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction=",">#{oredCriteria[].criteriaWithListValue[].values[]}</iterate> 
        </iterate>  
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and">$oredCriteria[].criteriaWithBetweenValue[].condition$ #{oredCriteria[].criteriaWithBetweenValue[].values[0]} and #{oredCriteria[].criteriaWithBetweenValue[].values[1]}</iterate> )
      </if> 
    </iterate> 
  </sql>
  <select id="getEmployeeLeave" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">select * from tbl_employee_leave tel ,tbl_employee_info tei ,tbl_department_info di where 
    <trim prefix="tel.employee_id IN "> 
      <if test="properties != null"> 
        <if test="properties.employeeIdList != null"> 
          <iterate property="properties.employeeIdList" open="(" close=")" conjunction=",">#{properties.employeeIdList[]}</iterate> 
        </if> 
      </if> 
    </trim> and tel.employee_id = tei.EMPLOYEE_ID and tei.DEPARTMENT_ID = di.DEPARTMENT_ID<![CDATA[
		    and	date_format(leave_end_date,'%Y-%m-%d') >= #{properties.queryDate:VARCHAR}
		    and date_format(leave_start_date,'%Y-%m-%d') <= #{properties.queryDate:VARCHAR}
          ]]>  
    <if test="properties.area != null">and di.area = #{properties.area:VARCHAR}</if> 
  </select>
  <!-- 查询请假开始时间小于库里结束时间 -->
  <select id="selectByPrimaryStartTime" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">select * from tbl_employee_leave where employee_id = #{employeeId:VARCHAR} and check_type!='2' and<![CDATA[
		    	date_format(leave_end_date,'%Y-%m-%d %H:%i:%s') > date_format(#{leaveStartDate:TIMESTAMP},'%Y-%m-%d %H:%i:%s')
		    	and date_format(leave_start_date,'%Y-%m-%d %H:%i:%s') < date_format(#{leaveStartDate:TIMESTAMP},'%Y-%m-%d %H:%i:%s')
          ]]> </select>
  <!-- 批处理执行  查询开始和结束时间 -->
  <select id="queryEmployeeLeave" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">select * from tbl_employee_leave tel where tel.check_type = '1'<![CDATA[
        and date_format(tel.leave_start_date,'%Y-%m-%d') <= date_format(#{leaveStartDate:TIMESTAMP},'%Y-%m-%d')
        and date_format(tel.leave_end_date,'%Y-%m-%d') >= date_format(#{leaveEndDate:TIMESTAMP},'%Y-%m-%d')
    ]]> and tel.employee_id = #{employeeId:VARCHAR}</select>
  <!-- 查询已审批公出数据 -->
  <select id="selectByPrimaryleaveType" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">select * from tbl_employee_leave where employee_id = #{employeeId:VARCHAR} and check_type ='1' and leave_type ='8' and<![CDATA[
		    	date_format(leave_end_date,'%Y-%m-%d %H:%i:%s') >= date_format(now(),'%Y-%m-%d %H:%i:%s')
		    	and date_format(leave_start_date,'%Y-%m-%d %H:%i:%s') <= date_format(now(),'%Y-%m-%d %H:%i:%s')
          ]]> </select>
  <!-- 查询某个人有效未审批的请假数据 -->
  <select id="selectLeaveByEmployeeId" resultMap="BaseResultMap2" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">select * from tbl_employee_leave where check_type =#{checkType:VARCHAR} and leave_type !=10
    <if test="approveEmployee != null and approveEmployee != ''">approve_employee =#{approveEmployee:VARCHAR}</if>  
    <if test="employeeId != null and employeeId != ''">employee_id = #{employeeId:VARCHAR}</if> and <![CDATA[
		    	date_format(leave_end_date,'%Y-%m-%d %H:%i:%s') >= date_format(now(),'%Y-%m-%d %H:%i:%s')
          ]]> 
  </select>
  <!-- 查询报备数据 报备 leave_type 10-->
  <select id="selectLeaveByEmployeeIdLeaveType" resultMap="BaseResultMap2" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">select * from tbl_employee_leave tel where 1=1 
    <if test="checkType != null and checkType != ''">tel.check_type =#{checkType:VARCHAR}</if>  
    <if test="approveEmployee != null and approveEmployee != ''">tel.approve_employee =#{approveEmployee:VARCHAR}</if>  
    <if test="employeeId != null and employeeId != ''">tel.employee_id = #{employeeId:VARCHAR}</if>  
    <if test="leaveType != null and leaveType != ''">tel.leave_type = #{leaveType:VARCHAR}</if>  <![CDATA[
        and DATEDIFF(NOW(),tel.leave_start_date)<4 and DATEDIFF(NOW(),tel.leave_start_date)>=0
        and DATEDIFF(NOW(),tel.leave_end_date)<4 and DATEDIFF(NOW(),tel.leave_end_date)>=0
      ]]> 
  </select>
  <!-- 查询当月用户请假记录 -->
  <select id="selectByEmployeeLeave" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave"> 
    <!--
      select * from tbl_project_etc etc, tbl_employee_leave lea
      where etc.employee_id = lea.employee_id
      <isNotNull prepend="and" property="properties.exportTime">
      <![CDATA[
      (
            date_format(lea.leave_start_date,'%Y-%m') =#{properties.exportTime:VARCHAR}
            or
            date_format(lea.leave_end_date,'%Y-%m') = #{properties.exportTime:VARCHAR}
      )
      ]]>
      </isNotNull>
      <isNotNull prepend="and" property="properties.contractNo">
      etc.contract_no = #{properties.contractNo:VARCHAR}
      </isNotNull>
      --> select * from tbl_project_etc etc, tbl_employee_leave lea ,tbl_employee_info tei ,tbl_department_info dept where etc.employee_id = lea.employee_id and lea.employee_id = tei.EMPLOYEE_ID and tei.DEPARTMENT_ID = dept.DEPARTMENT_ID and tei.BEYOND_COMPANY = dept.BEYOND_COMPANY
    <if test="properties.exportEmployeeName != null">and tei.EMPLOYEE_NAME = #{properties.exportEmployeeName:VARCHAR}</if>  
    <if test="properties.exportComapyFrom != null">and tei.BEYOND_COMPANY = #{properties.exportComapyFrom:VARCHAR}</if>  
    <if test="properties.exportDeptmentFrom != null">and tei.DEPARTMENT_ID = #{properties.exportDeptmentFrom:VARCHAR}</if>  
    <if test="properties.exportContractNoFrom != null">and etc.contract_no = #{properties.exportContractNoFrom:VARCHAR}</if>  
    <if test="properties.exportAreaFrom != null">and dept.area = #{properties.exportAreaFrom:VARCHAR}</if>  
    <if test="properties.exportStatTimeFrom != null">and ( date_format(lea.leave_start_date,'%Y-%m-%d') &gt;= #{properties.exportStatTimeFrom:VARCHAR} or date_format(lea.leave_end_date,'%Y-%m-%d') &gt;= #{properties.exportEndTimeFrom:VARCHAR} )</if>  
    <if test="properties.defaultExportStatTimeFrom != null">and date_format(lea.leave_start_date,'%Y-%m') &gt;=#{properties.defaultExportStatTimeFrom:VARCHAR}</if>  
    <if test="properties.defaultExportEndTimeFrom != null">and date_format(lea.leave_start_date,'%Y-%m') &lt;=#{properties.defaultExportEndTimeFrom:VARCHAR}</if> 
  </select>
  <select id="selectByCriteria" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeaveCriteria"> 
    <!--
  WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
  This element was generated on Wed Jul 15 10:13:18 CST 2015.
--> select * from tbl_employee_leave
    <if test="_parameter != null"> 
      <include refid="tbl_employee_leave.Criteria_Where_Clause"/>  
      <if test="orderByClause != null">order by ${orderByClause}</if> 
    </if> 
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap2" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    --> select * from tbl_employee_leave where leave_id = #{leaveId:VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    --> delete from tbl_employee_leave where leave_id = #{leaveId:VARCHAR}
  </delete>
  <delete id="deleteByCriteria" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeaveCriteria"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    --> delete from tbl_employee_leave 
    <include refid="tbl_employee_leave.Criteria_Where_Clause"/> 
  </delete>
  <insert id="insert" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    --> insert into tbl_employee_leave (leave_id, employee_id, leave_start_date, leave_end_date, leave_type, leave_type_name,leave_reason, check_type,approve_employee,create_time,modify_time,REMARK) values (#{leaveId:VARCHAR}, #{employeeId:VARCHAR}, #{leaveStartDate:TIMESTAMP}, #{leaveEndDate:TIMESTAMP}, #{leaveType:CHAR}, #{leaveTypeName:VARCHAR},#{leaveReason:VARCHAR}, #{checkType:CHAR} ,#{approveEmployee:VARCHAR},#{createTime:TIMESTAMP},#{modifyTime:TIMESTAMP},#{remark:VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    --> insert into tbl_employee_leave 
    <trim prefix="("> 
      <if test="leaveId != null">leave_id ,</if>  
      <if test="employeeId != null">employee_id ,</if>  
      <if test="leaveStartDate != null">leave_start_date ,</if>  
      <if test="leaveEndDate != null">leave_end_date ,</if>  
      <if test="leaveType != null">leave_type ,</if>  
      <if test="leaveTypeName != null">leave_type_name ,</if>  
      <if test="leaveReason != null">leave_reason ,</if>  
      <if test="checkType != null">check_type ,</if>  
      <if test="approveEmployee != null">approve_employee ,</if>  
      <if test="createTime != null">create_time ,</if>  
      <if test="modifyTime != null">modify_time ,</if>  
      <if test="remark != null">REMARK ,</if>  
      <if test="leaveImg != null">leave_img ,</if>  
      <!--<isNotNull prepend="," property="officalType" >
        offical_type
      </isNotNull>--> )
    </trim> values 
    <trim prefix="("> 
      <if test="leaveId != null">#{leaveId:VARCHAR} ,</if>  
      <if test="employeeId != null">#{employeeId:VARCHAR} ,</if>  
      <if test="leaveStartDate != null">#{leaveStartDate:TIMESTAMP} ,</if>  
      <if test="leaveEndDate != null">#{leaveEndDate:TIMESTAMP} ,</if>  
      <if test="leaveType != null">#{leaveType:CHAR} ,</if>  
      <if test="leaveTypeName != null">#{leaveTypeName:VARCHAR} ,</if>  
      <if test="leaveReason != null">#{leaveReason:VARCHAR} ,</if>  
      <if test="checkType != null">#{checkType:CHAR} ,</if>  
      <if test="approveEmployee != null">#{approveEmployee:VARCHAR} ,</if>  
      <if test="createTime != null">#{createTime:TIMESTAMP} ,</if>  
      <if test="modifyTime != null">#{modifyTime:TIMESTAMP} ,</if>  
      <if test="remark != null">#{remark:VARCHAR} ,</if>  
      <if test="leaveImg != null">#{leaveImg:VARCHAR} ,</if>  
      <!--
            <isNotNull prepend="," property="officalType" >
              #{officalType:VARCHAR}
            </isNotNull>
      --> )
    </trim> 
  </insert>
  <select id="countByCriteria" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeaveCriteria" resultType="java.lang.Integer"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    --> select count(*) from tbl_employee_leave 
    <include refid="tbl_employee_leave.Criteria_Where_Clause"/> 
  </select>
  <update id="updateByCriteriaSelective"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    --> update tbl_employee_leave 
    <trim prefix="set"> 
      <if test="record.leaveId != null">leave_id = #{record.leaveId:VARCHAR} ,</if>  
      <if test="record.employeeId != null">employee_id = #{record.employeeId:VARCHAR} ,</if>  
      <if test="record.leaveStartDate != null">leave_start_date = #{record.leaveStartDate:TIMESTAMP} ,</if>  
      <if test="record.leaveEndDate != null">leave_end_date = #{record.leaveEndDate:TIMESTAMP} ,</if>  
      <if test="record.leaveType != null">leave_type = #{record.leaveType:CHAR} ,</if>  
      <if test="record.leaveTypeName != null">leave_type_name = #{record.leaveTypeName:VARCHAR} ,</if>  
      <if test="record.leaveReason != null">leave_reason = #{record.leaveReason:VARCHAR} ,</if>  
      <if test="record.checkType != null">check_type = #{record.checkType:CHAR} ,</if>  
      <if test="record.approveEmployee != null">approve_employee = #{record.approveEmployee:VARCHAR} ,</if>  
      <if test="record.createTime != null">create_time = #{record.createTime:TIMESTAMP} ,</if>  
      <if test="record.modifyTime != null">modify_time = #{record.modifyTime:TIMESTAMP} ,</if>  
      <if test="record.modifyTime != null">REMARK = #{record.remark:VARCHAR} ,</if> 
    </trim>  
    <if test="_parameter != null"> 
      <include refid="tbl_employee_leave.Criteria_Where_Clause"/> 
    </if> 
  </update>
  <update id="updateByCriteria"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    --> update tbl_employee_leave set leave_id = #{record.leaveId:VARCHAR}, employee_id = #{record.employeeId:VARCHAR}, leave_start_date = #{record.leaveStartDate:TIMESTAMP}, leave_end_date = #{record.leaveEndDate:TIMESTAMP}, leave_type = #{record.leaveType:CHAR}, leave_type_name = #{record.leaveTypeName:VARCHAR}, leave_reason = #{record.leaveReason:VARCHAR}, check_type = #{record.checkType:CHAR}, approve_employee = #{record.approveEmployee:VARCHAR}, create_time = #{record.createTime:TIMESTAMP}, modify_time = #{record.modifyTime:TIMESTAMP}, REMARK = #{record.remark:VARCHAR}
    <if test="_parameter != null"> 
      <include refid="tbl_employee_leave.Criteria_Where_Clause"/> 
    </if> 
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    --> update tbl_employee_leave 
    <trim prefix="set"> 
      <if test="employeeId != null">employee_id = #{employeeId:VARCHAR} ,</if>  
      <if test="leaveStartDate != null">leave_start_date = #{leaveStartDate:TIMESTAMP} ,</if>  
      <if test="leaveEndDate != null">leave_end_date = #{leaveEndDate:TIMESTAMP} ,</if>  
      <if test="leaveType != null">leave_type = #{leaveType:CHAR} ,</if>  
      <if test="leaveTypeName != null">leave_type_name = #{leaveTypeName:VARCHAR} ,</if>  
      <if test="leaveReason != null">leave_reason = #{leaveReason:VARCHAR} ,</if>  
      <if test="checkType != null">check_type = #{checkType:CHAR} ,</if>  
      <if test="approveEmployee != null">approve_employee = #{approveEmployee:VARCHAR} ,</if>  
      <if test="createTime != null">create_time = #{createTime:TIMESTAMP} ,</if>  
      <if test="modifyTime != null">modify_time = #{modifyTime:TIMESTAMP} ,</if>  
      <if test="remark != null">REMARK = #{remark:VARCHAR} ,</if>  
      <if test="leaveImg != null">leave_img = #{leaveImg:VARCHAR} ,</if>  
      <!--<isNotNull prepend="," property="officalType" >
        offical_type = #{officalType:VARCHAR}
      </isNotNull>--> 
    </trim> where leave_id = #{leaveId:VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 15 10:13:18 CST 2015.
    --> update tbl_employee_leave set employee_id = #{employeeId:VARCHAR}, leave_start_date = #{leaveStartDate:TIMESTAMP}, leave_end_date = #{leaveEndDate:TIMESTAMP}, leave_type = #{leaveType:CHAR}, leave_type_name = #{leaveTypeName:VARCHAR}, leave_reason = #{leaveReason:VARCHAR}, check_type = #{checkType:CHAR}, approve_employee = #{approveEmployee:VARCHAR}, create_time = #{createTime:TIMESTAMP}, modify_time = #{modifyTime:TIMESTAMP}, REMARK = #{remark:VARCHAR} where leave_id = #{leaveId:VARCHAR}
  </update>
  <select id="selectEmployeeLeaveForApp" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" resultMap="ResultMapExt">SELECT * FROM tbl_employee_leave
    <include refid="tbl_employee_leave.Criteria_Where_Clause"/> 
  </select>
  <select id="selectEmployeeLeaveForAppSelf" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" resultMap="ResultMapExt1">SELECT * FROM tbl_employee_leave
    <trim prefix="where"> 
      <include refid="tbl_employee_leave.leave_Where_clause"/> 
    </trim> ORDER BY modify_time DESC
  </select>
  <select id="selectEmployeeLeaveForApprove" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave" resultMap="ResultMapExt2">SELECT * FROM tbl_employee_leave
    <trim prefix="where"> 
      <include refid="tbl_employee_leave.leave_Where_clause"/> 
    </trim> ORDER BY modify_time DESC ,leave_type
  </select>
  <select id="countEmployeeLeaveList" resultType="java.lang.Integer" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">select count(1) from tbl_employee_leave e,tbl_employee_info o ,tbl_department_info dep where e.employee_id = o.EMPLOYEE_ID and dep.DEPARTMENT_ID = o.DEPARTMENT_ID
    <!-- and o.IS_ON_DUTY = '01'-->
    <!--显示离职人员的请假列表-->  
    <if test="properties.area != null and properties.area != ''">and dep.area=#{properties.area:VARCHAR}</if>  
    <if test="properties.employeeName != null and properties.employeeName != ''">and o.EMPLOYEE_NAME like concat('%', #{properties.employeeName:VARCHAR}, '%')</if>  
    <if test="leaveType != null and leaveType != ''">and e.leave_type=#{leaveType:VARCHAR}</if>  
    <if test="checkType != null and checkType != ''">and e.check_type=#{checkType:VARCHAR}</if>  
    <if test="properties.beyondCompany != null and properties.beyondCompany != ''">and o.BEYOND_COMPANY = #{properties.beyondCompany:VARCHAR}</if>  
    <if test="properties.departmentid != null and properties.departmentid != ''">and o.DEPARTMENT_ID = #{properties.departmentid:VARCHAR}</if>  
    <if test="properties.startTime != null and properties.startTime != ''">and date_format(e.leave_start_date,'%Y-%m-%d')&gt;=#{properties.startTime:VARCHAR}</if>  
    <if test="properties.endTime != null and properties.endTime != ''">and date_format(e.leave_end_date,'%Y-%m-%d')&lt;=#{properties.endTime:VARCHAR}</if> 
  </select>
  <select id="countEmployeeLeaveApproveList" resultType="java.lang.Integer" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">select count(1) from tbl_employee_leave e,tbl_employee_info o ,tbl_department_info dep where e.employee_id = o.EMPLOYEE_ID and dep.DEPARTMENT_ID = o.DEPARTMENT_ID and o.IS_ON_DUTY = '01' and e.check_type = '1'
    <if test="properties.area != null and properties.area != ''">and dep.area=#{properties.area:VARCHAR}</if>  
    <if test="properties.employeeName != null and properties.employeeName != ''">and o.EMPLOYEE_NAME like concat('%', #{properties.employeeName:VARCHAR}, '%')</if>  
    <if test="leaveType != null and leaveType != ''">and e.leave_type=#{leaveType:VARCHAR}</if>  
    <if test="properties.beyondCompany != null and properties.beyondCompany != ''">and o.BEYOND_COMPANY = #{properties.beyondCompany:VARCHAR}</if>  
    <if test="properties.departmentid != null and properties.departmentid != ''">and o.DEPARTMENT_ID = #{properties.departmentid:VARCHAR}</if>  
    <if test="properties.startTime != null and properties.startTime != ''">and date_format(e.leave_start_date,'%Y-%m-%d')&gt;=#{properties.startTime:VARCHAR}</if>  
    <if test="properties.endTime != null and properties.endTime != ''">and date_format(e.leave_end_date,'%Y-%m-%d')&lt;=#{properties.endTime:VARCHAR}</if> 
  </select>
  <select id="selectEmployeeLeaveList" resultMap="ResultMapExt3" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">select * from tbl_employee_leave e,tbl_employee_info o ,tbl_department_info dep,tbl_project_etc etc,tbl_project_info project where e.employee_id = o.EMPLOYEE_ID and dep.DEPARTMENT_ID = o.DEPARTMENT_ID and e.EMPLOYEE_ID = etc.employee_id and etc.contract_no = project.contract_no
    <!-- and o.IS_ON_DUTY = '01'-->
    <!--显示离职人员的请假列表-->  
    <if test="properties.area != null and properties.area != ''">and dep.area=#{properties.area:VARCHAR}</if>  
    <if test="properties.employeeName != null and properties.employeeName != ''">and o.EMPLOYEE_NAME like concat('%', #{properties.employeeName:VARCHAR}, '%')</if>  
    <if test="leaveType != null and leaveType != ''">and e.leave_type=#{leaveType:VARCHAR}</if>  
    <if test="checkType != null and checkType != ''">and e.check_type=#{checkType:VARCHAR}</if>  
    <if test="properties.beyondCompany != null and properties.beyondCompany != ''">and o.BEYOND_COMPANY = #{properties.beyondCompany:VARCHAR}</if>  
    <if test="properties.departmentid != null and properties.departmentid != ''">and o.DEPARTMENT_ID = #{properties.departmentid:VARCHAR}</if>  
    <if test="properties.startTime != null and properties.startTime != ''">and date_format(e.leave_start_date,'%Y-%m-%d')&gt;=#{properties.startTime:VARCHAR}</if>  
    <if test="properties.endTime != null and properties.endTime != ''">and date_format(e.leave_end_date,'%Y-%m-%d')&lt;=#{properties.endTime:VARCHAR}</if> GROUP BY leave_id ORDER BY e.modify_time desc
  </select>
  <!--wjj-->
  <!--之前查询没有加上权限-->
  <select id="selectEmployeeLeaveList_areaList" resultMap="ResultMapExt" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">select * from tbl_employee_leave e,tbl_employee_info o ,tbl_department_info dep where e.employee_id = o.EMPLOYEE_ID and dep.DEPARTMENT_ID = o.DEPARTMENT_ID
    <if test="properties.areaList != null and properties.areaList != ''">
      <iterate open="(" close=")" conjunction="or" property="properties.areaList">dep.area=#{properties.areaList[]}</iterate> and
    </if>  
    <if test="properties.employeeName != null and properties.employeeName != ''">and o.EMPLOYEE_NAME like concat('%', #{properties.employeeName:VARCHAR}, '%')</if>  
    <if test="leaveType != null and leaveType != ''">and e.leave_type=#{leaveType:VARCHAR}</if>  
    <if test="checkType != null and checkType != ''">and e.check_type=#{checkType:VARCHAR}</if>  
    <if test="properties.beyondCompany != null and properties.beyondCompany != ''">and o.BEYOND_COMPANY = #{properties.beyondCompany:VARCHAR}</if>  
    <if test="properties.departmentid != null and properties.departmentid != ''">and o.DEPARTMENT_ID = #{properties.departmentid:VARCHAR}</if>  
    <if test="properties.startTime != null and properties.startTime != ''">and date_format(e.leave_start_date,'%Y-%m-%d')&gt;=#{properties.startTime:VARCHAR}</if>  
    <if test="properties.endTime != null and properties.endTime != ''">and date_format(e.leave_end_date,'%Y-%m-%d')&lt;=#{properties.endTime:VARCHAR}</if> ORDER BY e.modify_time desc
  </select>
  <select id="selectEmployeeLeaveApproveList" resultMap="ResultMapExt" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">select * from tbl_employee_leave e,tbl_employee_info o ,tbl_department_info dep where e.employee_id = o.EMPLOYEE_ID and dep.DEPARTMENT_ID = o.DEPARTMENT_ID and o.IS_ON_DUTY = '01' and e.check_type = '1'
    <if test="properties.areaList != null and properties.areaList != ''">
      <iterate open="(" close=")" conjunction="or" property="properties.areaList">dep.area=#{properties.areaList[]}</iterate> and
    </if>  
    <if test="properties.employeeName != null and properties.employeeName != ''">and o.EMPLOYEE_NAME like concat('%', #{properties.employeeName:VARCHAR}, '%')</if>  
    <if test="leaveType != null and leaveType != ''">and e.leave_type=#{leaveType:VARCHAR}</if>  
    <if test="properties.beyondCompany != null and properties.beyondCompany != ''">and o.BEYOND_COMPANY = #{properties.beyondCompany:VARCHAR}</if>  
    <if test="properties.departmentid != null and properties.departmentid != ''">and o.DEPARTMENT_ID = #{properties.departmentid:VARCHAR}</if>  
    <if test="properties.startTime != null and properties.startTime != ''">and date_format(e.leave_start_date,'%Y-%m-%d')&gt;=#{properties.startTime:VARCHAR}</if>  
    <if test="properties.endTime != null and properties.endTime != ''">and date_format(e.leave_end_date,'%Y-%m-%d')&lt;=#{properties.endTime:VARCHAR}</if> ORDER BY e.modify_time desc
  </select>
  <select id="selectEmployeeLeaveProject" parameterType="java.lang.String" resultMap="BaseResultMap">SELECT e.* FROM tbl_employee_leave e,tbl_project_etc tc WHERE e.employee_id = tc.employee_id and tc.is_Leave='00' and tc.contract_no=#{value:VARCHAR}<![CDATA[
      and date_format(e.leave_start_date,'%Y-%m-%d')<=date_format(curdate()-1,'%Y-%m-%d')
    ]]>  <![CDATA[
     and date_format(e.leave_end_date,'%Y-%m-%d')>=date_format(curdate()-1,'%Y-%m-%d')
    ]]> AND e.check_type='1'</select>
  <!-- 查询公出以外的请假列表-->
  <select id="selectLeaveListByLeaveTypeSelf" resultMap="ResultMapExt1" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">select * from tbl_employee_leave where employee_id = #{employeeId:VARCHAR} and leave_type != '8' ORDER BY create_time desc</select>
  <!-- 查询请病假的请假列表-->
  <select id="selectLeaveListByEmployeeId" resultMap="ResultMapExt1" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">select * from tbl_employee_leave where employee_id = #{employeeId:VARCHAR} and leave_type = '2'</select>
  <!-- 查询某月员工的请假天数  其中参数monthBegin和monthEnd根据选定的月份设定为本月开始日期和本月结束日期-->
  <select id="selectLeaveNumberEeachMonthByDate" resultMap="MonthLeaveDays" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">SELECT c.employee_id,c.EMPLOYEE_NAME,c.count+c.days AS leavedays,c.EMAIL,c.DEPARTMENT_NAME,c.AREA FROM (SELECT b.employee_id,b.EMPLOYEE_NAME,b.leave_end_date,b.leave_start_date,count(*) as count,days,b.EMAIL,d.DEPARTMENT_NAME,d.AREA FROM (SELECT a.employee_id,a.EMPLOYEE_NAME,a.leave_end_date,a.leave_start_date,DATEDIFF(a.leave_end_date,a.leave_start_date) as days,a.EMAIL,a.DEPARTMENT_ID FROM (SELECT e.employee_id,i.EMPLOYEE_NAME,i.EMAIL,i.DEPARTMENT_ID,<![CDATA[IF(e.leave_start_date < #{properties.monthBeginTime:VARCHAR},str_to_date(#{properties.monthBeginTime:VARCHAR},'%Y-%m-%d %H'),e.leave_start_date) AS leave_start_date ]]>, <![CDATA[IF(e.leave_end_date>#{properties.monthEndTime:VARCHAR},str_to_date(#{properties.monthEndTime:VARCHAR},'%Y-%m-%d %H'),e.leave_end_date) AS leave_end_date ]]> FROM tbl_employee_leave AS e LEFT JOIN tbl_employee_info AS i ON e.employee_id = i.EMPLOYEE_ID<![CDATA[WHERE e.leave_start_date < #{properties.monthEndTime:VARCHAR} AND e.leave_end_date >#{properties.monthBeginTime:VARCHAR} AND i.IS_ON_DUTY ='01']]>) AS a)AS b LEFT JOIN tbl_department_info d ON b.DEPARTMENT_ID = d.DEPARTMENT_ID GROUP BY b.employee_id) AS c ORDER BY leavedays DESC</select>
  <select id="selectEmployeeLeaveListPic" resultMap="ResultMapExt3" parameterType="com.i2shopping.i2work.operation.core.employee.model.EmployeeLeave">select * from tbl_employee_leave e,tbl_employee_info o ,tbl_department_info dep,tbl_project_etc etc,tbl_project_info project where e.employee_id = o.EMPLOYEE_ID and dep.DEPARTMENT_ID = o.DEPARTMENT_ID and e.EMPLOYEE_ID = etc.employee_id and etc.contract_no = project.contract_no
    <!-- and o.IS_ON_DUTY = '01'-->
    <!--显示离职人员的请假列表-->  
    <if test="properties.area != null and properties.area != ''">and dep.area=#{properties.area:VARCHAR}</if>  
    <if test="properties.employeeName != null and properties.employeeName != ''">and o.EMPLOYEE_NAME like concat('%', #{properties.employeeName:VARCHAR}, '%')</if>  
    <if test="leaveType != null and leaveType != ''">and e.leave_type=#{leaveType:VARCHAR}</if>  
    <isEmpty prepend="and" property="leaveType"> 
      <!--"4""婚假", "5""产假" ,"6""陪产假" 9 产检假--> e.leave_type in('2','4','5','6','9')
    </isEmpty>  
    <if test="checkType != null and checkType != ''">and e.check_type=#{checkType:VARCHAR}</if>  
    <if test="properties.beyondCompany != null and properties.beyondCompany != ''">and o.BEYOND_COMPANY = #{properties.beyondCompany:VARCHAR}</if>  
    <if test="properties.departmentid != null and properties.departmentid != ''">and o.DEPARTMENT_ID = #{properties.departmentid:VARCHAR}</if>  
    <if test="properties.startTime != null and properties.startTime != ''">and date_format(e.leave_start_date,'%Y-%m-%d')&gt;=#{properties.startTime:VARCHAR}</if>  
    <if test="properties.endTime != null and properties.endTime != ''">and date_format(e.leave_end_date,'%Y-%m-%d')&lt;=#{properties.endTime:VARCHAR}</if> and e.leave_img !='' GROUP BY leave_id ORDER BY e.modify_time desc
  </select>
</mapper>
