<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="tbl_customer_evalution">
    <resultMap id="BaseResultMap" type="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution">
        <result column="EVALUTION_ID" property="evalutionId" jdbcType="VARCHAR"/>
        <result column="EVALUTION_DATE" property="evalutionDate" jdbcType="TIMESTAMP"/>
        <result column="CONTRACT_NO" property="contractNo" jdbcType="VARCHAR"/>
        <result column="EMPLOYEE_ID" property="employeeId" jdbcType="VARCHAR"/>
        <result column="EVALUTION_LEAVEL" property="evalutionLeavel" jdbcType="VARCHAR"/>
        <result column="EVALUTION_ITEM" property="evalutionItem" jdbcType="VARCHAR"/>
    </resultMap>
    <resultMap id="ResultMapExt" extends="BaseResultMap"
               type="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution">
        <result column="EMPLOYEE_NAME" property="employeeName" jdbcType="VARCHAR"/>
        <result column="project_name" property="projectName" jdbcType="VARCHAR"/>
    </resultMap>
    <sql id="Criteria_Where_Clause">
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Thu Jun 25 20:21:27 CST 2015.
        -->
        <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate">
            <if test="oredCriteria[].valid!= null and oredCriteria[].valid == 'true'.toString()">(
                <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and">
                    $oredCriteria[].criteriaWithoutValue[]$
                </iterate>
                <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and">
                    $oredCriteria[].criteriaWithSingleValue[].condition$
                    #{oredCriteria[].criteriaWithSingleValue[].value}
                </iterate>
                <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and">
                    $oredCriteria[].criteriaWithListValue[].condition$
                    <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")"
                             conjunction=",">#{oredCriteria[].criteriaWithListValue[].values[]}
                    </iterate>
                </iterate>
                <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and">
                    $oredCriteria[].criteriaWithBetweenValue[].condition$
                    #{oredCriteria[].criteriaWithBetweenValue[].values[0]} and
                    #{oredCriteria[].criteriaWithBetweenValue[].values[1]}
                </iterate>
                )
            </if>
        </iterate>
    </sql>
    <!-- 查询客户评价 -->
    <select id="selectByCustomerEvalution" resultMap="BaseResultMap"
            parameterType="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution">select * from
        tbl_customer_evalution where CONTRACT_NO=#{contractNo:VARCHAR}
        <if test="evalutionDate != null and evalutionDate != ''"> <![CDATA[
	      	date_format(EVALUTION_DATE,'%Y-%m-%d') = date_format(#{evalutionDate:TIMESTAMP},'%Y-%m-%d')
	      ]]> </if>
        <if test="employeeId != null and employeeId != ''">EMPLOYEE_ID=#{employeeId:VARCHAR}</if>
    </select>
    <!--<select id="selectByCriteria" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalutionCriteria" >-->
    <!--select EVALUTION_ID, EVALUTION_DATE, CONTRACT_NO, EMPLOYEE_ID, EVALUTION_LEAVEL, EVALUTION_ITEM-->
    <!--from tbl_customer_evalution-->
    <!--<isParameterPresent >-->
    <!--<include refid="tbl_customer_evalution.Criteria_Where_Clause" />-->
    <!--<isNotNull property="orderByClause" >-->
    <!--order by ${orderByClause}-->
    <!--</isNotNull>-->
    <!--</isParameterPresent>-->
    <!--</select>-->
    <select id="selectByPrimaryKey" resultMap="BaseResultMap"
            parameterType="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution">
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Thu Jun 25 20:21:27 CST 2015.
        --> select EVALUTION_ID, EVALUTION_DATE, CONTRACT_NO, EMPLOYEE_ID, EVALUTION_LEAVEL, EVALUTION_ITEM from
        tbl_customer_evalution where EVALUTION_ID = #{evalutionId:VARCHAR}
    </select>
    <delete id="deleteByPrimaryKey"
            parameterType="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution">
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Thu Jun 25 20:21:27 CST 2015.
        --> delete from tbl_customer_evalution where EVALUTION_ID = #{evalutionId:VARCHAR}
    </delete>
    <!--<delete id="deleteByCriteria" parameterType="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalutionCriteria" >-->
    <!--&lt;!&ndash;-->
    <!--WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.-->
    <!--This element was generated on Thu Jun 25 20:21:27 CST 2015.-->
    <!--&ndash;&gt;-->
    <!--delete from tbl_customer_evalution-->
    <!--<include refid="tbl_customer_evalution.Criteria_Where_Clause" />-->
    <!--</delete>-->
    <insert id="insert" parameterType="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution">
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Thu Jun 25 20:21:27 CST 2015.
        --> insert into tbl_customer_evalution (EVALUTION_ID, EVALUTION_DATE, CONTRACT_NO, EMPLOYEE_ID,
        EVALUTION_LEAVEL,
        EVALUTION_ITEM) values (#{evalutionId:VARCHAR}, #{evalutionDate:TIMESTAMP}, #{contractNo:VARCHAR},
        #{employeeId:VARCHAR}, #{evalutionLeavel:VARCHAR}, #{evalutionItem:VARCHAR})
    </insert>
    <insert id="insertSelective" parameterType="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution">
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Thu Jun 25 20:21:27 CST 2015.
        --> insert into tbl_customer_evalution
        <trim prefix="(">
            <if test="evalutionId != null">EVALUTION_ID ,</if>
            <if test="evalutionDate != null">EVALUTION_DATE ,</if>
            <if test="contractNo != null">CONTRACT_NO ,</if>
            <if test="employeeId != null">EMPLOYEE_ID ,</if>
            <if test="evalutionLeavel != null">EVALUTION_LEAVEL ,</if>
            <if test="evalutionItem != null">EVALUTION_ITEM ,</if>
            )
        </trim>
        values
        <trim prefix="(">
            <if test="evalutionId != null">#{evalutionId:VARCHAR} ,</if>
            <if test="evalutionDate != null">#{evalutionDate:TIMESTAMP} ,</if>
            <if test="contractNo != null">#{contractNo:VARCHAR} ,</if>
            <if test="employeeId != null">#{employeeId:VARCHAR} ,</if>
            <if test="evalutionLeavel != null">#{evalutionLeavel:VARCHAR} ,</if>
            <if test="evalutionItem != null">#{evalutionItem:VARCHAR} ,</if>
            )
        </trim>
    </insert>
    <!--<select id="countByCriteria" parameterType="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalutionCriteria" resultType="java.lang.Integer" >
      &lt;!&ndash;
        WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
        This element was generated on Thu Jun 25 20:21:27 CST 2015.
      &ndash;&gt;
      select count(*) from tbl_customer_evalution
      <include refid="tbl_customer_evalution.Criteria_Where_Clause" />
    </select>-->
    <update id="updateByCriteriaSelective">
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Thu Jun 25 20:21:27 CST 2015.
        --> update tbl_customer_evalution
        <trim prefix="set">
            <if test="record.evalutionId != null">EVALUTION_ID = #{record.evalutionId:VARCHAR} ,</if>
            <if test="record.evalutionDate != null">EVALUTION_DATE = #{record.evalutionDate:TIMESTAMP} ,</if>
            <if test="record.contractNo != null">CONTRACT_NO = #{record.contractNo:VARCHAR} ,</if>
            <if test="record.employeeId != null">EMPLOYEE_ID = #{record.employeeId:VARCHAR} ,</if>
            <if test="record.evalutionLeavel != null">EVALUTION_LEAVEL = #{record.evalutionLeavel:VARCHAR} ,</if>
            <if test="record.evalutionItem != null">EVALUTION_ITEM = #{record.evalutionItem:VARCHAR} ,</if>
        </trim>
        <if test="_parameter != null">
            <include refid="tbl_customer_evalution.Criteria_Where_Clause"/>
        </if>
    </update>
    <update id="updateByCriteria">
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Thu Jun 25 20:21:27 CST 2015.
        --> update tbl_customer_evalution set EVALUTION_ID = #{record.evalutionId:VARCHAR}, EVALUTION_DATE =
        #{record.evalutionDate:TIMESTAMP}, CONTRACT_NO = #{record.contractNo:VARCHAR}, EMPLOYEE_ID =
        #{record.employeeId:VARCHAR}, EVALUTION_LEAVEL = #{record.evalutionLeavel:VARCHAR}, EVALUTION_ITEM =
        #{record.evalutionItem:VARCHAR}
        <if test="_parameter != null">
            <include refid="tbl_customer_evalution.Criteria_Where_Clause"/>
        </if>
    </update>
    <update id="updateByPrimaryKeySelective"
            parameterType="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution">
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Thu Jun 25 20:21:27 CST 2015.
        --> update tbl_customer_evalution
        <trim prefix="set">
            <if test="evalutionDate != null">EVALUTION_DATE = #{evalutionDate:TIMESTAMP} ,</if>
            <if test="contractNo != null">CONTRACT_NO = #{contractNo:VARCHAR} ,</if>
            <if test="employeeId != null">EMPLOYEE_ID = #{employeeId:VARCHAR} ,</if>
            <if test="evalutionLeavel != null">EVALUTION_LEAVEL = #{evalutionLeavel:VARCHAR} ,</if>
            <if test="evalutionItem != null">EVALUTION_ITEM = #{evalutionItem:VARCHAR} ,</if>
        </trim>
        where EVALUTION_ID = #{evalutionId:VARCHAR}
    </update>
    <update id="updateByPrimaryKey"
            parameterType="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution">
        <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Thu Jun 25 20:21:27 CST 2015.
        --> update tbl_customer_evalution set EVALUTION_DATE = #{evalutionDate:TIMESTAMP}, CONTRACT_NO =
        #{contractNo:VARCHAR}, EMPLOYEE_ID = #{employeeId:VARCHAR}, EVALUTION_LEAVEL = #{evalutionLeavel:VARCHAR},
        EVALUTION_ITEM = #{evalutionItem:VARCHAR} where EVALUTION_ID = #{evalutionId:VARCHAR}
    </update>
    <sql id="customer_Where_Clause">
        <if test="contractNo != null and contractNo != ''">and customer.contract_no = #{contractNo:VARCHAR}</if>
        <if test="properties.startTime != null and properties.startTime != ''">and date_format(customer.evalution_date
            ,'%Y-%m-%d') &gt;= #{properties.startTime:VARCHAR}
        </if>
        <if test="properties.endTime != null and properties.endTime != ''">and date_format(customer.evalution_date
            ,'%Y-%m-%d') &lt;= #{properties.endTime:VARCHAR}
        </if>
    </sql>
    <!-- 分页查询所有客户评级 -->
    <select id="selectCustomerEvalutionByPage"
            parameterType="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution"
            resultMap="ResultMapExt">select customer.*, info.customer_name employee_name, project.project_name from
        tbl_customer_evalution customer , tbl_customer_info info , tbl_project_info project where customer.employee_id =
        info.customer_id and customer.contract_no = project.contract_no
        <include refid="tbl_customer_evalution.customer_Where_Clause"/>
    </select>
    <select id="countEvalutionByPage"
            parameterType="com.i2shopping.i2work.operation.core.customer.model.CustomerEvalution"
            resultType="java.lang.Integer">
        select count(*) from tbl_customer_evalution customer , tbl_customer_info info
        , tbl_project_info project where customer.employee_id = info.customer_id and customer.contract_no =
        project.contract_no
        <include refid="tbl_customer_evalution.customer_Where_Clause"/>
    </select>
</mapper>
