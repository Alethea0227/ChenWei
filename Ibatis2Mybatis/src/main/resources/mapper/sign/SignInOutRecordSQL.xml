<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="tbl_sign_in_out_record">
  <resultMap id="BaseResultMap" type="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord">
    <result column="contract_no" property="contractNo" jdbcType="VARCHAR"/>
    <result column="employee_id" property="employeeId" jdbcType="CHAR"/>
    <result column="sign_time" property="signTime" jdbcType="VARCHAR"/>
    <result column="sign_location" property="signLocation" jdbcType="VARCHAR"/>
    <result column="sign_in_time" property="signInTime" jdbcType="VARCHAR"/>
    <result column="sign_out_time" property="signOutTime" jdbcType="VARCHAR"/>
    <result column="sign_out_location" property="signOutLocation" jdbcType="VARCHAR"/>
    <result column="sign_in_lon_and_lat" property="signInLonAndLat" jdbcType="VARCHAR"/>
    <result column="sign_out_lon_and_lat" property="signOutLonAndLat" jdbcType="VARCHAR"/>
  </resultMap>
  <resultMap id="SecondResultMap" type="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord">
    <result column="contract_no" property="contractNo" jdbcType="VARCHAR"/>
    <result column="employee_id" property="employeeId" jdbcType="CHAR"/>
    <result column="sign_time" property="signTime" jdbcType="VARCHAR"/>
    <result column="sign_location" property="signLocation" jdbcType="VARCHAR"/>
    <result column="sign_in_time" property="signInTime" jdbcType="VARCHAR"/>
    <result column="sign_out_time" property="signOutTime" jdbcType="VARCHAR"/>
    <result column="sign_out_location" property="signOutLocation" jdbcType="VARCHAR"/>
  </resultMap>
  <resultMap id="ResultMapPage" extends="SecondResultMap" type="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord">
    <!--<result column="OVERTIME_LABOUR" property="overtimeLabour" jdbcType="DECIMAL" />-->
    <!--<result column="STANDARD_LABOUR" property="standardLabour" jdbcType="DECIMAL" />-->
    <result column="EMPLOYEE_NAME" property="employeeName" jdbcType="VARCHAR"/>
    <result column="project_name" property="projectName" jdbcType="VARCHAR"/>
  </resultMap>
  <resultMap id="ResultMapP" extends="SecondResultMap" type="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord">
    <!--<result column="OVERTIME_LABOUR" property="overtimeLabour" jdbcType="DECIMAL" />-->
    <!--<result column="STANDARD_LABOUR" property="standardLabour" jdbcType="DECIMAL" />-->
    <result column="EMPLOYEE_NAME" property="employeeName" jdbcType="VARCHAR"/>
  </resultMap>
  <resultMap id="ResultMapVo" type="com.i2shopping.i2work.operation.core.sign.model.SignInOutVo">
    <result column="sign_location" property="signInLocation" jdbcType="VARCHAR"/>
    <result column="sign_out_location" property="signOutLocation" jdbcType="VARCHAR"/>
    <result column="sign_time" property="signTime" jdbcType="VARCHAR"/>
    <result column="sign_in_time" property="signInTime" jdbcType="VARCHAR"/>
    <result column="sign_out_time" property="signOutTime" jdbcType="VARCHAR"/>
    <result column="contract_no" property="contractNo" jdbcType="VARCHAR"/>
    <result column="project_name" property="projectName" jdbcType="VARCHAR"/>
    <!-- <result column="standard_labour" property="standardLabour" jdbcType="DECIMAL" />
        <result column="overtime_labour" property="overTimeLabour"	jdbcType="DECIMAL" /> -->
    <result column="employee_id" property="employeeId" jdbcType="VARCHAR"/>
    <result column="employee_name" property="employeeName" jdbcType="VARCHAR"/>
    <result column="department_name" property="departmentName" jdbcType="VARCHAR"/>
  </resultMap>
  <sql id="Criteria_Where_Clause"> 
    <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        -->  
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate"> 
      <if test="oredCriteria[].valid!= null and oredCriteria[].valid == 'true'.toString()">( 
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and">$oredCriteria[].criteriaWithoutValue[]$</iterate>  
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and">$oredCriteria[].criteriaWithSingleValue[].condition$ #{oredCriteria[].criteriaWithSingleValue[].value}</iterate>  
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and">$oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction=",">#{oredCriteria[].criteriaWithListValue[].values[]}</iterate> 
        </iterate>  
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and">$oredCriteria[].criteriaWithBetweenValue[].condition$ #{oredCriteria[].criteriaWithBetweenValue[].values[0]} and #{oredCriteria[].criteriaWithBetweenValue[].values[1]}</iterate> )
      </if> 
    </iterate> 
  </sql>
  <select id="selectByCriteria" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecordCriteria">select contract_no, employee_id, sign_time, sign_location, sign_in_time, sign_out_time,sign_out_location,sign_in_lon_and_lat,sign_out_lon_and_lat from tbl_sign_in_out_record
    <if test="_parameter != null"> 
      <include refid="tbl_sign_in_out_record.Criteria_Where_Clause"/>  
      <if test="orderByClause != null">order by ${orderByClause}</if> 
    </if> 
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecordKey"> 
    <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        --> select contract_no, employee_id, sign_time, sign_location, sign_in_time, sign_out_time,sign_out_location,sign_in_lon_and_lat,sign_out_lon_and_lat from tbl_sign_in_out_record where employee_id = #{employeeId:CHAR} and sign_time = #{signTime:VARCHAR}
  </select>
  <!-- 获取昨天的签到记录 -->
  <select id="selectLastDayByPrimaryKey" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecordKey"> 
    <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        --> select contract_no, employee_id, sign_time, sign_location, sign_in_time, sign_out_time,sign_out_location,sign_in_lon_and_lat,sign_out_lon_and_lat from tbl_sign_in_out_record where employee_id = #{employeeId:CHAR}<![CDATA[
      	and sign_time = date_format(date_sub(curdate(),interval 1 day),'%Y-%m-%d')
	   ]]> 
  </select>
  <!-- 查询签到信息2015-0904 -->
  <select id="selectSignInfoByDate" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord">select * from tbl_sign_in_out_record
    <!-- where sign_time like concat('%',#{signTime:VARCHAR},'%') order by sign_time-->  
    <trim prefix="where"> 
      <if test="employeeId != null">and employee_id = #{employeeId:CHAR}</if>  
      <if test="signTime != null">and sign_time like CONCAT('%', #{signTime:VARCHAR}, '%')</if> 
    </trim> 
  </select>
  <delete id="deleteByPrimaryKey" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecordKey"> 
    <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        --> delete from tbl_sign_in_out_record where contract_no = #{contractNo:VARCHAR} and employee_id = #{employeeId:CHAR} and sign_time = #{signTime:VARCHAR}
  </delete>
  <delete id="deleteByCriteria" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecordCriteria"> 
    <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        --> delete from tbl_sign_in_out_record 
    <include refid="tbl_sign_in_out_record.Criteria_Where_Clause"/> 
  </delete>
  <insert id="insert" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord"> 
    <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        --> insert into tbl_sign_in_out_record (contract_no, employee_id, sign_time, sign_location, sign_in_time, sign_out_time,sign_out_location,sign_in_lon_and_lat,sign_out_lon_and_lat) values (#{contractNo:VARCHAR}, #{employeeId:CHAR}, #{signTime:VARCHAR}, #{signLocation:VARCHAR}, #{signInTime:VARCHAR}, #{signOutTime:VARCHAR}, #{signOutLocation:VARCHAR}, #{signInLonAndLat:VARCHAR}, #{signOutLonAndLat:VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord"> 
    <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        --> insert into tbl_sign_in_out_record 
    <trim prefix="("> 
      <if test="contractNo != null">contract_no ,</if>  
      <if test="employeeId != null">employee_id ,</if>  
      <if test="signTime != null">sign_time ,</if>  
      <if test="signLocation != null">sign_location ,</if>  
      <if test="signInTime != null">sign_in_time ,</if>  
      <if test="signOutTime != null">sign_out_time ,</if>  
      <if test="signOutLocation != null">sign_out_location ,</if>  
      <if test="signInLonAndLat != null">sign_in_lon_and_lat ,</if>  
      <if test="signOutLonAndLat != null">sign_out_lon_and_lat ,</if> )
    </trim> values 
    <trim prefix="("> 
      <if test="contractNo != null">#{contractNo:VARCHAR} ,</if>  
      <if test="employeeId != null">#{employeeId:CHAR} ,</if>  
      <if test="signTime != null">#{signTime:VARCHAR} ,</if>  
      <if test="signLocation != null">#{signLocation:VARCHAR} ,</if>  
      <if test="signInTime != null">#{signInTime:VARCHAR} ,</if>  
      <if test="signOutTime != null">#{signOutTime:VARCHAR} ,</if>  
      <if test="signOutLocation != null">#{signOutLocation:VARCHAR} ,</if>  
      <if test="signInLonAndLat != null">#{signInLonAndLat:VARCHAR} ,</if>  
      <if test="signOutLonAndLat != null">#{signOutLonAndLat:VARCHAR} ,</if> )
    </trim> 
  </insert>
  <select id="countByCriteria" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecordCriteria" resultType="java.lang.Integer"> 
    <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        --> select count(*) from tbl_sign_in_out_record 
    <include refid="tbl_sign_in_out_record.Criteria_Where_Clause"/> 
  </select>
  <update id="updateByCriteriaSelective"> 
    <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        --> update tbl_sign_in_out_record 
    <trim prefix="set"> 
      <if test="record.contractNo != null">contract_no = #{record.contractNo:VARCHAR} ,</if>  
      <if test="record.employeeId != null">employee_id = #{record.employeeId:CHAR} ,</if>  
      <if test="record.signTime != null">sign_time = #{record.signTime:VARCHAR} ,</if>  
      <if test="record.signLocation != null">sign_location = #{record.signLocation:VARCHAR} ,</if>  
      <if test="record.signInTime != null">sign_in_time = #{record.signInTime:VARCHAR} ,</if>  
      <if test="record.signOutTime != null">sign_out_time = #{record.signOutTime:VARCHAR} ,</if>  
      <if test="record.signOutLocation != null">sign_out_location = #{record.signOutLocation:VARCHAR} ,</if>  
      <if test="record.signInLonAndLat != null">sign_in_lon_and_lat = #{record.signInLonAndLat:VARCHAR} ,</if>  
      <if test="record.signOutLonAndLat != null">sign_out_lon_and_lat = #{record.signOutLonAndLat:VARCHAR} ,</if> 
    </trim>  
    <if test="_parameter != null"> 
      <include refid="tbl_sign_in_out_record.Criteria_Where_Clause"/> 
    </if> 
  </update>
  <update id="updateByCriteria"> 
    <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        --> update tbl_sign_in_out_record set contract_no = #{record.contractNo:VARCHAR}, employee_id = #{record.employeeId:CHAR}, sign_time = #{record.signTime:VARCHAR}, sign_location = #{record.signLocation:VARCHAR}, sign_in_time = #{record.signInTime:VARCHAR}, sign_out_time = #{record.signOutTime:VARCHAR}, sign_out_location = #{record.signOutLocation:VARCHAR}, sign_in_lon_and_lat = #{record.signInLonAndLat:VARCHAR}, sign_out_lon_and_lat = #{record.signOutLonAndLat:VARCHAR}
    <if test="_parameter != null"> 
      <include refid="tbl_sign_in_out_record.Criteria_Where_Clause"/> 
    </if> 
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord"> 
    <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        --> update tbl_sign_in_out_record 
    <trim prefix="set"> 
      <if test="signLocation != null">sign_location = #{signLocation:VARCHAR} ,</if>  
      <if test="signInTime != null">sign_in_time = #{signInTime:VARCHAR} ,</if>  
      <if test="signOutTime != null">sign_out_time = #{signOutTime:VARCHAR} ,</if>  
      <if test="signOutLocation != null">sign_out_location = #{signOutLocation:VARCHAR} ,</if>  
      <if test="signInLonAndLat != null">sign_in_lon_and_lat = #{signInLonAndLat:VARCHAR} ,</if>  
      <if test="signOutLonAndLat != null">sign_out_lon_and_lat = #{signOutLonAndLat:VARCHAR} ,</if> 
    </trim> where contract_no = #{contractNo:VARCHAR} and employee_id = #{employeeId:CHAR} and sign_time = #{signTime:VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord"> 
    <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        --> update tbl_sign_in_out_record set sign_location = #{signLocation:VARCHAR}, sign_in_time = #{signInTime:VARCHAR}, sign_out_time = #{signOutTime:VARCHAR}, sign_out_location = #{signOutLocation:VARCHAR}, sign_in_lon_and_lat = #{signInLonAndLat:VARCHAR}, sign_out_lon_and_lat = #{signOutLonAndLat:VARCHAR} where contract_no = #{contractNo:VARCHAR} and employee_id = #{employeeId:CHAR} and sign_time = #{signTime:VARCHAR}
  </update>
  <select id="selectByProperties" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord">select employee_id, sign_time,sign_location,sign_in_time,sign_out_time,contract_no,sign_out_location,sign_in_lon_and_lat,sign_out_lon_and_lat from tbl_sign_in_out_record
    <trim prefix="where"> 
      <if test="employeeId != null">and employee_id = #{employeeId:CHAR}</if>  
      <if test="signTime != null">and sign_time like CONCAT('%', curdate(), '%')</if>  
      <if test="contractNo != null">and contract_no = #{contractNo:VARCHAR}</if> 
    </trim> 
  </select>
  <select id="selectByPropertie" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord">select employee_id, sign_time,sign_location,sign_in_time,sign_out_time,contract_no,sign_out_location,sign_in_lon_and_lat,sign_out_lon_and_lat from tbl_sign_in_out_record
    <trim prefix="where"> 
      <if test="signTime != null">and sign_time = #{signTime:VARCHAR}</if>  
      <if test="contractNo != null">and contract_no = #{contractNo:VARCHAR}</if> 
    </trim> 
  </select>
  <select id="searchByConditions" resultMap="BaseResultMap" parameterType="java.util.HashMap">SELECT A.* FROM tbl_sign_in_out_record AS A,tbl_employee_info AS B WHERE A.employee_id = B.EMPLOYEE_ID
    <trim prefix=" "> 
      <if test="contractNo != null and contractNo != ''">and A.contract_no=#{contractNo:CHAR}</if>  
      <if test="startSignTime != null and startSignTime != ''">and A.sign_time &gt;= #{startSignTime:VARCHAR}</if>  
      <if test="endSignTime != null and endSignTime != ''"> <![CDATA[ and A.sign_time <= #{endSignTime:VARCHAR} ]]> </if>  
      <if test="employeeName != null and employeeName != ''">and B.EMPLOYEE_NAME LIKE '%$employeeName$%'</if> 
    </trim> 
  </select>
  <select id="getLastSignOutRecord" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord">SELECT * FROM tbl_sign_in_out_record 
    <trim prefix="where"> 
      <if test="employeeId != null">and employee_id = #{employeeId:CHAR}</if>  
      <if test="contractNo != null">and contract_no = #{contractNo:VARCHAR}</if>  
      <if test="signTime != null">and sign_time = #{signTime:VARCHAR}</if>  
      <if test="properties != null"> 
        <if test="properties.notSignOut != null">and sign_in_time is not null and sign_out_time is null</if> 
      </if> 
    </trim> ORDER BY sign_time DESC LIMIT 0,1
  </select>
  <select id="countByCriterias" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" resultType="java.lang.Integer"> 
    <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        --> select count(*) from tbl_sign_in_out_record 
    <trim prefix="where"> 
      <if test="contractNo != null">and contract_no = #{contractNo:VARCHAR}</if>  
      <if test="signTime != null">and sign_time = #{signTime:VARCHAR}</if> 
    </trim> 
  </select>
  <select id="countByCriteriass" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" resultType="java.lang.Integer"> 
    <!--
          WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
          This element was generated on Wed May 29 10:18:44 CST 2013.
        --> select count(distinct(employee_id)) from tbl_sign_in_out_record where sign_time = #{signTime:VARCHAR}
  </select>
  <select id="selectByPropertiePart" resultMap="SecondResultMap" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord">select employee_id, sign_time,sign_location,sign_in_time,sign_out_time,contract_no,sign_out_location from tbl_sign_in_out_record
    <trim prefix="where"> 
      <if test="signTime != null">and sign_time = #{signTime:VARCHAR}</if>  
      <if test="contractNo != null">and contract_no = #{contractNo:VARCHAR}</if> 
    </trim> 
  </select>
  <!-- 查询公司所有签到人数 -->
  <select id="selectSignInEmpex" parameterType="java.util.Map" resultType="java.lang.Integer">select count(*) from tbl_sign_in_out_record sior, tbl_employee_info tei ,tbl_department_info tdi where sior.employee_id = tei.employee_id and tdi.DEPARTMENT_ID = tei.DEPARTMENT_ID and tei.is_on_duty='01'
    <if test="signTime != null">and sior.sign_time = #{signTime}</if>  
    <if test="contractNo != null and contractNo != ''">and sior.contract_no = #{contractNo}</if>  
    <if test="companyId != null and companyId != ''">and tei.beyond_company = #{companyId}</if>  
    <if test="area != null and area != ''">and tdi.area = #{area:VARCHAR}</if> 
  </select>
  <!-- 查询 未签退的数据  2016年2月29日  liyazhou 监控首页  -->
  <select id="selectSignOutEmpex" parameterType="java.util.Map" resultType="java.lang.Integer">select count(*) from tbl_sign_in_out_record sior, tbl_employee_info tei,tbl_department_info tdi where sior.employee_id = tei.employee_id and tdi.DEPARTMENT_ID = tei.DEPARTMENT_ID and tei.is_on_duty='01' and sior.sign_out_time !=''
    <if test="contractNo != null and contractNo != ''">and sior.contract_no = #{contractNo}</if>  
    <if test="companyId != null and companyId != ''">and tei.beyond_company = #{companyId}</if>  
    <if test="signTime != null and signTime != ''">and date_format(sior.sign_time,'%Y-%m-%d') = date_format(#{signTime:VARCHAR},'%Y-%m-%d')</if>  
    <if test="area != null and area != ''">and tdi.area = #{area:VARCHAR}</if> 
  </select>
  <!-- 查询所有签到人数 -->
  <select id="selectSignInEmp" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" resultType="java.lang.Integer">select count(*) from tbl_sign_in_out_record where sign_time = #{signTime:VARCHAR}
    <if test="contractNo != null and contractNo != ''">and contract_no = #{contractNo:VARCHAR}</if> 
  </select>
  <sql id="sign_In_Out_Where_Clause"> 
    <if test="contractNo != null and contractNo != ''">and sig.contract_no = #{contractNo:VARCHAR}</if>  
    <if test="properties.employeeName != null and properties.employeeName != ''">and emp.employee_name like concat('%', #{properties.employeeName:VARCHAR}, '%')</if>  
    <if test="properties.startTime != null and properties.startTime != ''">and sig.sign_time &gt;= #{properties.startTime:VARCHAR}</if>  
    <if test="properties.endTime != null and properties.endTime != ''">and sig.sign_time &lt;= #{properties.endTime:VARCHAR}</if> 
  </sql>
  <!-- 分页查询签到签退记录 -->
  <select id="countBySignInOutRecourd" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" resultType="java.lang.Integer"> 
    <!--select count(*)-->  
    <!--from  tbl_employee_info emp,tbl_sign_in_out_record sig,tbl_project_info project ,tbl_department_info dept-->  
    <!--where  sig.contract_no=project.contract_no-->  
    <!--and emp.employee_id = sig.employee_id-->  
    <!--&lt;!&ndash;-->  
    <!--对于公出用户，如果个人部门不等于公出所在地区项目部门那么签到信息就查询不出来 注释掉下面语句-->  
    <!--and emp.DEPARTMENT_ID = dept.DEPARTMENT_ID-->  
    <!--&ndash;&gt;-->  
    <!--and project.DEPARTMENT_ID = dept.DEPARTMENT_ID-->  
    <!--<isNotEmpty prepend="and" property="properties.compayid">-->  
    <!--emp.BEYOND_COMPANY = #{properties.compayid:VARCHAR}-->  
    <!--</isNotEmpty>-->  
    <!--<isNotEmpty prepend="and" property="properties.deptmentId">-->  
    <!--dept.DEPARTMENT_ID = #{properties.deptmentId:VARCHAR}-->  
    <!--</isNotEmpty>-->  
    <!--<isNotEmpty prepend="and" property="properties.area">-->  
    <!--dept.area = #{properties.area:VARCHAR}-->  
    <!--</isNotEmpty>-->  
    <!--<include refid="tbl_sign_in_out_record.sign_In_Out_Where_Clause" />-->  
    <!--<select id="selectSignInOutRecordPage" resultMap="ResultMapPage" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord" >--> select count(*) from tbl_employee_info emp,tbl_sign_in_out_record sig,tbl_project_info project ,tbl_department_info dept where sig.contract_no = project.contract_no and emp.employee_id = sig.employee_id
    <!--
            对于公出用户，如果个人部门不等于公出所在地区项目部门那么签到信息就查询不出来 注释掉下面语句
            and emp.DEPARTMENT_ID = dept.DEPARTMENT_ID
            --> and project.DEPARTMENT_ID = dept.DEPARTMENT_ID 
    <if test="properties.companyId != null and properties.companyId != ''">and emp.BEYOND_COMPANY = #{properties.companyId:VARCHAR}</if>  
    <if test="properties.departmentId != null and properties.departmentId != ''">and dept.DEPARTMENT_ID = #{properties.departmentId:VARCHAR}</if>  
    <if test="properties.area != null and properties.area != ''">and dept.area = #{properties.area:VARCHAR}</if>  
    <include refid="tbl_sign_in_out_record.sign_In_Out_Where_Clause"/> 
  </select>
  <select id="selectSignInOutRecordPage" resultMap="ResultMapPage" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord">select sig.*, project.project_name, emp.employee_name from tbl_employee_info emp,tbl_sign_in_out_record sig,tbl_project_info project ,tbl_department_info dept where sig.contract_no = project.contract_no and emp.employee_id = sig.employee_id
    <!--
        对于公出用户，如果个人部门不等于公出所在地区项目部门那么签到信息就查询不出来 注释掉下面语句
        and emp.DEPARTMENT_ID = dept.DEPARTMENT_ID
        --> and project.DEPARTMENT_ID = dept.DEPARTMENT_ID 
    <if test="properties.companyId != null and properties.companyId != ''">and emp.BEYOND_COMPANY = #{properties.companyId:VARCHAR}</if>  
    <if test="properties.departmentId != null and properties.departmentId != ''">and dept.DEPARTMENT_ID = #{properties.departmentId:VARCHAR}</if>  
    <if test="properties.area != null and properties.area != ''">and dept.area = #{properties.area:VARCHAR}</if>  
    <include refid="tbl_sign_in_out_record.sign_In_Out_Where_Clause"/> order by sig.sign_time desc
  </select>
  <!-- 组织报表数据 -->
  <select id="selectSignInOutRecordVo" resultMap="ResultMapVo" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord"> 
    <!-- select signer.sign_location, signer.sign_out_location,signer.sign_in_time,signer.sign_out_time,signer.sign_time, project.contract_no,project.project_name ,
                emp.employee_id, emp.employee_name
           from tbl_project_etc etc
          left join tbl_project_info project on etc.contract_no = project.contract_no
          left join  tbl_employee_info emp on etc.employee_id = emp.employee_id
          left join tbl_sign_in_out_record signer on etc.employee_id = signer.employee_id
              <isNotEmpty prepend="and" property="signTime">
                  <![CDATA[
                       date_format(signer.sign_in_time,'%Y-%m') = #{signTime:VARCHAR}
                   ]]>
              </isNotEmpty>
          where
          etc.is_leave='00'
          <isNotEmpty prepend="and" property="contractNo">
                  project.contract_no= #{contractNo:VARCHAR}
          </isNotEmpty>
          --> select signer.sign_location, signer.sign_out_location, signer.sign_in_time, signer.sign_out_time, signer.sign_time, project.project_actual_no as contract_no, project.project_name , emp.employee_id, emp.employee_name, dept.DEPARTMENT_NAME from tbl_project_etc etc left join tbl_project_info project on etc.contract_no = project.contract_no left join tbl_employee_info emp on etc.employee_id = emp.employee_id left join tbl_sign_in_out_record signer on etc.employee_id = signer.employee_id LEFT JOIN tbl_department_info dept on dept.DEPARTMENT_ID = project.DEPARTMENT_ID where etc.is_leave='00'
    <if test="properties.exportStatTimeFrom != null and properties.exportStatTimeFrom != ''">and date_format(signer.sign_in_time,'%Y-%m-%d') &gt;= #{properties.exportStatTimeFrom:VARCHAR}</if>  
    <if test="properties.exportEndTimeFrom != null and properties.exportEndTimeFrom != ''">and date_format(signer.sign_in_time,'%Y-%m-%d') &lt;= #{properties.exportEndTimeFrom:VARCHAR}</if>  
    <if test="properties.defaultExportStatTimeFrom != null">and date_format(signer.sign_in_time,'%Y-%m') &gt;=#{properties.defaultExportStatTimeFrom:VARCHAR}</if>  
    <if test="properties.defaultExportEndTimeFrom != null">and date_format(signer.sign_in_time,'%Y-%m') &lt;=#{properties.defaultExportEndTimeFrom:VARCHAR}</if>  
    <if test="properties.exportComapyFrom != null and properties.exportComapyFrom != ''">and dept.BEYOND_COMPANY = #{properties.exportComapyFrom:VARCHAR}</if>  
    <if test="properties.exportDeptmentFrom != null and properties.exportDeptmentFrom != ''">and dept.DEPARTMENT_ID = #{properties.exportDeptmentFrom:VARCHAR}</if>  
    <if test="properties.exportContractNoFrom != null and properties.exportContractNoFrom != ''">and project.contract_no = #{properties.exportContractNoFrom:VARCHAR}</if>  
    <if test="properties.exportAreaFrom != null and properties.exportAreaFrom != ''">and dept.AREA = #{properties.exportAreaFrom:VARCHAR}</if>  
    <if test="properties.exportEmployeeName != null and properties.exportEmployeeName != ''">and emp.EMPLOYEE_NAME = #{properties.exportEmployeeName:VARCHAR}</if> 
  </select>
  <select id="selectRecordBySelectDate" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord">SELECT * FROM tbl_sign_in_out_record
    <trim prefix="where"> 
      <if test="employeeId != null">and employee_id = #{employeeId:CHAR}</if>  
      <if test="signTime != null">and date_format(sign_time,'%Y-%m-%d') = date_format(#{signTime:VARCHAR},'%Y-%m-%d')</if> 
    </trim> 
  </select>
  <select id="selectSignRecordByContractNo" resultMap="ResultMapPage" parameterType="java.util.List">SELECT r.*,ei.EMPLOYEE_NAME,pi.project_name FROM tbl_sign_in_out_record r,tbl_employee_info ei,tbl_project_info pi WHERE r.contract_no IN
    <iterate close=")" open="(" conjunction=","> <![CDATA[
                 #{contractNo[]}
            ]]> </iterate> and r.employee_id =ei. employee_id and r.contract_no = pi.contract_no AND sign_time=CURDATE()
  </select>
  <select id="selectcountByContractNo" resultType="java.lang.Integer" parameterType="java.lang.String">SELECT count(*) FROM tbl_sign_in_out_record WHERE contract_no=#{ contractNo:VARCHAR } AND sign_time=CURDATE()</select>
  <select id="selectInfoBycontractNo" resultMap="ResultMapP" parameterType="java.lang.String">SELECT ei.EMPLOYEE_NAME,sior.* FROM (SELECT * FROM tbl_sign_in_out_record WHERE contract_no = #{contractNo:VARCHAR}) sior, tbl_employee_info ei WHERE sior.employee_id = ei.EMPLOYEE_ID</select>
  <select id="selectCount" resultType="java.lang.Integer" parameterType="java.lang.String">SELECT count(*) FROM tbl_sign_in_out_record WHERE tbl_sign_in_out_record.contract_no=#{contractNo:VARCHAR}</select>
  <!-- 组织报表数据 -->
  <select id="selectSignInOutRecordVoMonth" resultMap="ResultMapVo" parameterType="com.i2shopping.i2work.operation.core.sign.model.SignInOutRecord">select signer.sign_location, signer.sign_out_location, count(signer.sign_in_time) as sign_in_time, count(signer.sign_out_time) as sign_out_time, signer.sign_time, project.project_actual_no as contract_no, project.project_name , emp.employee_id, emp.employee_name, dept.DEPARTMENT_NAME from tbl_project_etc etc left join tbl_project_info project on etc.contract_no = project.contract_no left join tbl_employee_info emp on etc.employee_id = emp.employee_id left join tbl_sign_in_out_record signer on etc.employee_id = signer.employee_id LEFT JOIN tbl_department_info dept on dept.DEPARTMENT_ID = project.DEPARTMENT_ID where etc.is_leave='00'
    <if test="properties.exportStatTimeFrom != null and properties.exportStatTimeFrom != ''">and date_format(signer.sign_in_time,'%Y-%m-%d') &gt;= #{properties.exportStatTimeFrom:VARCHAR}</if>  
    <if test="properties.exportEndTimeFrom != null and properties.exportEndTimeFrom != ''">and date_format(signer.sign_in_time,'%Y-%m-%d') &lt;= #{properties.exportEndTimeFrom:VARCHAR}</if>  
    <if test="properties.defaultExportStatTimeFrom != null">and date_format(signer.sign_in_time,'%Y-%m') &gt;=#{properties.defaultExportStatTimeFrom:VARCHAR}</if>  
    <if test="properties.defaultExportEndTimeFrom != null">and date_format(signer.sign_in_time,'%Y-%m') &lt;=#{properties.defaultExportEndTimeFrom:VARCHAR}</if>  
    <if test="properties.exportComapyFrom != null and properties.exportComapyFrom != ''">and dept.BEYOND_COMPANY = #{properties.exportComapyFrom:VARCHAR}</if>  
    <if test="properties.exportDeptmentFrom != null and properties.exportDeptmentFrom != ''">and dept.DEPARTMENT_ID = #{properties.exportDeptmentFrom:VARCHAR}</if>  
    <if test="properties.exportContractNoFrom != null and properties.exportContractNoFrom != ''">and project.contract_no = #{properties.exportContractNoFrom:VARCHAR}</if>  
    <if test="properties.exportAreaFrom != null and properties.exportAreaFrom != ''">and dept.AREA = #{properties.exportAreaFrom:VARCHAR}</if>  
    <if test="properties.exportEmployeeName != null and properties.exportEmployeeName != ''">and emp.EMPLOYEE_NAME = #{properties.exportEmployeeName:VARCHAR}</if> GROUP BY EMPLOYEE_ID ORDER BY contract_no
  </select>
</mapper>
