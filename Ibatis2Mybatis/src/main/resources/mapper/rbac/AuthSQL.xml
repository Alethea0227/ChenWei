<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="TBL_AUTH">
  <resultMap id="BaseResultMap" type="com.i2shopping.i2work.operation.core.auth.model.Auth">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->
    <result column="USERID" property="userid" jdbcType="CHAR"/>
    <result column="LOGIN_ID" property="loginId" jdbcType="VARCHAR"/>
    <result column="PASSWORD" property="password" jdbcType="VARCHAR"/>
    <result column="USER_TYPE" property="userType" jdbcType="VARCHAR"/>
    <result column="IS_LOCK" property="isLock" jdbcType="CHAR"/>
    <result column="IS_ENABLE" property="isEnable" jdbcType="CHAR"/>
    <result column="EMPLOYEE_ID" property="employeeId" jdbcType="CHAR"/>
    <result column="PWD_VALID_TIME" property="pwdValidTime" jdbcType="TIMESTAMP"/>
    <result column="IMSI" property="imsi" jdbcType="VARCHAR"/>
    <result column="DEVICE_ID" property="deviceId" jdbcType="VARCHAR"/>
  </resultMap>
  <resultMap id="AuthInfoMap" type="com.i2shopping.i2work.operation.core.auth.model.AuthInfo">
    <result column="LOGIN_ID" property="loginId" jdbcType="VARCHAR"/>
    <result column="employee_id" property="employeeId" jdbcType="VARCHAR"/>
    <result column="employee_name" property="employeeName" jdbcType="VARCHAR"/>
    <result column="name" property="roleName" jdbcType="VARCHAR"/>
  </resultMap>
  <!-- 返回的结果集-->
  <resultMap id="BaseResultMapByEmployee" extends="BaseResultMap" type="com.i2shopping.i2work.operation.core.auth.model.Auth">
    <association property="employeeInfo" select="tbl_employee_info.selectByPrimaryKey" column="EMPLOYEE_ID"/>
  </resultMap>
  <sql id="Criteria_Where_Clause"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    -->  
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate"> 
      <if test="oredCriteria[].valid!= null and oredCriteria[].valid == 'true'.toString()">( 
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and">$oredCriteria[].criteriaWithoutValue[]$</iterate>  
        <iterate prepend="and" property="oredC-r-iteria[].criteriaWithSingleValue" conjunction="and">$oredCriteria[].criteriaWithSingleValue[].condition$ #{oredCriteria[].criteriaWithSingleValue[].value}</iterate>  
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and">$oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction=",">#{oredCriteria[].criteriaWithListValue[].values[]}</iterate> 
        </iterate>  
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and">$oredCriteria[].criteriaWithBetweenValue[].condition$ #{oredCriteria[].criteriaWithBetweenValue[].values[0]} and #{oredCriteria[].criteriaWithBetweenValue[].values[1]}</iterate> )
      </if> 
    </iterate> 
  </sql>
  <sql id="TBL_AUTH.Auth_Where_Clause"> 
    <if test="userid != null and userid != ''">and TBL_AUTH.USERID = #{userid:VARCHAR}</if>  
    <if test="loginId != null and loginId != ''">and TBL_AUTH.LOGIN_ID = #{loginId:VARCHAR}</if>  
    <if test="password != null and password != ''">and TBL_AUTH.PASSWORD = #{password:VARCHAR}</if>  
    <if test="userType != null and userType != ''">and TBL_AUTH.USER_TYPE = #{userType:VARCHAR}</if>  
    <if test="isEnable != null and isEnable != ''">and TBL_AUTH.IS_ENABLE = #{isEnable:VARCHAR}</if>  
    <if test="employeeId != null and employeeId != ''">and TBL_AUTH.EMPLOYEE_ID = #{employeeId:VARCHAR}</if>  
    <if test="pwdValidTime != null and pwdValidTime != ''">and PWD_VALID_TIME = #{pwdValidTime:TIMESTAMP}</if>  
    <if test="imsi != null and imsi != ''">and IMSI = #{imsi:VARCHAR}</if>  
    <if test="deviceId != null and deviceId != ''">and DEVICE_ID = #{deviceId:VARCHAR}</if> 
  </sql>
  <select id="selectAuth" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.auth.model.Auth">select * from TBL_AUTH 
    <trim prefix="where"> 
      <include refid="TBL_AUTH.Auth_Where_Clause"/> 
    </trim> 
  </select>
  <!-- 通过邮箱查找用户信息-->
  <select id="selectByEmail" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.auth.model.Auth">select AUTH.* from TBL_AUTH AUTH, TBL_EMPLOYEE_INFO INFO where AUTH.EMPLOYEE_ID = INFO.EMPLOYEE_ID and AUTH.PASSWORD = #{password:VARCHAR} and INFO.EMAIL = #{loginId:VARCHAR}</select>
  <select id="selectByCriteria" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.auth.model.AuthCriteria"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    --> select USERID, LOGIN_ID, PASSWORD, USER_TYPE, IS_LOCK, IS_ENABLE, PWD_VALID_TIME,EMPLOYEE_ID,IMSI from TBL_AUTH
    <if test="_parameter != null"> 
      <include refid="TBL_AUTH.Criteria_Where_Clause"/>  
      <if test="orderByClause != null">order by ${orderByClause}</if> 
    </if> 
  </select>
  <select id="selectUserIdByName" parameterType="java.lang.String" resultType="java.lang.String">select USERID from TBL_AUTH where LOGIN_ID=#{name:VARCHAR}</select>
  <select id="selectMallUserIdByName" parameterType="java.lang.String" resultType="java.lang.String">select A.USERID from TBL_AUTH A, B2C_MALL_USER_INFO B where LOGIN_ID=#{name:VARCHAR} AND A.USERID = B.USERID</select>
  <select id="selectMerchantUserIdByName" parameterType="java.lang.String" resultType="java.lang.String">select A.USERID from TBL_AUTH A, B2C_MERCHANT_USER_INFO B where LOGIN_ID=#{name:VARCHAR} AND A.USERID = B.USERID</select>
  <select id="selectEvaluationValue" resultMap="BaseResultMap" parameterType="java.util.ArrayList"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    --> select * from TBL_AUTH 
    <!--  	<dynamic prepend=" where USERID IN " >--> where USERID in 
    <iterate open="(" close=")" conjunction=",">#{listevaid[]}</iterate> 
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.auth.model.Auth"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    --> select USERID, LOGIN_ID, PASSWORD, USER_TYPE, IS_LOCK, IS_ENABLE, PWD_VALID_TIME,EMPLOYEE_ID,IMSI,DEVICE_ID from TBL_AUTH where USERID = #{userid:CHAR}
  </select>
  <select id="selectByPrimaryKey1" resultMap="BaseResultMap" parameterType="java.lang.String"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    --> select USERID, LOGIN_ID, PASSWORD, USER_TYPE, IS_LOCK, IS_ENABLE, PWD_VALID_TIME,EMPLOYEE_ID,IMSI from TBL_AUTH where USERID = #{userid:CHAR}
  </select>
  <!-- 按操作员编号查询 -->
  <select id="selectAuthByLoginId" resultMap="BaseResultMap" parameterType="java.lang.String">select TBL_AUTH.* from TBL_AUTH where LOGIN_ID = #{value:VARCHAR}</select>
  <select id="selectAuthByMemberId" resultMap="BaseResultMap" parameterType="java.lang.String">select TBL_AUTH.* from TBL_AUTH where USERID =#{value:CHAR}</select>
  <select id="selectAuthByEvaluaterId" resultMap="BaseResultMap" parameterType="java.lang.String">select TBL_AUTH.* from TBL_AUTH where USERID =#{value:CHAR}</select>
  <delete id="deleteByPrimaryKey" parameterType="com.i2shopping.i2work.operation.core.auth.model.Auth"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    --> delete from TBL_AUTH where USERID = #{userid:CHAR}
  </delete>
  <delete id="deleteByCriteria" parameterType="com.i2shopping.i2work.operation.core.auth.model.AuthCriteria"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    --> delete from TBL_AUTH 
    <include refid="TBL_AUTH.Criteria_Where_Clause"/> 
  </delete>
  <insert id="insert" parameterType="com.i2shopping.i2work.operation.core.auth.model.Auth"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    --> insert into TBL_AUTH (USERID, LOGIN_ID, PASSWORD, USER_TYPE, IS_LOCK, IS_ENABLE, PWD_VALID_TIME,EMPLOYEE_ID,IMSI,DEVICE_ID) values (#{userid:CHAR}, #{loginId:VARCHAR}, #{password:VARCHAR}, #{userType:VARCHAR}, #{isLock:CHAR}, #{isEnable:CHAR}, #{pwdValidTime:TIMESTAMP},#{employeeId:CHAR}, #{imsi:VARCHAR}, #{deviceId:VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.i2shopping.i2work.operation.core.auth.model.Auth"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    --> insert into TBL_AUTH 
    <trim prefix="("> 
      <if test="userid != null">USERID ,</if>  
      <if test="loginId != null">LOGIN_ID ,</if>  
      <if test="password != null">PASSWORD ,</if>  
      <if test="userType != null">USER_TYPE ,</if>  
      <if test="isLock != null">IS_LOCK ,</if>  
      <if test="isEnable != null">IS_ENABLE ,</if>  
      <if test="employeeId != null">EMPLOYEE_ID ,</if>  
      <if test="pwdValidTime != null">PWD_VALID_TIME ,</if>  
      <if test="imsi != null">IMSI ,</if>  
      <if test="deviceId != null">DEVICE_ID ,</if> )
    </trim> values 
    <trim prefix="("> 
      <if test="userid != null">#{userid:CHAR} ,</if>  
      <if test="loginId != null">#{loginId:VARCHAR} ,</if>  
      <if test="password != null">#{password:VARCHAR} ,</if>  
      <if test="userType != null">#{userType:VARCHAR} ,</if>  
      <if test="isLock != null">#{isLock:CHAR} ,</if>  
      <if test="isEnable != null">#{isEnable:CHAR} ,</if>  
      <if test="employeeId != null">#{employeeId:CHAR} ,</if>  
      <if test="pwdValidTime != null">#{pwdValidTime:TIMESTAMP} ,</if>  
      <if test="imsi != null">#{imsi:VARCHAR} ,</if>  
      <if test="deviceId != null">#{deviceId:VARCHAR} ,</if> )
    </trim> 
  </insert>
  <select id="countByCriteria" parameterType="com.i2shopping.i2work.operation.core.auth.model.AuthCriteria" resultType="java.lang.Integer"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    --> select count(*) from TBL_AUTH 
    <include refid="TBL_AUTH.Criteria_Where_Clause"/> 
  </select>
  <update id="updateByCriteriaSelective"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    --> update TBL_AUTH 
    <trim prefix="set"> 
      <if test="record.userid != null">USERID = #{record.userid:CHAR} ,</if>  
      <if test="record.loginId != null">LOGIN_ID = #{record.loginId:VARCHAR} ,</if>  
      <if test="record.password != null">PASSWORD = #{record.password:VARCHAR} ,</if>  
      <if test="record.userType != null">USER_TYPE = #{record.userType:VARCHAR} ,</if>  
      <if test="record.isLock != null">IS_LOCK = #{record.isLock:CHAR} ,</if>  
      <if test="record.isEnable != null">IS_ENABLE = #{record.isEnable:CHAR} ,</if>  
      <if test="record.employeeId != null">EMPLOYEE_ID = #{record.employeeId:CHAR} ,</if>  
      <if test="record.pwdValidTime != null">PWD_VALID_TIME = #{record.pwdValidTime:TIMESTAMP} ,</if>  
      <if test="record.imsi != null">IMSI = #{record.imsi:VARCHAR} ,</if>  
      <if test="record.deviceId != null">DEVICE_ID = #{record.deviceId:VARCHAR} ,</if> 
    </trim>  
    <if test="_parameter != null"> 
      <include refid="TBL_AUTH.Criteria_Where_Clause"/> 
    </if> 
  </update>
  <update id="updateByCriteria"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    --> update TBL_AUTH set USERID = #{record.userid:CHAR}, LOGIN_ID = #{record.loginId:VARCHAR}, PASSWORD = #{record.password:VARCHAR}, USER_TYPE = #{record.userType:VARCHAR}, IS_LOCK = #{record.isLock:CHAR}, IS_ENABLE = #{record.isEnable:CHAR}, PWD_VALID_TIME = #{record.pwdValidTime:TIMESTAMP}, IMSI = #{record.imsi:VARCHAR}, DEVICE_ID = #{record.deviceId:VARCHAR}
    <if test="_parameter != null"> 
      <include refid="TBL_AUTH.Criteria_Where_Clause"/> 
    </if> 
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.i2shopping.i2work.operation.core.auth.model.Auth"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    --> update TBL_AUTH 
    <trim prefix="set"> 
      <if test="loginId != null">LOGIN_ID = #{loginId:VARCHAR} ,</if>  
      <if test="password != null">PASSWORD = #{password:VARCHAR} ,</if>  
      <if test="userType != null">USER_TYPE = #{userType:VARCHAR} ,</if>  
      <if test="isLock != null">IS_LOCK = #{isLock:CHAR} ,</if>  
      <if test="isEnable != null">IS_ENABLE = #{isEnable:CHAR} ,</if>  
      <if test="pwdValidTime != null">PWD_VALID_TIME = #{pwdValidTime:TIMESTAMP} ,</if>  
      <if test="imsi != null">IMSI = #{imsi:VARCHAR} ,</if>  
      <if test="deviceId != null">DEVICE_ID = #{deviceId:VARCHAR} ,</if> 
    </trim> where EMPLOYEE_ID = #{employeeId:CHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.i2shopping.i2work.operation.core.auth.model.Auth"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    --> update TBL_AUTH set LOGIN_ID = #{loginId:VARCHAR}, PASSWORD = #{password:VARCHAR}, USER_TYPE = #{userType:VARCHAR}, IS_LOCK = #{isLock:CHAR}, IS_ENABLE = #{isEnable:CHAR}, PWD_VALID_TIME = #{pwdValidTime:TIMESTAMP}, IMSI = #{imsi:VARCHAR}, DEVICE_ID = #{deviceId:VARCHAR} where USERID = #{userid:CHAR}
  </update>
  <update id="thawByUserId" parameterType="com.i2shopping.i2work.operation.core.auth.model.Auth"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Fri Jul 12 12:22:26 CST 2013.
    --> update TBL_AUTH set IS_LOCK = #{isLock:CHAR} where USERID = #{userid:CHAR}
  </update>
  <!-- 通过用户名查找用户信息-->
  <select id="selectByUsername" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.auth.model.Auth">select * from TBL_AUTH where login_id = #{loginId:VARCHAR}</select>
  <!-- 通过用户id查找用户信息-->
  <select id="selectByUserId" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.auth.model.Auth">select USERID, LOGIN_ID,PASSWORD, USER_TYPE, IS_LOCK, IS_ENABLE,PWD_VALID_TIME,IMSI from TBL_AUTH where USERID=#{userid:VARCHAR}</select>
  <!-- 根据username(loginId)更新用户 -->
  <update id="updateAuthByUserName" parameterType="com.i2shopping.i2work.operation.core.auth.model.Auth">update TBL_AUTH set PASSWORD = #{password:VARCHAR} where LOGIN_ID = #{loginId:VARCHAR}</update>
  <!-- 查询所有的操作员， -->
  <select id="selectUserInfo" parameterType="com.i2shopping.i2work.operation.core.auth.model.Auth" resultMap="AuthInfoMap">select auth.login_id, auth.employee_id, info.employee_name, role.name from tbl_auth auth, tbl_employee_info info, tbl_role role, tbl_user_role_rel rel where auth.employee_id = info.employee_id and info.employee_id = rel.user_id and rel.role_id = role.role_id and auth.user_type='2'and role.role_id != 'ROLE2000'</select>
  <select id="countUserInfo" parameterType="com.i2shopping.i2work.operation.core.auth.model.Auth" resultType="java.lang.Integer">select count(*) from tbl_auth auth, tbl_employee_info info, tbl_role role, tbl_user_role_rel rel where auth.employee_id = info.employee_id and info.employee_id = rel.user_id and rel.role_id = role.role_id and auth.user_type='2' and role.role_id!='ROLE2000'</select>
</mapper>
