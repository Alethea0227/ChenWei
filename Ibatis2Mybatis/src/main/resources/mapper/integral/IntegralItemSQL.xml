<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="tbl_integral_item">
  <resultMap id="BaseResultMap" type="com.i2shopping.i2work.operation.core.integral.model.IntegralItem">
    <result column="INTEGRAL_ITEM_ID" property="integralItemId" jdbcType="VARCHAR"/>
    <result column="EMPLOYEE_ID" property="employeeId" jdbcType="VARCHAR"/>
    <result column="INTEGRAL_ITEM_DATE" property="integralItemDate" jdbcType="TIMESTAMP"/>
    <result column="EMP_INTEGRAL" property="empIntegral" jdbcType="INTEGER"/>
    <result column="INTEGRAL_TYPE" property="integralType" jdbcType="CHAR"/>
    <result column="INTEGRAL_REASON" property="integralReason" jdbcType="VARCHAR"/>
  </resultMap>
  <resultMap id="ResultMapExt" extends="BaseResultMap" type="com.i2shopping.i2work.operation.core.integral.model.IntegralItem">
    <result column="EMPLOYEE_NAME" property="employeeName" jdbcType="VARCHAR"/>
  </resultMap>
  <sql id="Criteria_Where_Clause"> 
    <iterate property="oredCriteria" conjunction="or" prepend="where" removeFirstPrepend="iterate"> 
      <if test="oredCriteria[].valid!= null and oredCriteria[].valid == 'true'.toString()">( 
        <iterate prepend="and" property="oredCriteria[].criteriaWithoutValue" conjunction="and">$oredCriteria[].criteriaWithoutValue[]$</iterate>  
        <iterate prepend="and" property="oredCriteria[].criteriaWithSingleValue" conjunction="and">$oredCriteria[].criteriaWithSingleValue[].condition$ #{oredCriteria[].criteriaWithSingleValue[].value}</iterate>  
        <iterate prepend="and" property="oredCriteria[].criteriaWithListValue" conjunction="and">$oredCriteria[].criteriaWithListValue[].condition$
          <iterate property="oredCriteria[].criteriaWithListValue[].values" open="(" close=")" conjunction=",">#{oredCriteria[].criteriaWithListValue[].values[]}</iterate> 
        </iterate>  
        <iterate prepend="and" property="oredCriteria[].criteriaWithBetweenValue" conjunction="and">$oredCriteria[].criteriaWithBetweenValue[].condition$ #{oredCriteria[].criteriaWithBetweenValue[].values[0]} and #{oredCriteria[].criteriaWithBetweenValue[].values[1]}</iterate> )
      </if> 
    </iterate> 
  </sql>
  <sql id="tbl_integral_item.integral_Where_Clause"> 
    <if test="integralItemId != null and integralItemId != ''">and tbl_integral_item.INTEGRAL_ITEM_ID = #{integralItemId:VARCHAR}</if>  
    <if test="employeeId != null and employeeId != ''">and tbl_integral_item.EMPLOYEE_ID = #{employeeId:VARCHAR}</if>  
    <if test="integralItemDate != null and integralItemDate != ''">and tbl_integral_item.INTEGRAL_ITEM_DATE = #{integralItemDate:TIMESTAMP}</if>  
    <if test="empIntegral != null and empIntegral != ''">and tbl_integral_item.EMP_INTEGRAL = #{empIntegral:INTEGER}</if>  
    <if test="integralType != null and integralType != ''">and tbl_integral_item.INTEGRAL_TYPE = #{integralType:CHAR}</if>  
    <if test="integralReason != null and integralReason != ''">and tbl_integral_item.INTEGRAL_REASON = #{integralReason:VARCHAR}</if> order by INTEGRAL_ITEM_DATE desc;
  </sql>
  <select id="selectByIntergalItem" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.integral.model.IntegralItem">select * from tbl_integral_item 
    <trim prefix="where"> 
      <include refid="tbl_integral_item.integral_Where_Clause"/> 
    </trim> 
  </select>
  <select id="selectByIntergalItemType" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.integral.model.IntegralItem">select * from tbl_integral_item where EMPLOYEE_ID = #{employeeId:VARCHAR} 
    <if test="integralItemDate != null and integralItemDate != ''">date_format(INTEGRAL_ITEM_DATE,'%Y-%m-%d') = date_format(sysdate(),'%Y-%m-%d')</if> and INTEGRAL_TYPE =#{integralType:CHAR} order by INTEGRAL_ITEM_DATE desc;
  </select>
  <!-- 查询昨日获取的积分 -->
  <select id="selectByEmployeeId" resultType="java.lang.Integer" parameterType="com.i2shopping.i2work.operation.core.integral.model.IntegralItem">select sum(EMP_INTEGRAL) from tbl_integral_item where EMPLOYEE_ID = #{employeeId:VARCHAR} and<![CDATA[
		    	date_format(INTEGRAL_ITEM_DATE,'%Y-%m-%d') = date_format(#{integralItemDate:TIMESTAMP},'%Y-%m-%d')
          ]]> group by EMPLOYEE_ID</select>
  <select id="selectByCriteria" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.integral.model.IntegralItemCriteria"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    --> select INTEGRAL_ITEM_ID, EMPLOYEE_ID, INTEGRAL_ITEM_DATE, EMP_INTEGRAL, INTEGRAL_TYPE, INTEGRAL_REASON from tbl_integral_item
    <if test="_parameter != null"> 
      <include refid="tbl_integral_item.Criteria_Where_Clause"/>  
      <if test="orderByClause != null">order by ${orderByClause}</if> 
    </if> 
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="com.i2shopping.i2work.operation.core.integral.model.IntegralItem"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    --> select INTEGRAL_ITEM_ID, EMPLOYEE_ID, INTEGRAL_ITEM_DATE, EMP_INTEGRAL, INTEGRAL_TYPE, INTEGRAL_REASON from tbl_integral_item where INTEGRAL_ITEM_ID = #{integralItemId:VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="com.i2shopping.i2work.operation.core.integral.model.IntegralItem"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    --> delete from tbl_integral_item where INTEGRAL_ITEM_ID = #{integralItemId:VARCHAR}
  </delete>
  <delete id="deleteByCriteria" parameterType="com.i2shopping.i2work.operation.core.integral.model.IntegralItemCriteria"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    --> delete from tbl_integral_item 
    <include refid="tbl_integral_item.Criteria_Where_Clause"/> 
  </delete>
  <insert id="insert" parameterType="com.i2shopping.i2work.operation.core.integral.model.IntegralItem"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    --> insert into tbl_integral_item (INTEGRAL_ITEM_ID, EMPLOYEE_ID, INTEGRAL_ITEM_DATE, EMP_INTEGRAL, INTEGRAL_TYPE, INTEGRAL_REASON) values (#{integralItemId:VARCHAR}, #{employeeId:VARCHAR}, #{integralItemDate:TIMESTAMP}, #{empIntegral:INTEGER}, #{integralType:CHAR}, #{integralReason:VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.i2shopping.i2work.operation.core.integral.model.IntegralItem"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    --> insert into tbl_integral_item 
    <trim prefix="("> 
      <if test="integralItemId != null">INTEGRAL_ITEM_ID ,</if>  
      <if test="employeeId != null">EMPLOYEE_ID ,</if>  
      <if test="integralItemDate != null">INTEGRAL_ITEM_DATE ,</if>  
      <if test="empIntegral != null">EMP_INTEGRAL ,</if>  
      <if test="integralType != null">INTEGRAL_TYPE ,</if>  
      <if test="integralReason != null">INTEGRAL_REASON ,</if> )
    </trim> values 
    <trim prefix="("> 
      <if test="integralItemId != null">#{integralItemId:VARCHAR} ,</if>  
      <if test="employeeId != null">#{employeeId:VARCHAR} ,</if>  
      <if test="integralItemDate != null">#{integralItemDate:TIMESTAMP} ,</if>  
      <if test="empIntegral != null">#{empIntegral:INTEGER} ,</if>  
      <if test="integralType != null">#{integralType:CHAR} ,</if>  
      <if test="integralReason != null">#{integralReason:VARCHAR} ,</if> )
    </trim> 
  </insert>
  <select id="countByCriteria" parameterType="com.i2shopping.i2work.operation.core.integral.model.IntegralItemCriteria" resultType="java.lang.Integer"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    --> select count(*) from tbl_integral_item 
    <include refid="tbl_integral_item.Criteria_Where_Clause"/> 
  </select>
  <update id="updateByCriteriaSelective"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    --> update tbl_integral_item 
    <trim prefix="set"> 
      <if test="record.integralItemId != null">INTEGRAL_ITEM_ID = #{record.integralItemId:VARCHAR} ,</if>  
      <if test="record.employeeId != null">EMPLOYEE_ID = #{record.employeeId:VARCHAR} ,</if>  
      <if test="record.integralItemDate != null">INTEGRAL_ITEM_DATE = #{record.integralItemDate:TIMESTAMP} ,</if>  
      <if test="record.empIntegral != null">EMP_INTEGRAL = #{record.empIntegral:INTEGER} ,</if>  
      <if test="record.integralType != null">INTEGRAL_TYPE = #{record.integralType:CHAR} ,</if>  
      <if test="record.integralReason != null">INTEGRAL_REASON = #{record.integralReason:VARCHAR} ,</if> 
    </trim>  
    <if test="_parameter != null"> 
      <include refid="tbl_integral_item.Criteria_Where_Clause"/> 
    </if> 
  </update>
  <update id="updateByCriteria"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    --> update tbl_integral_item set INTEGRAL_ITEM_ID = #{record.integralItemId:VARCHAR}, EMPLOYEE_ID = #{record.employeeId:VARCHAR}, INTEGRAL_ITEM_DATE = #{record.integralItemDate:TIMESTAMP}, EMP_INTEGRAL = #{record.empIntegral:INTEGER}, INTEGRAL_TYPE = #{record.integralType:CHAR}, INTEGRAL_REASON = #{record.integralReason:VARCHAR}
    <if test="_parameter != null"> 
      <include refid="tbl_integral_item.Criteria_Where_Clause"/> 
    </if> 
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.i2shopping.i2work.operation.core.integral.model.IntegralItem"> 
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Jul 08 17:48:50 CST 2015.
    --> update tbl_integral_item 
    <trim prefix="set"> 
      <if test="employeeId != null">EMPLOYEE_ID = #{employeeId:VARCHAR} ,</if>  
      <if test="integralItemDate != null">INTEGRAL_ITEM_DATE = #{integralItemDate:TIMESTAMP} ,</if>  
      <if test="empIntegral != null">EMP_INTEGRAL = #{empIntegral:INTEGER} ,</if>  
      <if test="integralType != null">INTEGRAL_TYPE = #{integralType:CHAR} ,</if>  
      <if test="integralReason != null">INTEGRAL_REASON = #{integralReason:VARCHAR} ,</if> 
    </trim> where INTEGRAL_ITEM_ID = #{integralItemId:VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.i2shopping.i2work.operation.core.integral.model.IntegralItem">update tbl_integral_item set EMPLOYEE_ID = #{employeeId:VARCHAR}, INTEGRAL_ITEM_DATE = #{integralItemDate:TIMESTAMP}, EMP_INTEGRAL = #{empIntegral:INTEGER}, INTEGRAL_TYPE = #{integralType:CHAR}, INTEGRAL_REASON = #{integralReason:VARCHAR} where INTEGRAL_ITEM_ID = #{integralItemId:VARCHAR}</update>
  <sql id="integral_Item_Where_Clause"> 
    <if test="properties.employeeName != null and properties.employeeName != ''">and info.employee_name like concat('%', #{properties.employeeName:VARCHAR}, '%')</if>  
    <if test="properties.startTime != null and properties.startTime != ''">and date_format(item.integral_item_date ,'%Y-%m-%d') &gt;= #{properties.startTime:VARCHAR}</if>  
    <if test="properties.endTime != null and properties.endTime != ''">and date_format(item.integral_item_date ,'%Y-%m-%d') &lt;= #{properties.endTime:VARCHAR}</if> 
  </sql>
  <!-- 查询积分明细， -->
  <select id="selectIntegralItemByPage" parameterType="com.i2shopping.i2work.operation.core.integral.model.IntegralItem" resultMap="ResultMapExt">select item.*,info.employee_name from tbl_integral_item item , tbl_employee_info info where item.employee_id = info.employee_id 
    <include refid="tbl_integral_item.integral_Item_Where_Clause"/> order by item.integral_item_date desc
  </select>
  <select id="countByIntegralItem" parameterType="com.i2shopping.i2work.operation.core.integral.model.IntegralItem" resultType="java.lang.Integer">select count(*) from tbl_integral_item item , tbl_employee_info info where item.employee_id = info.employee_id 
    <include refid="tbl_integral_item.integral_Item_Where_Clause"/> 
  </select>
</mapper>
